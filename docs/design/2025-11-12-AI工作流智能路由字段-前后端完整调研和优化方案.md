# AIå·¥ä½œæµæ™ºèƒ½è·¯ç”±å­—æ®µ - å‰åç«¯å®Œæ•´è°ƒç ”å’Œä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“‹ è°ƒç ”èƒŒæ™¯

è¡¨ `ai_workflow` ä¸­æ–°å¢äº†5ä¸ªæ™ºèƒ½è·¯ç”±ç›¸å…³å­—æ®µ:
- `desc` - è¯¦ç»†æè¿°(ä¾›LLMç†è§£é€‚ç”¨åœºæ™¯)
- `keywords` - å…³é”®è¯(é€—å·åˆ†éš”,ç”¨äºLayer 2å¿«é€ŸåŒ¹é…)
- `category` - å·¥ä½œæµåˆ†ç±»(å­—å…¸å€¼: ai_workflow_category)
- `priority` - ä¼˜å…ˆçº§(0-100,æ•°å€¼è¶Šé«˜è¶Šä¼˜å…ˆ)
- `last_test_time` - æœ€åæµ‹è¯•è¿è¡Œæ—¶é—´(ç”¨äºå‘å¸ƒæ ¡éªŒ)

**è°ƒç ”ç›®æ ‡**: å…¨é¢è¯„ä¼°è¿™5ä¸ªå­—æ®µåœ¨å‰åç«¯çš„å®ç°çŠ¶æ€,æ‰¾å‡ºé—æ¼,æä¾›ä¼˜åŒ–æ–¹æ¡ˆã€‚

---

## âœ… åç«¯å®ç°çŠ¶æ€åˆ†æ

### 1. Entityå±‚ - âœ… å·²å®Œæˆ

**æ–‡ä»¶**: `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/entity/workflow/AiWorkflowEntity.java`

**å®ç°æƒ…å†µ**:
```java
// Lines 109-151: æ™ºèƒ½è·¯ç”±æ–°å¢å­—æ®µ (2025-11-10)

/**
 * è¯¦ç»†æè¿°,ä¾›LLMç†è§£é€‚ç”¨åœºæ™¯
 * ç¤ºä¾‹: "ä¸“é—¨å¤„ç†ä¾›åº”é“¾ç®¡ç†ç›¸å…³é—®é¢˜,åŒ…æ‹¬è®¢å•æŸ¥è¯¢ã€åº“å­˜ç®¡ç†ç­‰ã€‚
 *       é€‚ç”¨åœºæ™¯: ç”¨æˆ·è¯¢é—®å…·ä½“çš„SCMä¸šåŠ¡æ“ä½œæˆ–æ•°æ®æŸ¥è¯¢ã€‚
 *       ä¸é€‚ç”¨: é€šç”¨çŸ¥è¯†é—®ç­”ã€é—²èŠã€‚"
 * æ•°æ®åº“å­—æ®µ: desc (MySQLä¿ç•™å…³é”®å­—,éœ€åå¼•å·)
 */
@TableField("`desc`")
private String desc;

/**
 * å…³é”®è¯,é€—å·åˆ†éš”
 * ç¤ºä¾‹: "è®¢å•,é‡‡è´­,åº“å­˜,å…¥åº“,å‡ºåº“"
 * ç”¨äºLayer 2å…³é”®è¯å¿«é€ŸåŒ¹é…
 */
@TableField("keywords")
private String keywords;

/**
 * å·¥ä½œæµåˆ†ç±»(å­—å…¸å€¼: ai_workflow_category)
 * å–å€¼: 0=ä¸šåŠ¡å¤„ç†, 1=çŸ¥è¯†é—®ç­”, 2=é€šç”¨å¯¹è¯
 * æ³¨æ„: ä»…ç”¨äºå‰ç«¯UIç­›é€‰,ä¸å‚ä¸è·¯ç”±é€»è¾‘
 */
@TableField("category")
private String category;

/**
 * ä¼˜å…ˆçº§ (0-100)
 * æ•°å€¼è¶Šé«˜,è·¯ç”±åŒ¹é…æ—¶è¶Šä¼˜å…ˆ
 */
@TableField("priority")
private Integer priority;

/**
 * æœ€åæµ‹è¯•è¿è¡Œæ—¶é—´
 * ç”¨äºåˆ¤æ–­æ˜¯å¦å¯å‘å¸ƒ (æµ‹è¯•æ—¶é—´ > æ›´æ–°æ—¶é—´)
 */
@TableField("last_test_time")
private LocalDateTime lastTestTime;
```

**è¯„ä»·**: âœ… å®ç°å®Œæ•´,æ³¨é‡Šæ¸…æ™°,ç‰¹åˆ«æ³¨æ„äº† `desc` ä½œä¸ºMySQLä¿ç•™å…³é”®å­—éœ€è¦ä½¿ç”¨åå¼•å·ã€‚

---

### 2. VOå±‚ - âœ… å·²å®Œæˆ

**æ–‡ä»¶**: `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/workflow/AiWorkflowVo.java`

**å®ç°æƒ…å†µ**:
```java
/**
 * å·¥ä½œæµè¯¦ç»†æè¿°(ä¾›LLMè·¯ç”±ä½¿ç”¨)
 */
private String desc;

/**
 * å…³é”®è¯(é€—å·åˆ†éš”)
 */
private String keywords;

/**
 * å·¥ä½œæµåˆ†ç±»(å­—å…¸å€¼)
 */
private String category;

/**
 * å·¥ä½œæµåˆ†ç±»åç§°(ä»å­—å…¸è¡¨å…³è”æŸ¥è¯¢)
 */
private String categoryName;  // é‡ç‚¹: æ–°å¢å­—æ®µç”¨äºæ˜¾ç¤ºåˆ†ç±»åç§°

/**
 * ä¼˜å…ˆçº§
 */
private Integer priority;

/**
 * æœ€åæµ‹è¯•è¿è¡Œæ—¶é—´
 */
private LocalDateTime lastTestTime;
```

**è¯„ä»·**: âœ… å®ç°å®Œæ•´,é¢å¤–å¢åŠ äº† `categoryName` å­—æ®µç”¨äºå‰ç«¯æ˜¾ç¤º,è€ƒè™‘å‘¨åˆ°ã€‚

---

### 3. Mapperå±‚ - âœ… å·²å®Œæˆ(è¶…é¢„æœŸ)

**æ–‡ä»¶**: `scm-ai/src/main/java/com/xinyirun/scm/ai/core/mapper/workflow/AiWorkflowMapper.java`

**å‘ç°**: åç«¯Mapperå±‚å·²ç»å®ç°äº†4ä¸ªæ–°çš„æŸ¥è¯¢æ–¹æ³•,å…¨éƒ¨åŒ…å«5ä¸ªæ–°å­—æ®µ!

#### 3.1 è·¯ç”±æŸ¥è¯¢æ–¹æ³• (Lines 164-212)
```java
/**
 * æŸ¥è¯¢å¯ç”¨äºæ™ºèƒ½è·¯ç”±çš„å·¥ä½œæµåˆ—è¡¨
 *
 * æŸ¥è¯¢æ¡ä»¶:
 * - is_enable = 1 (å·²å‘å¸ƒ)
 * - is_public = 1 OR c_id = userId (å…¬å¼€çš„ æˆ– ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„)
 *
 * LEFT JOIN s_dict_dataè·å–åˆ†ç±»åç§°
 *
 * æ’åºé€»è¾‘:
 * 1. ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„æ’å‰é¢ (c_id = userId)
 * 2. ä¼˜å…ˆçº§é«˜çš„æ’å‰é¢ (priority DESC)
 * 3. æœ€è¿‘æ›´æ–°çš„æ’å‰é¢ (u_time DESC)
 */
@Select("""
    SELECT
        t1.id,
        t1.workflow_uuid AS workflowUuid,
        t1.title,
        t1.remark,
        t1.`desc`,           -- æ–°å­—æ®µ1
        t1.keywords,         -- æ–°å­—æ®µ2
        t1.category,         -- æ–°å­—æ®µ3
        t2.label AS categoryName,  -- å­—å…¸å…³è”æŸ¥è¯¢
        t1.priority,         -- æ–°å­—æ®µ4
        t1.user_id AS userId,
        t1.is_public AS isPublic,
        t1.is_enable AS isEnable,
        t1.is_deleted AS isDeleted,
        t1.last_test_time AS lastTestTime,  -- æ–°å­—æ®µ5
        t1.c_time AS cTime,
        t1.u_time AS uTime,
        t1.c_id AS cId,
        t1.u_id AS uId,
        t1.dbversion
    FROM ai_workflow t1
    LEFT JOIN s_dict_data t2
      ON t2.code = 'ai_workflow_category'
      AND t2.dict_value = t1.category
    WHERE t1.is_enable = 1
      AND (t1.is_public = 1 OR t1.c_id = #{userId})
    ORDER BY
      CASE WHEN t1.c_id = #{userId} THEN 0 ELSE 1 END,
      t1.priority DESC,
      t1.u_time DESC
    """)
List<AiWorkflowVo> selectAvailableWorkflowsForRouting(@Param("userId") Long userId);
```

#### 3.2 ç®¡ç†é¡µæŸ¥è¯¢æ–¹æ³• (Lines 220-246)
```java
/**
 * æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰å·¥ä½œæµ(åŒ…æ‹¬æœªå‘å¸ƒçš„)
 * ç”¨äºå·¥ä½œæµç®¡ç†é¡µé¢åˆ—è¡¨å±•ç¤º
 */
@Select("""
    SELECT
        id, workflow_uuid AS workflowUuid, title, remark,
        user_id AS userId, is_public AS isPublic,
        is_enable AS isEnable, is_deleted AS isDeleted,
        `desc`, keywords, category, priority, last_test_time AS lastTestTime,
        c_time AS cTime, u_time AS uTime,
        c_id AS cId, u_id AS uId, dbversion
    FROM ai_workflow
    WHERE (is_public = 1 OR c_id = #{userId})
    ORDER BY u_time DESC
    """)
List<AiWorkflowEntity> selectAllUserWorkflows(@Param("userId") Long userId);
```

#### 3.3 é»˜è®¤å·¥ä½œæµæŸ¥è¯¢ (Lines 254-280)
```java
/**
 * æŸ¥è¯¢é»˜è®¤å·¥ä½œæµ(å…œåº•å·¥ä½œæµ)
 *
 * æŸ¥è¯¢æ¡ä»¶:
 * - is_public = 1 (å…¬å¼€)
 * - category = '2' (é€šç”¨å¯¹è¯åˆ†ç±»)
 * - is_enable = 1 (å·²å‘å¸ƒ)
 *
 * æŒ‰ä¼˜å…ˆçº§å’Œæ›´æ–°æ—¶é—´æ’åº,å–ç¬¬ä¸€ä¸ª
 */
@Select("""
    SELECT
        id, workflow_uuid AS workflowUuid, title, remark,
        user_id AS userId, is_public AS isPublic,
        is_enable AS isEnable, is_deleted AS isDeleted,
        `desc`, keywords, category, priority, last_test_time AS lastTestTime,
        c_time AS cTime, u_time AS uTime,
        c_id AS cId, u_id AS uId, dbversion
    FROM ai_workflow
    WHERE is_public = 1
      AND category = '2'
      AND is_enable = 1
    ORDER BY priority DESC, u_time DESC
    LIMIT 1
    """)
AiWorkflowEntity selectDefaultWorkflow();
```

#### 3.4 å·²å‘å¸ƒå·¥ä½œæµæŸ¥è¯¢ (Lines 289-318)
```java
/**
 * æŸ¥è¯¢å·²å‘å¸ƒçš„å·¥ä½œæµåˆ—è¡¨(å¯é€‰æŒ‰åˆ†ç±»ç­›é€‰)
 *
 * @param userId ç”¨æˆ·ID(å¯ä¸ºnull)
 * @param category åˆ†ç±»(å¯ä¸ºnull,nullè¡¨ç¤ºä¸ç­›é€‰åˆ†ç±»)
 */
@Select("""
    SELECT
        id, workflow_uuid AS workflowUuid, title, remark,
        user_id AS userId, is_public AS isPublic,
        is_enable AS isEnable, is_deleted AS isDeleted,
        `desc`, keywords, category, priority, last_test_time AS lastTestTime,
        c_time AS cTime, u_time AS uTime,
        c_id AS cId, u_id AS uId, dbversion
    FROM ai_workflow
    WHERE is_enable = 1
      AND (is_public = 1 OR c_id = #{userId})
      AND (#{category} IS NULL OR category = #{category})
    ORDER BY priority DESC, u_time DESC
    """)
List<AiWorkflowEntity> selectPublishedWorkflows(
    @Param("userId") Long userId,
    @Param("category") String category
);
```

**è¯„ä»·**: âœ… å®ç°å®Œæ•´ä¸”è¶…é¢„æœŸ,4ä¸ªæ–°æŸ¥è¯¢æ–¹æ³•å…¨éƒ¨åŒ…å«5ä¸ªæ–°å­—æ®µ,ç‰¹åˆ«æ˜¯è·¯ç”±æŸ¥è¯¢æ–¹æ³•è¿˜åšäº†LEFT JOINå­—å…¸è¡¨è·å–åˆ†ç±»åç§°ã€‚

---

### 4. Serviceå±‚ - âœ… å·²å®Œæˆ(åŒ…å«å‘å¸ƒæµç¨‹)

**æ–‡ä»¶**: `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/workflow/AiWorkflowService.java`

#### 4.1 è·¯ç”±æŸ¥è¯¢æ–¹æ³• (Lines 474-506)
```java
/**
 * è·å–å¯ç”¨äºæ™ºèƒ½è·¯ç”±çš„å·¥ä½œæµåˆ—è¡¨
 */
public List<AiWorkflowVo> getAvailableWorkflowsForRouting(String tenantCode, Long userId) {
    return aiWorkflowMapper.selectAvailableWorkflowsForRouting(userId);
}

/**
 * è·å–ç”¨æˆ·çš„æ‰€æœ‰å·¥ä½œæµ(åŒ…æ‹¬æœªå‘å¸ƒçš„)
 */
public List<AiWorkflowEntity> getAllUserWorkflows(String tenantCode, Long userId) {
    return aiWorkflowMapper.selectAllUserWorkflows(userId);
}

/**
 * è·å–é»˜è®¤å·¥ä½œæµ(å…œåº•å·¥ä½œæµ)
 */
public AiWorkflowEntity getDefaultWorkflow(String tenantCode) {
    return aiWorkflowMapper.selectDefaultWorkflow();
}
```

#### 4.2 å·¥ä½œæµä¿å­˜æ–¹æ³• (Lines 509-525)
```java
/**
 * ä¿å­˜å·¥ä½œæµ
 * æ³¨æ„: ä¿å­˜æ—¶å¼ºåˆ¶è®¾ç½® is_enable = false (è‰ç¨¿çŠ¶æ€)
 * å¿…é¡»ç»è¿‡æµ‹è¯•åæ‰èƒ½å‘å¸ƒ
 */
@Transactional(rollbackFor = Exception.class)
public AiWorkflowVo saveWorkflow(AiWorkflowVo vo) {
    AiWorkflowEntity entity = new AiWorkflowEntity();
    BeanUtils.copyProperties(vo, entity);

    // å¼ºåˆ¶è®¾ç½®ä¸ºæœªå¯ç”¨çŠ¶æ€(è‰ç¨¿)
    entity.setIsEnable(false);

    if (entity.getId() == null) {
        aiWorkflowMapper.insert(entity);
    } else {
        aiWorkflowMapper.updateById(entity);
    }

    return convertToVo(entity);
}
```

#### 4.3 æ›´æ–°æµ‹è¯•æ—¶é—´ (Lines 527-541)
```java
/**
 * æ›´æ–°å·¥ä½œæµçš„æœ€åæµ‹è¯•è¿è¡Œæ—¶é—´
 *
 * @param workflowUuid å·¥ä½œæµUUID
 */
@Transactional(rollbackFor = Exception.class)
public void updateTestTime(String workflowUuid) {
    AiWorkflowEntity workflow = aiWorkflowMapper.selectByWorkflowUuid(workflowUuid);
    if (workflow == null) {
        throw new RuntimeException("å·¥ä½œæµä¸å­˜åœ¨: " + workflowUuid);
    }

    workflow.setLastTestTime(java.time.LocalDateTime.now());
    aiWorkflowMapper.updateById(workflow);
}
```

#### 4.4 å‘å¸ƒå·¥ä½œæµ (Lines 543-569)
```java
/**
 * å‘å¸ƒå·¥ä½œæµ
 *
 * å‘å¸ƒå‰æ ¡éªŒ:
 * 1. æ˜¯å¦æµ‹è¯•è¿‡ (lastTestTime != null)
 * 2. æµ‹è¯•æ—¶é—´æ˜¯å¦åœ¨æ›´æ–°æ—¶é—´ä¹‹å (ç¡®ä¿æµ‹è¯•çš„æ˜¯æœ€æ–°ç‰ˆæœ¬)
 *
 * @param workflowUuid å·¥ä½œæµUUID
 */
@Transactional(rollbackFor = Exception.class)
public void publishWorkflow(String workflowUuid) {
    AiWorkflowEntity workflow = aiWorkflowMapper.selectByWorkflowUuid(workflowUuid);
    if (workflow == null) {
        throw new RuntimeException("å·¥ä½œæµä¸å­˜åœ¨: " + workflowUuid);
    }

    // æ ¡éªŒ: æ˜¯å¦æµ‹è¯•è¿‡
    if (workflow.getLastTestTime() == null) {
        throw new RuntimeException("è¯·å…ˆæ‰§è¡Œæµ‹è¯•è¿è¡Œ,ç¡®è®¤å·¥ä½œæµæ­£å¸¸åå†å‘å¸ƒ");
    }

    // æ ¡éªŒ: æµ‹è¯•æ—¶é—´æ˜¯å¦åœ¨æ›´æ–°æ—¶é—´ä¹‹å
    if (workflow.getUTime() != null &&
        workflow.getLastTestTime().isBefore(workflow.getUTime())) {
        throw new RuntimeException("å·¥ä½œæµå·²ä¿®æ”¹,è¯·é‡æ–°æµ‹è¯•è¿è¡Œåå†å‘å¸ƒ");
    }

    // å‘å¸ƒ
    workflow.setIsEnable(true);
    aiWorkflowMapper.updateById(workflow);
}
```

#### 4.5 å–æ¶ˆå‘å¸ƒ (Lines 571-585)
```java
/**
 * å–æ¶ˆå‘å¸ƒå·¥ä½œæµ
 *
 * @param workflowUuid å·¥ä½œæµUUID
 */
@Transactional(rollbackFor = Exception.class)
public void unpublishWorkflow(String workflowUuid) {
    AiWorkflowEntity workflow = aiWorkflowMapper.selectByWorkflowUuid(workflowUuid);
    if (workflow == null) {
        throw new RuntimeException("å·¥ä½œæµä¸å­˜åœ¨: " + workflowUuid);
    }

    workflow.setIsEnable(false);
    aiWorkflowMapper.updateById(workflow);
}
```

**è¯„ä»·**: âœ… Serviceå±‚å®ç°å®Œæ•´,ç‰¹åˆ«æ˜¯å‘å¸ƒæµç¨‹è®¾è®¡åˆç†:
- ä¿å­˜æ—¶å¼ºåˆ¶è‰ç¨¿çŠ¶æ€
- å‘å¸ƒå‰å¿…é¡»æµ‹è¯•
- ä¿®æ”¹åéœ€è¦é‡æ–°æµ‹è¯•æ‰èƒ½å‘å¸ƒ

---

### 5. Controllerå±‚ - âš ï¸ éƒ¨åˆ†å®Œæˆ(ç¼ºå°‘3ä¸ªç«¯ç‚¹)

**æ–‡ä»¶**: `scm-ai/src/main/java/com/xinyirun/scm/ai/controller/workflow/WorkflowController.java`

#### 5.1 ç°æœ‰ç«¯ç‚¹

**æ›´æ–°å·¥ä½œæµæ¥å£** (Lines 133-140):
```java
/**
 * æ›´æ–°å·¥ä½œæµåŸºæœ¬ä¿¡æ¯
 *
 * æ³¨æ„: è¿™ä¸ªæ¥å£æ¥å— AiWorkflowVo å‚æ•°,åŒ…å«äº†5ä¸ªæ–°å­—æ®µ
 * æ‰€ä»¥ç†è®ºä¸Šå¯ä»¥æ›´æ–°è¿™äº›å­—æ®µ,ä½†æ˜¯:
 * 1. æ²¡æœ‰æ˜¾å¼çš„å‚æ•°æ ¡éªŒ
 * 2. æ²¡æœ‰å‘å¸ƒçŠ¶æ€çš„ä¸šåŠ¡é€»è¾‘æ§åˆ¶
 */
@PostMapping("/update")
public ResponseEntity<JsonResultAo<AiWorkflowVo>> update(@RequestBody(required = false) AiWorkflowVo vo) {
    log.info("æ›´æ–°å·¥ä½œæµ,workflowId:{},title:{}", vo.getId(), vo.getTitle());
    AiWorkflowVo result = workflowService.update(vo);
    return ResponseEntity.ok().body(ResultUtil.OK(result));
}
```

**é—®é¢˜åˆ†æ**:
- âœ… æ¥å£æ¥å—çš„VOåŒ…å«5ä¸ªæ–°å­—æ®µ,ç†è®ºä¸Šå¯ä»¥æ›´æ–°
- âŒ ä½†æ˜¯æ²¡æœ‰æ˜ç¡®çš„æ–‡æ¡£è¯´æ˜è¿™äº›å­—æ®µå¦‚ä½•ä½¿ç”¨
- âŒ æ²¡æœ‰é’ˆå¯¹æ–°å­—æ®µçš„å‚æ•°æ ¡éªŒ(å¦‚priorityèŒƒå›´0-100)
- âŒ æ²¡æœ‰å‘å¸ƒçŠ¶æ€æ§åˆ¶çš„ä¸šåŠ¡é€»è¾‘

#### 5.2 ç¼ºå¤±çš„ç«¯ç‚¹

Serviceå±‚å·²å®ç°ä½†Controlleræœªæš´éœ²çš„æ–¹æ³•:

**ç¼ºå¤±1: æµ‹è¯•è¿è¡Œæ¥å£**
```java
// Serviceå·²å®ç°: updateTestTime(workflowUuid)
// åº”è¯¥æ–°å¢æ¥å£:
POST /api/v1/ai/workflow/test/{uuid}

åŠŸèƒ½: è§¦å‘å·¥ä½œæµæµ‹è¯•è¿è¡Œ,æˆåŠŸåæ›´æ–° last_test_time
è¿”å›: { "success": true, "testTime": "2025-11-12 10:30:00" }
```

**ç¼ºå¤±2: å‘å¸ƒå·¥ä½œæµæ¥å£**
```java
// Serviceå·²å®ç°: publishWorkflow(workflowUuid)
// åº”è¯¥æ–°å¢æ¥å£:
POST /api/v1/ai/workflow/publish/{uuid}

åŠŸèƒ½: å‘å¸ƒå·¥ä½œæµ
æ ¡éªŒ:
  - lastTestTime != null
  - lastTestTime > uTime
è¿”å›: { "success": true, "message": "å‘å¸ƒæˆåŠŸ" }
é”™è¯¯: { "success": false, "message": "è¯·å…ˆæ‰§è¡Œæµ‹è¯•è¿è¡Œ" }
```

**ç¼ºå¤±3: å–æ¶ˆå‘å¸ƒæ¥å£**
```java
// Serviceå·²å®ç°: unpublishWorkflow(workflowUuid)
// åº”è¯¥æ–°å¢æ¥å£:
POST /api/v1/ai/workflow/unpublish/{uuid}

åŠŸèƒ½: å–æ¶ˆå‘å¸ƒå·¥ä½œæµ(è®¾ç½® is_enable = false)
è¿”å›: { "success": true, "message": "å·²å–æ¶ˆå‘å¸ƒ" }
```

**è¯„ä»·**: âš ï¸ Controllerå±‚éƒ¨åˆ†å®Œæˆ:
- ç°æœ‰updateæ¥å£å¯ä»¥æ›´æ–°æ–°å­—æ®µ,ä½†ç¼ºå°‘æ˜ç¡®è¯´æ˜å’Œæ ¡éªŒ
- ç¼ºå°‘æµ‹è¯•ã€å‘å¸ƒã€å–æ¶ˆå‘å¸ƒä¸‰ä¸ªç«¯ç‚¹
- Serviceå±‚åŠŸèƒ½å·²å®Œå¤‡,åªéœ€æš´éœ²æ¥å£å³å¯

---

### åç«¯å®ç°çŠ¶æ€æ€»ç»“

| å±‚çº§ | çŠ¶æ€ | å®Œæˆåº¦ | è¯´æ˜ |
|-----|------|--------|------|
| Entity | âœ… å®Œæˆ | 100% | 5ä¸ªå­—æ®µå…¨éƒ¨å®šä¹‰,æ³¨é‡Šæ¸…æ™° |
| VO | âœ… å®Œæˆ | 100% | åŒ…å«5ä¸ªå­—æ®µ + categoryName |
| Mapper | âœ… å®Œæˆ | 120% | 4ä¸ªæ–°æŸ¥è¯¢æ–¹æ³•,è¶…é¢„æœŸ |
| Service | âœ… å®Œæˆ | 100% | æŸ¥è¯¢+å‘å¸ƒæµç¨‹å®Œæ•´ |
| Controller | âš ï¸ éƒ¨åˆ† | 60% | ç¼ºå°‘3ä¸ªç«¯ç‚¹ |

**åç«¯æ€»ä½“è¯„ä»·**: ğŸŸ¢ **åç«¯90%å·²å®Œæˆ**,åªéœ€è¡¥å……3ä¸ªControllerç«¯ç‚¹å³å¯ã€‚

---

## âŒ å‰ç«¯å®ç°çŠ¶æ€åˆ†æ

### 1. ç»„ä»¶æ–‡ä»¶å®šä½

**å·¥ä½œæµç®¡ç†ç»„ä»¶**:
- åˆ—è¡¨ç»„ä»¶: `src/components/70_ai/components/workflow/components/WorkflowList.vue`
- ç¼–è¾‘å¼¹çª—: `src/components/70_ai/components/workflow/dialogs/WorkflowEditDialog.vue`

### 2. WorkflowList.vue åˆ†æ - âŒ æœªä½¿ç”¨æ–°å­—æ®µ

**æ–‡ä»¶å†…å®¹åˆ†æ** (323è¡Œ):

```vue
<!-- Lines 24-58: æˆ‘çš„å·¥ä½œæµåˆ—è¡¨é¡¹ -->
<div v-for="item in myWorkflows" :key="item.workflowUuid" class="workflow-item">
  <div class="item-content">
    <i class="status-icon" :class="item.isPublic ? 'el-icon-share' : 'el-icon-lock'" />
    <span class="item-title">{{ item.title }}</span>
  </div>
  <!-- åªæ˜¾ç¤ºç¼–è¾‘æŒ‰é’® -->
  <el-button type="text" icon="el-icon-edit" @click="handleEdit(item)" />
</div>
```

**é—®é¢˜ç‚¹**:
1. âŒ **æœªæ˜¾ç¤ºåˆ†ç±»**: æ²¡æœ‰æ˜¾ç¤º `category` / `categoryName`
2. âŒ **æœªæ˜¾ç¤ºä¼˜å…ˆçº§**: æ²¡æœ‰æ˜¾ç¤º `priority`
3. âŒ **æœªæ˜¾ç¤ºå‘å¸ƒçŠ¶æ€**: æ²¡æœ‰æ˜¾ç¤º `isEnable` (å·²å‘å¸ƒ/è‰ç¨¿)
4. âŒ **æœªæ˜¾ç¤ºæµ‹è¯•çŠ¶æ€**: æ²¡æœ‰æ˜¾ç¤º `lastTestTime` æ˜¯å¦å­˜åœ¨
5. âŒ **æœªæä¾›åˆ†ç±»ç­›é€‰**: æ²¡æœ‰æŒ‰ `category` ç­›é€‰çš„åŠŸèƒ½

**ç°çŠ¶**: åˆ—è¡¨åªæ˜¾ç¤ºæ ‡é¢˜å’Œå…¬å¼€/ç§æœ‰å›¾æ ‡,ç¼ºå°‘å…³é”®çš„è·¯ç”±ç›¸å…³ä¿¡æ¯å±•ç¤ºã€‚

---

### 3. WorkflowEditDialog.vue åˆ†æ - âŒ å®Œå…¨æœªå®ç°æ–°å­—æ®µ

**æ–‡ä»¶å†…å®¹åˆ†æ** (384è¡Œ):

```vue
<!-- Lines 29-87: è¡¨å•å­—æ®µ -->
<el-form ref="formRef" :model="formData" :rules="rules" label-width="80px">
  <!-- ç¼–è¾‘æ¨¡å¼ -->
  <el-form-item label="æ ‡é¢˜" prop="title">
    <el-input v-model="formData.title" maxlength="100" />
  </el-form-item>

  <el-form-item label="å¤‡æ³¨" prop="remark">
    <el-input v-model="formData.remark" type="textarea" :rows="3" maxlength="500" />
  </el-form-item>

  <el-form-item label="æ˜¯å¦å…¬å¼€">
    <el-switch v-model="formData.isPublic" />
  </el-form-item>
</el-form>
```

**é—®é¢˜ç‚¹**:
1. âŒ **ç¼ºå°‘ desc å­—æ®µ**: åº”è¯¥æ˜¯å¤šè¡Œæ–‡æœ¬æ¡†,ç”¨äºè¯¦ç»†æè¿°å·¥ä½œæµé€‚ç”¨åœºæ™¯
2. âŒ **ç¼ºå°‘ keywords å­—æ®µ**: åº”è¯¥æ˜¯æ ‡ç­¾è¾“å…¥æ¡†,æ”¯æŒé€—å·åˆ†éš”
3. âŒ **ç¼ºå°‘ category å­—æ®µ**: åº”è¯¥æ˜¯å­—å…¸ä¸‹æ‹‰é€‰æ‹©æ¡†
4. âŒ **ç¼ºå°‘ priority å­—æ®µ**: åº”è¯¥æ˜¯æ•°å­—è¾“å…¥æ¡†(0-100)
5. âŒ **ç¼ºå°‘ lastTestTime å±•ç¤º**: åº”è¯¥æ˜¾ç¤ºæœ€åæµ‹è¯•æ—¶é—´(åªè¯»)
6. âŒ **ç¼ºå°‘å‘å¸ƒçŠ¶æ€**: åº”è¯¥æ˜¾ç¤ºæ˜¯å¦å·²å‘å¸ƒ(åªè¯»)
7. âŒ **ç¼ºå°‘æµ‹è¯•æŒ‰é’®**: åº”è¯¥æä¾›"æµ‹è¯•è¿è¡Œ"æŒ‰é’®
8. âŒ **ç¼ºå°‘å‘å¸ƒæŒ‰é’®**: åº”è¯¥æä¾›"å‘å¸ƒ/å–æ¶ˆå‘å¸ƒ"æŒ‰é’®

**æ•°æ®ä¼ é€’** (Lines 236-243):
```javascript
const params = {
  workflowUuid: this.formData.uuid,
  title: this.formData.title,
  remark: this.formData.remark,
  isPublic: this.formData.isPublic,
  dbversion: this.formData.dbversion
}
// âŒ æ²¡æœ‰ä¼ é€’ desc, keywords, category, priority
```

**ç°çŠ¶**: ç¼–è¾‘å¼¹çª—**å®Œå…¨æ²¡æœ‰**æ–°å¢å­—æ®µçš„è¾“å…¥æ§ä»¶,ä»ç„¶æ˜¯è€ç‰ˆæœ¬çš„3ä¸ªå­—æ®µ(title, remark, isPublic)ã€‚

---

### 4. APIå±‚æ£€æŸ¥

éœ€è¦æ£€æŸ¥å‰ç«¯APIæœåŠ¡å±‚æ˜¯å¦å®šä¹‰äº†æ–°æ¥å£:

**é¢„æœŸéœ€è¦çš„APIæ–¹æ³•**:
```javascript
// src/components/70_ai/api/workflow.js (æˆ–ç±»ä¼¼æ–‡ä»¶)

// 1. æµ‹è¯•è¿è¡Œ
export function workflowTest(uuid) {
  return request({ url: `/api/v1/ai/workflow/test/${uuid}`, method: 'post' })
}

// 2. å‘å¸ƒå·¥ä½œæµ
export function workflowPublish(uuid) {
  return request({ url: `/api/v1/ai/workflow/publish/${uuid}`, method: 'post' })
}

// 3. å–æ¶ˆå‘å¸ƒ
export function workflowUnpublish(uuid) {
  return request({ url: `/api/v1/ai/workflow/unpublish/${uuid}`, method: 'post' })
}
```

**çŠ¶æ€**: âš ï¸ éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥APIæ–‡ä»¶,é¢„è®¡ä¹Ÿæœªå®ç°ã€‚

---

### å‰ç«¯å®ç°çŠ¶æ€æ€»ç»“

| ç»„ä»¶ | çŠ¶æ€ | å®Œæˆåº¦ | è¯´æ˜ |
|-----|------|--------|------|
| WorkflowList | âŒ æœªå®ç° | 0% | æœªæ˜¾ç¤ºæ–°å­—æ®µ,æœªæä¾›ç­›é€‰ |
| WorkflowEditDialog | âŒ æœªå®ç° | 0% | å®Œå…¨ç¼ºå°‘5ä¸ªæ–°å­—æ®µçš„è¾“å…¥æ§ä»¶ |
| APIå±‚ | âš ï¸ å¾…ç¡®è®¤ | 0% | é¢„è®¡æœªå®ç°3ä¸ªæ–°æ¥å£ |

**å‰ç«¯æ€»ä½“è¯„ä»·**: ğŸ”´ **å‰ç«¯0%å®ç°**,éœ€è¦ä»é›¶å¼€å§‹æ·»åŠ æ–°å­—æ®µçš„UIå’Œäº¤äº’ã€‚

---

## ğŸ“Š å­—å…¸æ•°æ®é…ç½®çŠ¶æ€

### å­—å…¸ç±»å‹

**æŸ¥è¯¢ç»“æœ**:
```json
{
  "id": 200,
  "code": "ai_workflow_category",
  "name": "AIå·¥ä½œæµåˆ†ç±»",
  "descr": "ç”¨äºå‰ç«¯åˆ—è¡¨é¡µç­›é€‰å’ŒUIå±•ç¤ºçš„å·¥ä½œæµåˆ†ç±»,ä»…ç”¨äºUIç»„ç»‡,ä¸å‚ä¸è·¯ç”±é€»è¾‘"
}
```

### å­—å…¸æ•°æ®

**æŸ¥è¯¢ç»“æœ**:
```json
[
  {
    "id": 894,
    "code": "ai_workflow_category",
    "dict_value": "0",
    "label": "ä¸šåŠ¡å¤„ç†",
    "descr": "SCMè®¢å•ã€é‡‡è´­ã€åº“å­˜ç­‰æ ¸å¿ƒä¸šåŠ¡å¤„ç†",
    "sort": 1,
    "extra1": "1"  // æ³¨æ„: æ­¤å­—æ®µå¯èƒ½è¡¨ç¤º"æ˜¯å¦å¯ä½œä¸ºé»˜è®¤åˆ†ç±»"
  },
  {
    "id": 895,
    "code": "ai_workflow_category",
    "dict_value": "1",
    "label": "çŸ¥è¯†é—®ç­”",
    "descr": "åŸºäºçŸ¥è¯†åº“çš„æ–‡æ¡£æ£€ç´¢å’Œä¸“ä¸šçŸ¥è¯†é—®ç­”",
    "sort": 2,
    "extra1": "0"
  },
  {
    "id": 896,
    "code": "ai_workflow_category",
    "dict_value": "2",
    "label": "é€šç”¨å¯¹è¯",
    "descr": "ä¸€èˆ¬æ€§å¯¹è¯ã€é—²èŠã€å…œåº•åˆ†ç±»",
    "sort": 3,
    "extra1": "0"
  }
]
```

**å­—å…¸æ•°æ®è¯„ä»·**: âœ… **å­—å…¸é…ç½®å®Œæ•´**,3ä¸ªåˆ†ç±»å®šä¹‰æ¸…æ™°,ä¸åç«¯MapperæŸ¥è¯¢é€»è¾‘åŒ¹é…ã€‚

**é‡ç‚¹æ³¨æ„**:
- `category = '2'` (é€šç”¨å¯¹è¯) è¢«ç”¨ä½œé»˜è®¤å…œåº•å·¥ä½œæµçš„åˆ†ç±»
- å­—å…¸çš„ `extra1` å­—æ®µå¯èƒ½æœ‰ç‰¹æ®Šå«ä¹‰(ä¸šåŠ¡å¤„ç†ä¸º"1",å…¶ä»–ä¸º"0")

---

## ğŸ¯ å®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ

### ä¼˜åŒ–æ–¹æ¡ˆ1: åç«¯Controllerç«¯ç‚¹è¡¥å……

**ç›®æ ‡**: è¡¥å……3ä¸ªç¼ºå¤±çš„Controllerç«¯ç‚¹

**å®æ–½æ­¥éª¤**:

#### æ­¥éª¤1: æ–°å¢æµ‹è¯•è¿è¡Œæ¥å£

**æ–‡ä»¶**: `WorkflowController.java`

```java
/**
 * æµ‹è¯•è¿è¡Œå·¥ä½œæµ
 *
 * åŠŸèƒ½: æ‰§è¡Œå·¥ä½œæµæµ‹è¯•è¿è¡Œ,æˆåŠŸåæ›´æ–° last_test_time ä¸ºå½“å‰æ—¶é—´
 *
 * @param uuid å·¥ä½œæµUUID
 * @return æµ‹è¯•æ—¶é—´
 */
@PostMapping("/test/{uuid}")
public ResponseEntity<JsonResultAo<Map<String, Object>>> testWorkflow(@PathVariable String uuid) {
    log.info("æµ‹è¯•è¿è¡Œå·¥ä½œæµ,workflowUuid:{}", uuid);

    try {
        // è°ƒç”¨Serviceæ›´æ–°æµ‹è¯•æ—¶é—´
        workflowService.updateTestTime(uuid);

        // è·å–æ›´æ–°åçš„å·¥ä½œæµä¿¡æ¯
        AiWorkflowEntity workflow = workflowService.getByUuid(uuid);

        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("testTime", workflow.getLastTestTime());
        result.put("message", "æµ‹è¯•è¿è¡ŒæˆåŠŸ");

        return ResponseEntity.ok().body(ResultUtil.OK(result));
    } catch (Exception e) {
        log.error("æµ‹è¯•è¿è¡Œå·¥ä½œæµå¤±è´¥,workflowUuid:{}", uuid, e);
        return ResponseEntity.ok().body(ResultUtil.Fail(e.getMessage()));
    }
}
```

#### æ­¥éª¤2: æ–°å¢å‘å¸ƒå·¥ä½œæµæ¥å£

**æ–‡ä»¶**: `WorkflowController.java`

```java
/**
 * å‘å¸ƒå·¥ä½œæµ
 *
 * åŠŸèƒ½: è®¾ç½®å·¥ä½œæµä¸ºå·²å‘å¸ƒçŠ¶æ€ (is_enable = true)
 *
 * å‘å¸ƒå‰æ ¡éªŒ:
 * 1. lastTestTime != null (å¿…é¡»å…ˆæµ‹è¯•)
 * 2. lastTestTime > uTime (æµ‹è¯•æ—¶é—´å¿…é¡»åœ¨æœ€åä¿®æ”¹æ—¶é—´ä¹‹å)
 *
 * @param uuid å·¥ä½œæµUUID
 * @return å‘å¸ƒç»“æœ
 */
@PostMapping("/publish/{uuid}")
public ResponseEntity<JsonResultAo<Map<String, Object>>> publishWorkflow(@PathVariable String uuid) {
    log.info("å‘å¸ƒå·¥ä½œæµ,workflowUuid:{}", uuid);

    try {
        // è°ƒç”¨Serviceå‘å¸ƒå·¥ä½œæµ(å†…éƒ¨ä¼šæ ¡éªŒæµ‹è¯•æ—¶é—´)
        workflowService.publishWorkflow(uuid);

        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("message", "å‘å¸ƒæˆåŠŸ");

        return ResponseEntity.ok().body(ResultUtil.OK(result));
    } catch (Exception e) {
        log.error("å‘å¸ƒå·¥ä½œæµå¤±è´¥,workflowUuid:{}", uuid, e);

        // è¿”å›å‹å¥½çš„é”™è¯¯æç¤º
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", e.getMessage());

        return ResponseEntity.ok().body(ResultUtil.Fail(result));
    }
}
```

#### æ­¥éª¤3: æ–°å¢å–æ¶ˆå‘å¸ƒæ¥å£

**æ–‡ä»¶**: `WorkflowController.java`

```java
/**
 * å–æ¶ˆå‘å¸ƒå·¥ä½œæµ
 *
 * åŠŸèƒ½: è®¾ç½®å·¥ä½œæµä¸ºè‰ç¨¿çŠ¶æ€ (is_enable = false)
 *
 * @param uuid å·¥ä½œæµUUID
 * @return å–æ¶ˆå‘å¸ƒç»“æœ
 */
@PostMapping("/unpublish/{uuid}")
public ResponseEntity<JsonResultAo<Map<String, Object>>> unpublishWorkflow(@PathVariable String uuid) {
    log.info("å–æ¶ˆå‘å¸ƒå·¥ä½œæµ,workflowUuid:{}", uuid);

    try {
        // è°ƒç”¨Serviceå–æ¶ˆå‘å¸ƒ
        workflowService.unpublishWorkflow(uuid);

        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("message", "å·²å–æ¶ˆå‘å¸ƒ");

        return ResponseEntity.ok().body(ResultUtil.OK(result));
    } catch (Exception e) {
        log.error("å–æ¶ˆå‘å¸ƒå·¥ä½œæµå¤±è´¥,workflowUuid:{}", uuid, e);
        return ResponseEntity.ok().body(ResultUtil.Fail(e.getMessage()));
    }
}
```

**é¢„è®¡å·¥ä½œé‡**: 0.5å°æ—¶(Serviceå±‚å·²å®Œæˆ,åªéœ€æš´éœ²æ¥å£)

---

### ä¼˜åŒ–æ–¹æ¡ˆ2: å‰ç«¯APIå±‚è¡¥å……

**ç›®æ ‡**: æ–°å¢3ä¸ªAPIè°ƒç”¨æ–¹æ³•

**å®æ–½æ­¥éª¤**:

#### æ‰¾åˆ°APIæ–‡ä»¶
éœ€è¦å…ˆç¡®è®¤å·¥ä½œæµAPIæ–‡ä»¶ä½ç½®,é¢„è®¡æ˜¯:
- `src/components/70_ai/api/workflow.js` æˆ–
- `src/api/70_ai/workflow.js`

#### æ–°å¢APIæ–¹æ³•

**æ–‡ä»¶**: `src/components/70_ai/api/workflow.js` (æˆ–å®é™…è·¯å¾„)

```javascript
import request from '@/utils/request'

/**
 * æµ‹è¯•è¿è¡Œå·¥ä½œæµ
 * @param {String} uuid å·¥ä½œæµUUID
 * @returns {Promise}
 */
export function workflowTest(uuid) {
  return request({
    url: `/api/v1/ai/workflow/test/${uuid}`,
    method: 'post'
  })
}

/**
 * å‘å¸ƒå·¥ä½œæµ
 * @param {String} uuid å·¥ä½œæµUUID
 * @returns {Promise}
 */
export function workflowPublish(uuid) {
  return request({
    url: `/api/v1/ai/workflow/publish/${uuid}`,
    method: 'post'
  })
}

/**
 * å–æ¶ˆå‘å¸ƒå·¥ä½œæµ
 * @param {String} uuid å·¥ä½œæµUUID
 * @returns {Promise}
 */
export function workflowUnpublish(uuid) {
  return request({
    url: `/api/v1/ai/workflow/unpublish/${uuid}`,
    method: 'post'
  })
}
```

**é¢„è®¡å·¥ä½œé‡**: 0.2å°æ—¶

---

### ä¼˜åŒ–æ–¹æ¡ˆ3: å‰ç«¯WorkflowListç»„ä»¶ä¼˜åŒ–

**ç›®æ ‡**: åœ¨å·¥ä½œæµåˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°å­—æ®µ,å¹¶æä¾›åˆ†ç±»ç­›é€‰

**å®æ–½æ­¥éª¤**:

#### æ­¥éª¤1: æ·»åŠ åˆ†ç±»ç­›é€‰å™¨

**æ–‡ä»¶**: `WorkflowList.vue`

**ä¿®æ”¹ä½ç½®**: åœ¨ "æ–°å»ºå·¥ä½œæµ" æŒ‰é’®åæ·»åŠ ç­›é€‰å™¨

```vue
<template>
  <div class="workflow-list">
    <el-tabs v-model="activeTab" type="border-card">
      <el-tab-pane label="æˆ‘çš„å·¥ä½œæµ" name="mine">
        <div class="tab-content">
          <div class="action-bar">
            <el-button type="primary" icon="el-icon-plus" size="small" @click="handleCreate">
              æ–°å»ºå·¥ä½œæµ
            </el-button>

            <!-- âœ¨ æ–°å¢: åˆ†ç±»ç­›é€‰ -->
            <el-select
              v-model="categoryFilter"
              placeholder="å…¨éƒ¨åˆ†ç±»"
              clearable
              size="small"
              style="width: 150px; margin-left: 10px;"
              @change="handleCategoryChange"
            >
              <el-option
                v-for="item in categoryOptions"
                :key="item.value"
                :label="item.label"
                :value="item.value"
              />
            </el-select>

            <!-- âœ¨ æ–°å¢: å‘å¸ƒçŠ¶æ€ç­›é€‰ -->
            <el-select
              v-model="publishStatusFilter"
              placeholder="å…¨éƒ¨çŠ¶æ€"
              clearable
              size="small"
              style="width: 150px; margin-left: 10px;"
              @change="handleStatusChange"
            >
              <el-option label="å·²å‘å¸ƒ" value="published" />
              <el-option label="è‰ç¨¿" value="draft" />
            </el-select>
          </div>

          <div v-loading="loadingMine" class="list-container">
            <!-- åˆ—è¡¨å†…å®¹ -->
          </div>
        </div>
      </el-tab-pane>
    </el-tabs>
  </div>
</template>

<script>
export default {
  data() {
    return {
      activeTab: 'mine',
      categoryFilter: null,
      publishStatusFilter: null,
      categoryOptions: [
        { value: '0', label: 'ä¸šåŠ¡å¤„ç†' },
        { value: '1', label: 'çŸ¥è¯†é—®ç­”' },
        { value: '2', label: 'é€šç”¨å¯¹è¯' }
      ]
    }
  },

  computed: {
    // ç­›é€‰åçš„å·¥ä½œæµåˆ—è¡¨
    filteredMyWorkflows() {
      let list = this.myWorkflows

      // æŒ‰åˆ†ç±»ç­›é€‰
      if (this.categoryFilter) {
        list = list.filter(item => item.category === this.categoryFilter)
      }

      // æŒ‰å‘å¸ƒçŠ¶æ€ç­›é€‰
      if (this.publishStatusFilter === 'published') {
        list = list.filter(item => item.isEnable === true)
      } else if (this.publishStatusFilter === 'draft') {
        list = list.filter(item => item.isEnable === false)
      }

      return list
    }
  },

  methods: {
    handleCategoryChange(value) {
      console.log('åˆ†ç±»ç­›é€‰:', value)
      // è§¦å‘åˆ—è¡¨åˆ·æ–°
    },

    handleStatusChange(value) {
      console.log('çŠ¶æ€ç­›é€‰:', value)
      // è§¦å‘åˆ—è¡¨åˆ·æ–°
    }
  }
}
</script>
```

#### æ­¥éª¤2: ä¼˜åŒ–åˆ—è¡¨é¡¹æ˜¾ç¤º

**ä¿®æ”¹ä½ç½®**: åˆ—è¡¨é¡¹æ¨¡æ¿

```vue
<div v-for="item in filteredMyWorkflows" :key="item.workflowUuid" class="workflow-item">
  <div class="item-content">
    <!-- çŠ¶æ€å›¾æ ‡ -->
    <i class="status-icon" :class="getStatusIcon(item)" :title="getStatusTitle(item)" />

    <!-- æ ‡é¢˜ -->
    <span class="item-title">{{ item.title }}</span>

    <!-- âœ¨ æ–°å¢: åˆ†ç±»æ ‡ç­¾ -->
    <el-tag v-if="item.categoryName" size="mini" type="info" class="category-tag">
      {{ item.categoryName }}
    </el-tag>

    <!-- âœ¨ æ–°å¢: å‘å¸ƒçŠ¶æ€æ ‡ç­¾ -->
    <el-tag v-if="item.isEnable" size="mini" type="success" class="status-tag">
      å·²å‘å¸ƒ
    </el-tag>
    <el-tag v-else size="mini" type="info" class="status-tag">
      è‰ç¨¿
    </el-tag>

    <!-- âœ¨ æ–°å¢: ä¼˜å…ˆçº§æ˜¾ç¤º -->
    <span v-if="item.priority" class="priority-badge" :title="`ä¼˜å…ˆçº§: ${item.priority}`">
      P{{ item.priority }}
    </span>
  </div>

  <!-- æ“ä½œæŒ‰é’® -->
  <div v-if="showActions === item.workflowUuid" class="item-actions">
    <el-button type="text" icon="el-icon-edit" size="mini" @click="handleEdit(item)" />
  </div>
</div>
```

#### æ­¥éª¤3: æ·»åŠ è¾…åŠ©æ–¹æ³•

```vue
<script>
export default {
  methods: {
    getStatusIcon(item) {
      if (item.isEnable) {
        return 'el-icon-share'  // å·²å‘å¸ƒ
      } else if (item.lastTestTime) {
        return 'el-icon-circle-check'  // å·²æµ‹è¯•ä½†æœªå‘å¸ƒ
      } else {
        return 'el-icon-edit-outline'  // è‰ç¨¿
      }
    },

    getStatusTitle(item) {
      if (item.isEnable) {
        return 'å·²å‘å¸ƒ'
      } else if (item.lastTestTime) {
        const testTime = this.formatDateTime(item.lastTestTime)
        return `å·²æµ‹è¯• (${testTime})`
      } else {
        return 'è‰ç¨¿ (æœªæµ‹è¯•)'
      }
    },

    formatDateTime(dateTime) {
      if (!dateTime) return '-'
      const date = new Date(dateTime)
      return date.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      })
    }
  }
}
</script>
```

#### æ­¥éª¤4: æ·»åŠ æ ·å¼

```vue
<style lang="scss" scoped>
.workflow-item {
  .item-content {
    display: flex;
    align-items: center;
    gap: 8px;

    .category-tag {
      margin-left: auto;
    }

    .status-tag {
      flex-shrink: 0;
    }

    .priority-badge {
      flex-shrink: 0;
      padding: 2px 6px;
      background-color: #f56c6c;
      color: white;
      font-size: 12px;
      border-radius: 10px;
      font-weight: 500;
    }
  }
}
</style>
```

**é¢„è®¡å·¥ä½œé‡**: 1.5å°æ—¶

---

### ä¼˜åŒ–æ–¹æ¡ˆ4: å‰ç«¯WorkflowEditDialogç»„ä»¶ä¼˜åŒ–

**ç›®æ ‡**: åœ¨ç¼–è¾‘å¼¹çª—ä¸­æ·»åŠ 5ä¸ªæ–°å­—æ®µçš„è¾“å…¥æ§ä»¶

**å®æ–½æ­¥éª¤**:

#### æ­¥éª¤1: æ‰©å±•è¡¨å•æ•°æ®ç»“æ„

**æ–‡ä»¶**: `WorkflowEditDialog.vue`

**ä¿®æ”¹ä½ç½®**: `data()` ä¸­çš„ `formData` å’Œ `rules`

```vue
<script>
export default {
  data() {
    return {
      formData: {
        uuid: '',
        title: '',
        remark: '',
        isPublic: false,
        // âœ¨ æ–°å¢å­—æ®µ
        desc: '',           // è¯¦ç»†æè¿°
        keywords: '',       // å…³é”®è¯(é€—å·åˆ†éš”)
        category: null,     // åˆ†ç±»
        priority: 50,       // ä¼˜å…ˆçº§,é»˜è®¤50
        lastTestTime: null, // æœ€åæµ‹è¯•æ—¶é—´(åªè¯»)
        isEnable: false,    // å‘å¸ƒçŠ¶æ€(åªè¯»)
        userId: null,
        userName: '',
        nodes: [],
        dbversion: null
      },
      rules: {
        title: [
          { required: true, message: 'è¯·è¾“å…¥æ ‡é¢˜', trigger: 'blur' },
          { min: 1, max: 100, message: 'é•¿åº¦åœ¨ 1 åˆ° 100 ä¸ªå­—ç¬¦', trigger: 'blur' }
        ],
        // âœ¨ æ–°å¢æ ¡éªŒè§„åˆ™
        desc: [
          { max: 1000, message: 'è¯¦ç»†æè¿°ä¸èƒ½è¶…è¿‡1000ä¸ªå­—ç¬¦', trigger: 'blur' }
        ],
        keywords: [
          { max: 500, message: 'å…³é”®è¯ä¸èƒ½è¶…è¿‡500ä¸ªå­—ç¬¦', trigger: 'blur' }
        ],
        category: [
          { required: true, message: 'è¯·é€‰æ‹©å·¥ä½œæµåˆ†ç±»', trigger: 'change' }
        ],
        priority: [
          { type: 'number', min: 0, max: 100, message: 'ä¼˜å…ˆçº§èŒƒå›´0-100', trigger: 'blur' }
        ]
      },
      categoryOptions: []  // âœ¨ åˆ†ç±»å­—å…¸é€‰é¡¹
    }
  },

  mounted() {
    // âœ¨ åŠ è½½åˆ†ç±»å­—å…¸
    this.loadCategoryDict()
  },

  methods: {
    async loadCategoryDict() {
      // ä»å­—å…¸æ¥å£è·å–åˆ†ç±»é€‰é¡¹
      try {
        const response = await this.$store.dispatch('dict/loadDict', 'ai_workflow_category')
        this.categoryOptions = response.map(item => ({
          value: item.dict_value,
          label: item.label
        }))
      } catch (error) {
        console.error('åŠ è½½åˆ†ç±»å­—å…¸å¤±è´¥:', error)
      }
    }
  }
}
</script>
```

#### æ­¥éª¤2: æ·»åŠ è¡¨å•æ§ä»¶

**ä¿®æ”¹ä½ç½®**: è¡¨å•åŒºåŸŸ

```vue
<template>
  <el-form ref="formRef" :model="formData" :rules="rules" label-width="100px">
    <!-- ç¼–è¾‘æ¨¡å¼ -->
    <template v-if="viewMode !== 'read'">
      <!-- åŸæœ‰å­—æ®µ -->
      <el-form-item label="æ ‡é¢˜" prop="title">
        <el-input v-model="formData.title" placeholder="å¦‚:ç¿»è¯‘" maxlength="100" show-word-limit />
      </el-form-item>

      <el-form-item label="å¤‡æ³¨" prop="remark">
        <el-input v-model="formData.remark" type="textarea" :rows="2" maxlength="500" show-word-limit />
      </el-form-item>

      <!-- âœ¨ æ–°å¢å­—æ®µ1: è¯¦ç»†æè¿° -->
      <el-form-item label="è¯¦ç»†æè¿°" prop="desc">
        <el-input
          v-model="formData.desc"
          type="textarea"
          :rows="4"
          placeholder="è¯·è¯¦ç»†æè¿°å·¥ä½œæµçš„é€‚ç”¨åœºæ™¯ã€åŠŸèƒ½ã€ä½¿ç”¨é™åˆ¶ç­‰&#10;ç¤ºä¾‹:ä¸“é—¨å¤„ç†ä¾›åº”é“¾ç®¡ç†ç›¸å…³é—®é¢˜,åŒ…æ‹¬è®¢å•æŸ¥è¯¢ã€åº“å­˜ç®¡ç†ç­‰ã€‚&#10;é€‚ç”¨åœºæ™¯:ç”¨æˆ·è¯¢é—®å…·ä½“çš„SCMä¸šåŠ¡æ“ä½œæˆ–æ•°æ®æŸ¥è¯¢ã€‚&#10;ä¸é€‚ç”¨:é€šç”¨çŸ¥è¯†é—®ç­”ã€é—²èŠã€‚"
          maxlength="1000"
          show-word-limit
        />
        <div class="field-hint">
          <i class="el-icon-info" />
          <span>æ­¤æè¿°å°†ä¾›LLMæ™ºèƒ½è·¯ç”±ä½¿ç”¨,è¯·è¯¦ç»†è¯´æ˜å·¥ä½œæµçš„é€‚ç”¨åœºæ™¯å’Œé™åˆ¶</span>
        </div>
      </el-form-item>

      <!-- âœ¨ æ–°å¢å­—æ®µ2: å…³é”®è¯ -->
      <el-form-item label="å…³é”®è¯" prop="keywords">
        <el-input
          v-model="formData.keywords"
          placeholder="è¯·è¾“å…¥å…³é”®è¯,ç”¨é€—å·åˆ†éš”ã€‚ç¤ºä¾‹:è®¢å•,é‡‡è´­,åº“å­˜,å…¥åº“,å‡ºåº“"
          maxlength="500"
          show-word-limit
        />
        <div class="field-hint">
          <i class="el-icon-info" />
          <span>ç”¨äºå¿«é€Ÿè·¯ç”±åŒ¹é…,å¤šä¸ªå…³é”®è¯ç”¨é€—å·åˆ†éš”</span>
        </div>
      </el-form-item>

      <!-- âœ¨ æ–°å¢å­—æ®µ3: å·¥ä½œæµåˆ†ç±» -->
      <el-form-item label="å·¥ä½œæµåˆ†ç±»" prop="category">
        <el-select v-model="formData.category" placeholder="è¯·é€‰æ‹©åˆ†ç±»" style="width: 100%;">
          <el-option
            v-for="item in categoryOptions"
            :key="item.value"
            :label="item.label"
            :value="item.value"
          />
        </el-select>
        <div class="field-hint">
          <i class="el-icon-info" />
          <span>ä»…ç”¨äºå‰ç«¯åˆ—è¡¨ç­›é€‰å’ŒUIå±•ç¤º,ä¸å‚ä¸è·¯ç”±é€»è¾‘</span>
        </div>
      </el-form-item>

      <!-- âœ¨ æ–°å¢å­—æ®µ4: ä¼˜å…ˆçº§ -->
      <el-form-item label="ä¼˜å…ˆçº§" prop="priority">
        <el-input-number
          v-model="formData.priority"
          :min="0"
          :max="100"
          :step="5"
          style="width: 150px;"
        />
        <span style="margin-left: 10px; color: #909399;">æ•°å€¼è¶Šé«˜,è·¯ç”±åŒ¹é…æ—¶è¶Šä¼˜å…ˆ (0-100)</span>
      </el-form-item>

      <!-- åŸæœ‰å­—æ®µ -->
      <el-form-item label="æ˜¯å¦å…¬å¼€">
        <el-switch v-model="formData.isPublic" active-text="æ˜¯" inactive-text="å¦" />
      </el-form-item>

      <!-- âœ¨ æ–°å¢: åªè¯»çŠ¶æ€æ˜¾ç¤º -->
      <el-divider content-position="left">å·¥ä½œæµçŠ¶æ€</el-divider>

      <el-form-item label="å‘å¸ƒçŠ¶æ€">
        <el-tag v-if="formData.isEnable" type="success">å·²å‘å¸ƒ</el-tag>
        <el-tag v-else type="info">è‰ç¨¿</el-tag>
      </el-form-item>

      <el-form-item v-if="formData.lastTestTime" label="æœ€åæµ‹è¯•">
        <span style="color: #67c23a;">
          <i class="el-icon-circle-check" />
          {{ formatDateTime(formData.lastTestTime) }}
        </span>
      </el-form-item>
      <el-form-item v-else label="æœ€åæµ‹è¯•">
        <span style="color: #909399;">
          <i class="el-icon-warning" />
          æœªæµ‹è¯•
        </span>
      </el-form-item>
    </template>

    <!-- æŸ¥çœ‹æ¨¡å¼:åªè¯»ä¿¡æ¯ -->
    <div v-if="viewMode === 'read'" class="read-content">
      <!-- åŸæœ‰åªè¯»å­—æ®µ -->
      <div class="info-item">
        <span class="label">æ ‡é¢˜:</span>
        <span class="value">{{ formData.title }}</span>
      </div>
      <div class="info-item">
        <span class="label">å¤‡æ³¨:</span>
        <span class="value">{{ formData.remark || 'æ— ' }}</span>
      </div>

      <!-- âœ¨ æ–°å¢åªè¯»å­—æ®µ -->
      <div class="info-item">
        <span class="label">è¯¦ç»†æè¿°:</span>
        <pre class="value desc-content">{{ formData.desc || 'æ— ' }}</pre>
      </div>
      <div class="info-item">
        <span class="label">å…³é”®è¯:</span>
        <span class="value">
          <el-tag v-for="(keyword, index) in getKeywordList(formData.keywords)" :key="index" size="mini" style="margin-right: 5px;">
            {{ keyword }}
          </el-tag>
          <span v-if="!formData.keywords">æ— </span>
        </span>
      </div>
      <div class="info-item">
        <span class="label">åˆ†ç±»:</span>
        <span class="value">{{ getCategoryLabel(formData.category) }}</span>
      </div>
      <div class="info-item">
        <span class="label">ä¼˜å…ˆçº§:</span>
        <span class="value">{{ formData.priority }}</span>
      </div>

      <div class="info-item">
        <span class="label">æ˜¯å¦å…¬å¼€:</span>
        <span class="value">{{ formData.isPublic ? 'æ˜¯' : 'å¦' }}</span>
      </div>
      <div class="info-item">
        <span class="label">å‘å¸ƒçŠ¶æ€:</span>
        <el-tag v-if="formData.isEnable" type="success" size="small">å·²å‘å¸ƒ</el-tag>
        <el-tag v-else type="info" size="small">è‰ç¨¿</el-tag>
      </div>
      <div class="info-item">
        <span class="label">æœ€åæµ‹è¯•:</span>
        <span class="value">{{ formatDateTime(formData.lastTestTime) }}</span>
      </div>
    </div>
  </el-form>
</template>
```

#### æ­¥éª¤3: ä¿®æ”¹æ•°æ®ä¼ é€’é€»è¾‘

**ä¿®æ”¹ä½ç½®**: `watch` ç›‘å¬å™¨å’Œä¿å­˜æ–¹æ³•

```vue
<script>
export default {
  watch: {
    createOrEditWfUuid: {
      immediate: true,
      handler(val) {
        if (val) {
          const workflow = this.$store.getters['ai/workflow/getWorkflowInfo'](val)
          if (workflow) {
            this.formData = {
              uuid: workflow.workflowUuid,
              title: workflow.title,
              remark: workflow.remark,
              isPublic: workflow.isPublic,
              // âœ¨ æ–°å¢å­—æ®µæ•°æ®ç»‘å®š
              desc: workflow.desc || '',
              keywords: workflow.keywords || '',
              category: workflow.category,
              priority: workflow.priority || 50,
              lastTestTime: workflow.lastTestTime,
              isEnable: workflow.isEnable || false,
              userId: workflow.userId,
              userName: workflow.userName,
              nodes: workflow.nodes || [],
              dbversion: workflow.dbversion
            }
          }
        } else {
          this.formData = this.getEmptyFormData()
        }
      }
    }
  },

  methods: {
    getEmptyFormData() {
      return {
        uuid: '',
        title: '',
        remark: '',
        isPublic: false,
        desc: '',
        keywords: '',
        category: null,
        priority: 50,
        lastTestTime: null,
        isEnable: false,
        userId: null,
        userName: '',
        nodes: [],
        dbversion: null
      }
    },

    async handleSave() {
      try {
        await this.$refs.formRef.validate()
      } catch (error) {
        return
      }

      if (this.saving) return

      this.saving = true
      const params = {
        workflowUuid: this.formData.uuid,
        title: this.formData.title,
        remark: this.formData.remark,
        isPublic: this.formData.isPublic,
        // âœ¨ æ–°å¢å­—æ®µä¼ é€’
        desc: this.formData.desc,
        keywords: this.formData.keywords,
        category: this.formData.category,
        priority: this.formData.priority,
        dbversion: this.formData.dbversion
      }

      try {
        if (!this.formData.uuid) {
          const response = await workflowAdd(params)
          this.addWorkflowAndActive(response.data)
          this.$message.success('å·¥ä½œæµåˆ›å»ºæˆåŠŸ')
        } else {
          const response = await workflowBaseInfoUpdate(params)
          this.updateBaseInfo({ uuid: this.formData.uuid, workflow: response.data })
          this.$message.success('å·¥ä½œæµæ›´æ–°æˆåŠŸ')
        }
        this.handleClose()
      } catch (error) {
        console.error('ä¿å­˜å·¥ä½œæµå¤±è´¥:', error)
        this.$message.error(error.message || 'ä¿å­˜å¤±è´¥')
      } finally {
        this.saving = false
      }
    },

    // âœ¨ æ–°å¢è¾…åŠ©æ–¹æ³•
    getKeywordList(keywords) {
      if (!keywords) return []
      return keywords.split(',').map(k => k.trim()).filter(k => k)
    },

    getCategoryLabel(categoryValue) {
      const option = this.categoryOptions.find(item => item.value === categoryValue)
      return option ? option.label : 'æœªåˆ†ç±»'
    },

    formatDateTime(dateTime) {
      if (!dateTime) return '-'
      const date = new Date(dateTime)
      return date.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      })
    }
  }
}
</script>
```

#### æ­¥éª¤4: æ·»åŠ æµ‹è¯•å’Œå‘å¸ƒæŒ‰é’®

**ä¿®æ”¹ä½ç½®**: footer åŒºåŸŸ

```vue
<div slot="footer" class="dialog-footer">
  <template v-if="viewMode !== 'read'">
    <!-- âœ¨ æ–°å¢: æµ‹è¯•è¿è¡ŒæŒ‰é’® -->
    <el-button
      v-if="formData.uuid"
      type="warning"
      icon="el-icon-video-play"
      :loading="testing"
      @click="handleTest"
    >
      æµ‹è¯•è¿è¡Œ
    </el-button>

    <!-- âœ¨ æ–°å¢: å‘å¸ƒ/å–æ¶ˆå‘å¸ƒæŒ‰é’® -->
    <el-button
      v-if="formData.uuid && !formData.isEnable"
      type="success"
      icon="el-icon-upload"
      :loading="publishing"
      :disabled="!formData.lastTestTime"
      @click="handlePublish"
    >
      å‘å¸ƒ
    </el-button>
    <el-button
      v-if="formData.uuid && formData.isEnable"
      type="warning"
      icon="el-icon-download"
      :loading="unpublishing"
      @click="handleUnpublish"
    >
      å–æ¶ˆå‘å¸ƒ
    </el-button>

    <!-- åŸæœ‰æŒ‰é’® -->
    <el-button v-if="formData.uuid" type="danger" plain @click="handleDelete">åˆ é™¤</el-button>
    <el-button @click="handleClose">å–æ¶ˆ</el-button>
    <el-button type="primary" :loading="saving" @click="handleSave">
      {{ formData.uuid ? 'æ›´æ–°' : 'æ–°å¢' }}
    </el-button>
  </template>
  <template v-else>
    <el-button type="primary" @click="handleClose">å…³é—­</el-button>
  </template>
</div>
```

#### æ­¥éª¤5: å®ç°æµ‹è¯•å’Œå‘å¸ƒæ–¹æ³•

```vue
<script>
import { workflowTest, workflowPublish, workflowUnpublish } from '@/components/70_ai/api/workflow'

export default {
  data() {
    return {
      testing: false,
      publishing: false,
      unpublishing: false
    }
  },

  methods: {
    // âœ¨ æµ‹è¯•è¿è¡Œ
    async handleTest() {
      if (this.testing) return

      this.testing = true
      try {
        const response = await workflowTest(this.formData.uuid)
        if (response.success) {
          this.formData.lastTestTime = response.testTime
          this.$message.success('æµ‹è¯•è¿è¡ŒæˆåŠŸ')
        } else {
          this.$message.error(response.message || 'æµ‹è¯•è¿è¡Œå¤±è´¥')
        }
      } catch (error) {
        console.error('æµ‹è¯•è¿è¡Œå¤±è´¥:', error)
        this.$message.error(error.message || 'æµ‹è¯•è¿è¡Œå¤±è´¥')
      } finally {
        this.testing = false
      }
    },

    // âœ¨ å‘å¸ƒå·¥ä½œæµ
    async handlePublish() {
      if (this.publishing) return

      // äºŒæ¬¡ç¡®è®¤
      try {
        await this.$confirm('ç¡®å®šè¦å‘å¸ƒè¿™ä¸ªå·¥ä½œæµå—?å‘å¸ƒåå°†å¯¹ç”¨æˆ·å¯è§ã€‚', 'ç¡®è®¤å‘å¸ƒ', {
          confirmButtonText: 'ç¡®å®š',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning'
        })
      } catch {
        return
      }

      this.publishing = true
      try {
        const response = await workflowPublish(this.formData.uuid)
        if (response.success) {
          this.formData.isEnable = true
          this.$message.success('å‘å¸ƒæˆåŠŸ')
          // åˆ·æ–°åˆ—è¡¨
          this.$store.dispatch('ai/workflow/loadMyWorkflows')
        } else {
          this.$message.error(response.message || 'å‘å¸ƒå¤±è´¥')
        }
      } catch (error) {
        console.error('å‘å¸ƒå¤±è´¥:', error)
        this.$message.error(error.message || 'å‘å¸ƒå¤±è´¥')
      } finally {
        this.publishing = false
      }
    },

    // âœ¨ å–æ¶ˆå‘å¸ƒ
    async handleUnpublish() {
      if (this.unpublishing) return

      // äºŒæ¬¡ç¡®è®¤
      try {
        await this.$confirm('ç¡®å®šè¦å–æ¶ˆå‘å¸ƒå—?å–æ¶ˆåç”¨æˆ·å°†æ— æ³•ä½¿ç”¨æ­¤å·¥ä½œæµã€‚', 'ç¡®è®¤å–æ¶ˆå‘å¸ƒ', {
          confirmButtonText: 'ç¡®å®š',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning'
        })
      } catch {
        return
      }

      this.unpublishing = true
      try {
        const response = await workflowUnpublish(this.formData.uuid)
        if (response.success) {
          this.formData.isEnable = false
          this.$message.success('å·²å–æ¶ˆå‘å¸ƒ')
          // åˆ·æ–°åˆ—è¡¨
          this.$store.dispatch('ai/workflow/loadMyWorkflows')
        } else {
          this.$message.error(response.message || 'å–æ¶ˆå‘å¸ƒå¤±è´¥')
        }
      } catch (error) {
        console.error('å–æ¶ˆå‘å¸ƒå¤±è´¥:', error)
        this.$message.error(error.message || 'å–æ¶ˆå‘å¸ƒå¤±è´¥')
      } finally {
        this.unpublishing = false
      }
    }
  }
}
</script>
```

#### æ­¥éª¤6: æ·»åŠ æ ·å¼

```vue
<style lang="scss" scoped>
.field-hint {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 4px;
  font-size: 12px;
  color: #909399;

  i {
    font-size: 14px;
  }
}

.read-content {
  .info-item {
    margin-bottom: 16px;
    line-height: 1.8;

    .label {
      font-weight: 500;
      color: #606266;
      margin-right: 8px;
    }

    .value {
      color: #303133;
    }

    .desc-content {
      white-space: pre-wrap;
      font-family: inherit;
      margin: 0;
      padding: 10px;
      background-color: #f5f7fa;
      border-radius: 4px;
    }
  }
}
</style>
```

**é¢„è®¡å·¥ä½œé‡**: 3å°æ—¶

---

## ğŸ“ å®æ–½ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€é˜¶æ®µ: åç«¯è¡¥å…¨ (0.5å°æ—¶)
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜

1. è¡¥å…… `WorkflowController.java` çš„3ä¸ªç«¯ç‚¹
   - æµ‹è¯•è¿è¡Œæ¥å£
   - å‘å¸ƒæ¥å£
   - å–æ¶ˆå‘å¸ƒæ¥å£

**ç†ç”±**: åç«¯90%å·²å®Œæˆ,åªéœ€æš´éœ²æ¥å£å³å¯,æ˜¯å‰ç«¯å¼€å‘çš„å‰ç½®ä¾èµ–ã€‚

---

### ç¬¬äºŒé˜¶æ®µ: å‰ç«¯APIå±‚ (0.2å°æ—¶)
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜

1. æ–°å¢3ä¸ªAPIè°ƒç”¨æ–¹æ³•
   - `workflowTest()`
   - `workflowPublish()`
   - `workflowUnpublish()`

**ç†ç”±**: å‰ç«¯ç»„ä»¶å¼€å‘çš„åŸºç¡€è®¾æ–½ã€‚

---

### ç¬¬ä¸‰é˜¶æ®µ: ç¼–è¾‘å¼¹çª—ä¼˜åŒ– (3å°æ—¶)
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜

1. æ‰©å±•è¡¨å•æ•°æ®ç»“æ„
2. æ·»åŠ 5ä¸ªæ–°å­—æ®µçš„è¾“å…¥æ§ä»¶
3. å®ç°æµ‹è¯•å’Œå‘å¸ƒåŠŸèƒ½
4. æ·»åŠ æ ·å¼å’Œæç¤º

**ç†ç”±**: è¿™æ˜¯ç”¨æˆ·é…ç½®å·¥ä½œæµè·¯ç”±ä¿¡æ¯çš„æ ¸å¿ƒå…¥å£,ç›´æ¥å½±å“æ™ºèƒ½è·¯ç”±åŠŸèƒ½çš„å¯ç”¨æ€§ã€‚

---

### ç¬¬å››é˜¶æ®µ: åˆ—è¡¨ç»„ä»¶ä¼˜åŒ– (1.5å°æ—¶)
**ä¼˜å…ˆçº§**: ğŸŸ¢ ä¸­

1. æ·»åŠ åˆ†ç±»ç­›é€‰å’ŒçŠ¶æ€ç­›é€‰
2. ä¼˜åŒ–åˆ—è¡¨é¡¹æ˜¾ç¤º(æ˜¾ç¤ºåˆ†ç±»ã€çŠ¶æ€ã€ä¼˜å…ˆçº§)
3. æ·»åŠ æ ·å¼

**ç†ç”±**: æå‡ç”¨æˆ·ä½“éªŒ,æ–¹ä¾¿ç®¡ç†å¤§é‡å·¥ä½œæµã€‚

---

## ğŸ“ æ€»ç»“

### å®Œæ•´åº¦è¯„ä¼°

| æ¨¡å— | å®Œæˆåº¦ | çŠ¶æ€ | ç¼ºå¤±å†…å®¹ |
|------|--------|------|----------|
| **åç«¯** | 90% | ğŸŸ¢ è‰¯å¥½ | ç¼ºå°‘3ä¸ªControllerç«¯ç‚¹ |
| - Entityå±‚ | 100% | âœ… å®Œæˆ | - |
| - VOå±‚ | 100% | âœ… å®Œæˆ | - |
| - Mapperå±‚ | 120% | âœ… è¶…é¢„æœŸ | - |
| - Serviceå±‚ | 100% | âœ… å®Œæˆ | - |
| - Controllerå±‚ | 60% | âš ï¸ éƒ¨åˆ† | test/publish/unpublishç«¯ç‚¹ |
| **å‰ç«¯** | 0% | ğŸ”´ æœªå¼€å§‹ | å…¨éƒ¨UIå’Œäº¤äº’ |
| - APIå±‚ | 0% | âŒ æœªå®ç° | 3ä¸ªæ–°æ¥å£ |
| - åˆ—è¡¨ç»„ä»¶ | 0% | âŒ æœªå®ç° | ç­›é€‰å™¨ã€å­—æ®µæ˜¾ç¤º |
| - ç¼–è¾‘å¼¹çª— | 0% | âŒ æœªå®ç° | 5ä¸ªå­—æ®µæ§ä»¶ã€æµ‹è¯•/å‘å¸ƒæŒ‰é’® |
| **å­—å…¸æ•°æ®** | 100% | âœ… å®Œæˆ | - |

### å…³é”®å‘ç°

#### âœ… åç«¯å®ç°äº®ç‚¹:
1. **Mapperå±‚è¶…é¢„æœŸ**: å·²å®ç°4ä¸ªæ–°æŸ¥è¯¢æ–¹æ³•,åŒ…å«å®Œæ•´çš„å­—å…¸å…³è”æŸ¥è¯¢
2. **Serviceå±‚å®Œæ•´**: ä¸ä»…æœ‰CRUD,è¿˜æœ‰å®Œæ•´çš„å·¥ä½œæµç”Ÿå‘½å‘¨æœŸç®¡ç†(è‰ç¨¿â†’æµ‹è¯•â†’å‘å¸ƒ)
3. **å‘å¸ƒé€»è¾‘ä¸¥è°¨**: å¼ºåˆ¶æµ‹è¯•åæ‰èƒ½å‘å¸ƒ,ä¿®æ”¹åéœ€é‡æ–°æµ‹è¯•
4. **å­—å…¸é…ç½®å®Œæ•´**: 3ä¸ªåˆ†ç±»å®šä¹‰æ¸…æ™°,ç¬¦åˆè·¯ç”±é€»è¾‘

#### âŒ å‰ç«¯å®ç°ç¼ºå¤±:
1. **ç¼–è¾‘å¼¹çª—**: å®Œå…¨æ²¡æœ‰5ä¸ªæ–°å­—æ®µçš„è¾“å…¥æ§ä»¶
2. **åˆ—è¡¨ç»„ä»¶**: æœªæ˜¾ç¤ºåˆ†ç±»ã€ä¼˜å…ˆçº§ã€å‘å¸ƒçŠ¶æ€ç­‰å…³é”®ä¿¡æ¯
3. **ç­›é€‰åŠŸèƒ½**: æœªæä¾›åˆ†ç±»å’Œå‘å¸ƒçŠ¶æ€ç­›é€‰
4. **å‘å¸ƒæµç¨‹**: æœªæä¾›æµ‹è¯•è¿è¡Œå’Œå‘å¸ƒ/å–æ¶ˆå‘å¸ƒåŠŸèƒ½

### å·¥ä½œé‡è¯„ä¼°

| é˜¶æ®µ | å·¥ä½œå†…å®¹ | é¢„è®¡æ—¶é—´ | ä¼˜å…ˆçº§ |
|------|----------|----------|--------|
| ç¬¬ä¸€é˜¶æ®µ | åç«¯Controllerè¡¥å……3ä¸ªç«¯ç‚¹ | 0.5å°æ—¶ | ğŸ”´ æœ€é«˜ |
| ç¬¬äºŒé˜¶æ®µ | å‰ç«¯APIå±‚æ–°å¢3ä¸ªæ–¹æ³• | 0.2å°æ—¶ | ğŸŸ¡ é«˜ |
| ç¬¬ä¸‰é˜¶æ®µ | ç¼–è¾‘å¼¹çª—å®Œæ•´ä¼˜åŒ– | 3å°æ—¶ | ğŸŸ¡ é«˜ |
| ç¬¬å››é˜¶æ®µ | åˆ—è¡¨ç»„ä»¶ä¼˜åŒ– | 1.5å°æ—¶ | ğŸŸ¢ ä¸­ |
| **æ€»è®¡** | | **5.2å°æ—¶** | |

### å®æ–½å»ºè®®

1. **ä¼˜å…ˆå®Œæˆåç«¯**: åç«¯åªéœ€0.5å°æ—¶å³å¯å®Œæˆ,æ˜¯å‰ç«¯å¼€å‘çš„åŸºç¡€
2. **èšç„¦ç¼–è¾‘å¼¹çª—**: è¿™æ˜¯ç”¨æˆ·é…ç½®è·¯ç”±ä¿¡æ¯çš„æ ¸å¿ƒå…¥å£,åº”ä¼˜å…ˆå®ç°
3. **åˆ—è¡¨ä¼˜åŒ–å¯å»¶å**: åˆ—è¡¨ä¼˜åŒ–ä¸»è¦æ˜¯ä½“éªŒæå‡,å¯ä»¥åœ¨æ ¸å¿ƒåŠŸèƒ½å®Œæˆåå†åš
4. **åˆ†é˜¶æ®µæµ‹è¯•**: æ¯å®Œæˆä¸€ä¸ªé˜¶æ®µå°±è¿›è¡Œæµ‹è¯•,ç¡®ä¿åŠŸèƒ½æ­£ç¡®

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-12
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0
**è°ƒç ”èŒƒå›´**: åç«¯(Entity/VO/Mapper/Service/Controller) + å‰ç«¯(List/EditDialog) + å­—å…¸æ•°æ®

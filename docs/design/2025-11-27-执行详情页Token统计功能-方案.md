# æ‰§è¡Œè¯¦æƒ…é¡µTokenç»Ÿè®¡åŠŸèƒ½ - æŠ€æœ¯æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–¹æ¡ˆåç§° | æ‰§è¡Œè¯¦æƒ…é¡µTokenç»Ÿè®¡åŠŸèƒ½å¢å¼º |
| åˆ›å»ºæ—¥æœŸ | 2025-11-27 |
| æ–¹æ¡ˆçŠ¶æ€ | ğŸŸ¡ å¾…å®¡æ‰¹ |
| å¤æ‚åº¦è¯„çº§ | ğŸŸ¢ ç®€å• (æ–°å¢æŸ¥è¯¢API + å‰ç«¯å±•ç¤º) |
| é¢„è®¡å·¥æœŸ | 4å°æ—¶ |

## ğŸ¯ é—®é¢˜èƒŒæ™¯

### å½“å‰é—®é¢˜

**é—®é¢˜1: æ‰§è¡Œæ—¶é•¿æ˜¾ç¤ºä¸º"-"**
- âœ… **å·²è§£å†³**: é€šè¿‡ä¿®å¤MyBatiså­—æ®µæ˜ å°„é—®é¢˜,å·²åœ¨é˜¶æ®µ2å®Œæˆ
- ä¿®æ”¹å†…å®¹: VOå­—æ®µæ”¹ä¸ºcamelCase + @JsonProperty + Mapperä½¿ç”¨ASåˆ«å

**é—®é¢˜2: ç¼ºå°‘Tokenæ¶ˆè€—ç»Ÿè®¡**
- âŒ **æœªè§£å†³**: æ‰§è¡Œè¯¦æƒ…é¡µé¢æ— æ³•æŸ¥çœ‹Tokenæ¶ˆè€—æƒ…å†µ
- å½±å“: ç”¨æˆ·æ— æ³•äº†è§£LLMè°ƒç”¨æˆæœ¬

### ç”¨æˆ·éœ€æ±‚

**åŸºæœ¬ä¿¡æ¯åŒºåŸŸå¢å¼º**:
1. âœ… ä¿®å¤æ‰§è¡Œæ—¶é•¿è®¡ç®— (å·²å®Œæˆ)
2. â³ ä¿®æ”¹"å·¥ä½œæµåç§°"ä¸º"æ¶ˆæ¯ID" - æ˜¾ç¤º`ai_conversation_content.id`
3. â³ åˆå¹¶å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´æ˜¾ç¤º
4. â³ æ–°å¢"æ€»Tokenæ¶ˆè€—" - `SUM(ai_token_usage.total_tokens)`,å¸¦åƒåˆ†ç¬¦

**èŠ‚ç‚¹è¯¦æƒ…å¢å¼º**:
1. â³ æ˜¾ç¤ºèŠ‚ç‚¹Tokenæ¶ˆè€—: `æ‰§è¡Œæ—¶é—´: 2025/11/27 13:56:25  æ¶ˆè€—tokens: 1,234`
2. â³ ä»…LLMèŠ‚ç‚¹æ˜¾ç¤ºTokenä¿¡æ¯

## ğŸ” é˜¶æ®µ3æ•°æ®æ”¶é›†ç»“æœ

### 1. formatNumberå®ç° (commonFunction.js)

```javascript
// å·²å­˜åœ¨çš„å…¨å±€æ–¹æ³•,æ— éœ€æ–°å»º
Vue.prototype.formatNumber = function (data, decimal = false, decimalDigits = 2) {
  if (data == null || data === '' || isNaN(data)) {
    return null
  }
  const num = Number(data)
  if (isNaN(num)) {
    return null
  }
  try {
    return num.toLocaleString('zh-CN', {
      style: 'decimal',
      minimumFractionDigits: decimal ? Math.min(decimalDigits, 4) : 0,
      maximumFractionDigits: 4
    })
  } catch (error) {
    return decimal ? num.toFixed(Math.min(decimalDigits, 4)) : num.toString()
  }
}
```

**ä½¿ç”¨æ–¹å¼**:
```javascript
this.formatNumber(1234567) // è¾“å‡º: "1,234,567"
```

### 2. ai_token_usageè¡¨ç»“æ„

```sql
CREATE TABLE `ai_token_usage` (
  `id` varchar(36) NOT NULL COMMENT 'ä¸»é”®UUID',
  `conversation_id` varchar(100) DEFAULT NULL COMMENT 'å¯¹è¯ID',
  `serial_type` varchar(50) NOT NULL COMMENT 'ä¸šåŠ¡ç±»å‹:ai_conversation_runtime_node/ai_workflow_runtime_node',
  `serial_id` varchar(100) NOT NULL COMMENT 'ä¸šåŠ¡è®°å½•ID',
  `model_source_id` varchar(100) DEFAULT NULL COMMENT 'æ¨¡å‹æºID',
  `user_id` varchar(50) DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `provider_name` varchar(50) DEFAULT NULL COMMENT 'AIæä¾›å•†',
  `model_type` varchar(100) DEFAULT NULL COMMENT 'AIæ¨¡å‹ç±»å‹',
  `prompt_tokens` bigint DEFAULT '0' COMMENT 'è¾“å…¥Tokenæ•°',
  `completion_tokens` bigint DEFAULT '0' COMMENT 'è¾“å‡ºTokenæ•°',
  `total_tokens` bigint GENERATED ALWAYS AS (prompt_tokens + completion_tokens) STORED COMMENT 'æ€»Tokenæ•°',
  `success` tinyint(1) DEFAULT '1' COMMENT 'æ˜¯å¦æˆåŠŸ',
  `response_time` bigint DEFAULT '0' COMMENT 'å“åº”æ—¶é—´(ms)',
  `usage_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'ä½¿ç”¨æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_ai_token_usage_serial` (`serial_type`,`serial_id`),
  KEY `idx_ai_token_usage_conversation` (`conversation_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**å…³é”®ç‚¹**:
- `total_tokens`æ˜¯GENERATEDåˆ—,è‡ªåŠ¨è®¡ç®—
- ç´¢å¼•`idx_ai_token_usage_serial`æ”¯æŒé«˜æ•ˆæŸ¥è¯¢
- `serial_type = 'ai_conversation_runtime_node'`ç”¨äºèŠ‚ç‚¹çº§åˆ«è·Ÿè¸ª

### 3. MessageList.vueæ•°æ®æµ

```javascript
// Line 607-643
async showExecutionDetail (message) {
  const runtimeUuid = message.workflowRuntime.uuid

  // âœ… message.idå³ä¸ºai_conversation_content.id (éœ€è¦ä¼ é€’ç»™dialog)

  // è·å–runtimeè¯¦æƒ…
  const runtimeDetail = await aiChatService.getConversationRuntimeDetail(runtimeUuid)
  this.currentRuntimeDetail = runtimeDetail

  // è·å–èŠ‚ç‚¹è¯¦æƒ…
  const nodes = await aiChatService.getConversationRuntimeNodeDetails(runtimeUuid)
  this.currentNodes = nodes
}
```

**æ•°æ®ç»“æ„**:
```javascript
message = {
  id: 123,  // ai_conversation_content.id - éœ€è¦æ˜¾ç¤ºä¸º"æ¶ˆæ¯ID"
  content: "...",
  timestamp: "...",
  workflowRuntime: {
    uuid: "abc123",  // ç”¨äºæŸ¥è¯¢runtimeè¯¦æƒ…
    ...
  }
}
```

## ğŸ¨ æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆåŸåˆ™

**KISSåŸåˆ™è¯„ä¼°**:
1. â“ è¿™æ˜¯çœŸé—®é¢˜å—? â†’ âœ… æ˜¯çš„,ç”¨æˆ·éœ€è¦äº†è§£Tokenæˆæœ¬
2. â“ æœ‰æ›´ç®€å•çš„æ–¹æ³•å—? â†’ âœ… ä½¿ç”¨ç°æœ‰formatNumber(),æ–°å¢ç®€å•æŸ¥è¯¢API
3. â“ ä¼šç ´åä»€ä¹ˆå—? â†’ âœ… ä¸ä¼š,çº¯æ–°å¢åŠŸèƒ½,é›¶ç ´åæ€§
4. â“ å½“å‰é¡¹ç›®çœŸçš„éœ€è¦å—? â†’ âœ… æ˜¯çš„,Tokenæˆæœ¬æ˜¯AIåº”ç”¨çš„æ ¸å¿ƒå…³æ³¨ç‚¹

**æ•°æ®ç»“æ„åˆ†æ**:
- æ ¸å¿ƒæ•°æ®: ai_token_usageè¡¨å·²å­˜åœ¨
- æ•°æ®æµ: runtime â†’ runtime_node â†’ token_usage (æ¸…æ™°çš„å±‚çº§å…³ç³»)
- æ— éœ€æ•°æ®å¤åˆ¶æˆ–è½¬æ¢

**å¤æ‚åº¦å®¡æŸ¥**:
- åŠŸèƒ½æœ¬è´¨: èšåˆæŸ¥è¯¢ + å‰ç«¯å±•ç¤º
- æ–¹æ¡ˆæ¦‚å¿µæ•°: 2ä¸ª (æ€»Tokenèšåˆ + èŠ‚ç‚¹TokenæŸ¥è¯¢)
- å¯ä»¥æ›´ç®€å•å—? â†’ å·²ç»æ˜¯æœ€ç®€æ–¹æ¡ˆ

### åç«¯å®ç°

#### 1. æ–°å¢Serviceæ–¹æ³• (AiTokenUsageService.java)

```java
/**
 * æ ¹æ®runtime_uuidè·å–æ€»Tokenæ¶ˆè€—
 *
 * @param runtimeUuid è¿è¡Œå®ä¾‹UUID
 * @return æ€»Tokenæ•°,å¦‚æœæ— è®°å½•è¿”å›null
 */
public Long getTotalTokensByRuntimeUuid(String runtimeUuid) {
    // 1. æ ¹æ®runtime_uuidæŸ¥è¯¢runtime_id
    AiConversationRuntimeEntity runtime = conversationRuntimeMapper.selectOne(
        new LambdaQueryWrapper<AiConversationRuntimeEntity>()
            .eq(AiConversationRuntimeEntity::getRuntimeUuid, runtimeUuid)
            .last("LIMIT 1")
    );

    if (runtime == null) {
        return null;
    }

    // 2. æŸ¥è¯¢è¯¥runtimeä¸‹æ‰€æœ‰èŠ‚ç‚¹çš„IDåˆ—è¡¨
    List<Long> nodeIds = conversationRuntimeNodeMapper.selectIdsByRuntimeId(runtime.getId());

    if (nodeIds.isEmpty()) {
        return null;
    }

    // 3. èšåˆæŸ¥è¯¢Tokenæ€»æ•°
    return aiTokenUsageMapper.selectOne(
        new QueryWrapper<AiTokenUsageEntity>()
            .select("SUM(total_tokens) as total_tokens")
            .eq("serial_type", "ai_conversation_runtime_node")
            .in("serial_id", nodeIds.stream().map(String::valueOf).collect(Collectors.toList()))
    ).getTotalTokens(); // MyBatis-Plusä¼šè‡ªåŠ¨æ˜ å°„SUMç»“æœåˆ°total_tokenså­—æ®µ
}

/**
 * æ ¹æ®èŠ‚ç‚¹IDè·å–Tokenæ¶ˆè€—è¯¦æƒ…
 *
 * @param nodeId èŠ‚ç‚¹ID
 * @return Tokenæ¶ˆè€—VO,å¦‚æœæ— è®°å½•è¿”å›null
 */
public NodeTokenUsageVo getNodeTokenUsage(Long nodeId) {
    AiTokenUsageEntity entity = aiTokenUsageMapper.selectOne(
        new LambdaQueryWrapper<AiTokenUsageEntity>()
            .eq(AiTokenUsageEntity::getSerialType, "ai_conversation_runtime_node")
            .eq(AiTokenUsageEntity::getSerialId, String.valueOf(nodeId))
            .last("LIMIT 1")
    );

    if (entity == null) {
        return null;
    }

    NodeTokenUsageVo vo = new NodeTokenUsageVo();
    vo.setPromptTokens(entity.getPromptTokens());
    vo.setCompletionTokens(entity.getCompletionTokens());
    vo.setTotalTokens(entity.getTotalTokens());
    return vo;
}
```

#### 2. æ–°å¢VOç±» (NodeTokenUsageVo.java)

```java
package com.xinyirun.scm.ai.bean.vo.chat;

import lombok.Data;

/**
 * èŠ‚ç‚¹Tokenæ¶ˆè€—VO
 */
@Data
public class NodeTokenUsageVo {
    /**
     * è¾“å…¥Tokenæ•°
     */
    private Long promptTokens;

    /**
     * è¾“å‡ºTokenæ•°
     */
    private Long completionTokens;

    /**
     * æ€»Tokenæ•°
     */
    private Long totalTokens;
}
```

#### 3. ä¿®æ”¹ç°æœ‰VOç±»

**AiConversationRuntimeVo.java**:
```java
/**
 * æ€»Tokenæ¶ˆè€—(ä»ai_token_usageæ±‡æ€»)
 */
private Long totalTokens;
```

**AiConversationRuntimeNodeVo.java**:
```java
/**
 * è¾“å…¥Tokenæ•°
 */
private Long promptTokens;

/**
 * è¾“å‡ºTokenæ•°
 */
private Long completionTokens;

/**
 * æ€»Tokenæ•°
 */
private Long totalTokens;
```

#### 4. ä¿®æ”¹Serviceå¡«å……é€»è¾‘

**AiConversationRuntimeService.convertToDetailVo()**:
```java
private AiConversationRuntimeVo convertToDetailVo(AiConversationRuntimeVo vo) {
    // ... åŸæœ‰ä»£ç  ...

    // å¡«å……æ€»Tokenæ¶ˆè€—
    Long totalTokens = aiTokenUsageService.getTotalTokensByRuntimeUuid(vo.getRuntimeUuid());
    vo.setTotalTokens(totalTokens);

    return vo;
}
```

**AiConversationRuntimeNodeServiceæŸ¥è¯¢æ–¹æ³•**:
```java
public List<AiConversationRuntimeNodeVo> getNodesByRuntimeUuid(String runtimeUuid) {
    // ... åŸæœ‰æŸ¥è¯¢ä»£ç  ...

    // å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„Tokenä¿¡æ¯
    for (AiConversationRuntimeNodeVo nodeVo : nodeVos) {
        NodeTokenUsageVo tokenUsage = aiTokenUsageService.getNodeTokenUsage(nodeVo.getId());
        if (tokenUsage != null) {
            nodeVo.setPromptTokens(tokenUsage.getPromptTokens());
            nodeVo.setCompletionTokens(tokenUsage.getCompletionTokens());
            nodeVo.setTotalTokens(tokenUsage.getTotalTokens());
        }
    }

    return nodeVos;
}
```

### å‰ç«¯å®ç°

#### 1. ä¿®æ”¹MessageList.vueä¼ é€’messageId

```vue
<!-- Line 335-340 -->
<execution-detail-dialog
  :visible.sync="detailDialogVisible"
  :runtime-detail="currentRuntimeDetail"
  :nodes="currentNodes"
  :loading="detailLoading"
  :message-id="currentMessageId"
/>
```

```javascript
// åœ¨showExecutionDetailæ–¹æ³•ä¸­ (Line 607)
async showExecutionDetail (message) {
  // ... åŸæœ‰ä»£ç  ...

  // ä¿å­˜messageIdç”¨äºä¼ é€’ç»™dialog
  this.currentMessageId = message.id

  // ... åç»­ä»£ç  ...
}

// dataä¸­æ–°å¢
data () {
  return {
    // ... åŸæœ‰å­—æ®µ ...
    currentMessageId: null  // æ–°å¢
  }
}
```

#### 2. ä¿®æ”¹ExecutionDetailDialog.vue

**å¢åŠ props**:
```vue
<script>
export default {
  props: {
    // ... åŸæœ‰props ...
    messageId: {
      type: Number,
      default: null
    }
  }
}
</script>
```

**ä¿®æ”¹åŸºæœ¬ä¿¡æ¯åŒºåŸŸ**:
```vue
<template>
  <el-descriptions :column="3" border>
    <!-- ä¿®æ”¹: å·¥ä½œæµåç§° â†’ æ¶ˆæ¯ID -->
    <el-descriptions-item label="æ¶ˆæ¯ID">
      <span v-if="messageId">{{ messageId }}</span>
      <span v-else>-</span>
    </el-descriptions-item>

    <el-descriptions-item label="æ‰§è¡ŒçŠ¶æ€">
      <el-tag :type="statusType">{{ statusText }}</el-tag>
    </el-descriptions-item>

    <el-descriptions-item label="æ‰§è¡Œæ—¶é•¿">
      <span v-if="runtimeDetail.elapsed_time">
        {{ formatDuration(runtimeDetail.elapsed_time) }}
      </span>
      <span v-else>-</span>
    </el-descriptions-item>

    <!-- åˆå¹¶: å¼€å§‹/ç»“æŸæ—¶é—´ -->
    <el-descriptions-item label="æ‰§è¡Œæ—¶é—´" :span="2">
      <span v-if="runtimeDetail.start_time && runtimeDetail.end_time">
        {{ formatDateTime(runtimeDetail.start_time) }}
        è‡³
        {{ formatDateTime(runtimeDetail.end_time) }}
      </span>
      <span v-else-if="runtimeDetail.start_time">
        {{ formatDateTime(runtimeDetail.start_time) }} (è¿›è¡Œä¸­)
      </span>
      <span v-else>-</span>
    </el-descriptions-item>

    <el-descriptions-item label="åˆ›å»ºäºº">
      <span v-if="runtimeDetail.c_name">{{ runtimeDetail.c_name }}</span>
      <span v-else>-</span>
    </el-descriptions-item>

    <!-- æ–°å¢: æ€»Tokenæ¶ˆè€— -->
    <el-descriptions-item label="æ€»Tokenæ¶ˆè€—" :span="3">
      <span v-if="runtimeDetail.totalTokens != null" class="token-highlight">
        {{ formatNumber(runtimeDetail.totalTokens) }} tokens
      </span>
      <span v-else>-</span>
    </el-descriptions-item>
  </el-descriptions>
</template>

<style scoped>
.token-highlight {
  color: #409EFF;
  font-weight: 600;
  font-size: 14px;
}
</style>
```

**ä¿®æ”¹èŠ‚ç‚¹è¯¦æƒ…åŒºåŸŸ**:
```vue
<template>
  <el-timeline>
    <el-timeline-item
      v-for="(node, index) in nodes"
      :key="index"
      :type="getNodeType(node.status)"
      :icon="getNodeIcon(node.status)"
    >
      <div class="node-header">
        <span class="node-title">èŠ‚ç‚¹ {{ index + 1 }}</span>
        <el-tag :type="getNodeType(node.status)" size="mini">
          {{ getNodeStatusText(node.status) }}
        </el-tag>
      </div>

      <!-- æ‰§è¡Œæ—¶é—´ + Tokenæ¶ˆè€— -->
      <div v-if="node.c_time" class="node-meta">
        <span class="meta-item">
          <i class="el-icon-time" />
          æ‰§è¡Œæ—¶é—´: {{ formatDateTime(node.c_time) }}
        </span>

        <!-- æ–°å¢: Tokenæ¶ˆè€— (ä»…å½“æœ‰Tokenæ•°æ®æ—¶æ˜¾ç¤º) -->
        <span v-if="node.totalTokens != null" class="meta-item token-info">
          <i class="el-icon-coin" />
          æ¶ˆè€—tokens: {{ formatNumber(node.totalTokens) }}
        </span>
      </div>

      <!-- ... å…¶ä½™èŠ‚ç‚¹è¯¦æƒ…å†…å®¹ ... -->
    </el-timeline-item>
  </el-timeline>
</template>

<style scoped>
.node-meta {
  display: flex;
  gap: 16px;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

.meta-item {
  font-size: 13px;
  color: #606266;
  display: flex;
  align-items: center;
  gap: 4px;
}

.token-info {
  color: #409EFF;
  font-weight: 500;
}

.token-info i {
  color: #409EFF;
}
</style>
```

## ğŸ“Š æ•°æ®æµå›¾

```
å‰ç«¯è§¦å‘
  â†“
MessageList.showExecutionDetail(message)
  â”œâ”€ message.id â†’ currentMessageId (ä¼ ç»™Dialog)
  â””â”€ message.workflowRuntime.uuid â†’ runtimeUuid
      â†“
åç«¯API: getConversationRuntimeDetail(runtimeUuid)
  â”œâ”€ AiConversationRuntimeService.getDetailByUuid()
  â”‚   â”œâ”€ æŸ¥è¯¢runtimeåŸºæœ¬ä¿¡æ¯
  â”‚   â””â”€ AiTokenUsageService.getTotalTokensByRuntimeUuid()
  â”‚       â””â”€ SUM(ai_token_usage.total_tokens) WHERE serial_id IN (èŠ‚ç‚¹IDåˆ—è¡¨)
  â†“
åç«¯API: getConversationRuntimeNodeDetails(runtimeUuid)
  â”œâ”€ AiConversationRuntimeNodeService.getNodesByRuntimeUuid()
  â”‚   â”œâ”€ æŸ¥è¯¢èŠ‚ç‚¹åˆ—è¡¨
  â”‚   â””â”€ ä¸ºæ¯ä¸ªèŠ‚ç‚¹å¡«å……Tokenä¿¡æ¯
  â”‚       â””â”€ AiTokenUsageService.getNodeTokenUsage(nodeId)
  â†“
å‰ç«¯ExecutionDetailDialogå±•ç¤º
  â”œâ”€ åŸºæœ¬ä¿¡æ¯åŒº: totalTokens â†’ formatNumber() â†’ "1,234 tokens"
  â””â”€ èŠ‚ç‚¹è¯¦æƒ…åŒº: node.totalTokens â†’ formatNumber() â†’ "æ¶ˆè€—tokens: 1,234"
```

## âœ… å®ç°æ­¥éª¤

### é˜¶æ®µ1: åç«¯APIå¼€å‘ (2å°æ—¶)

1. **åˆ›å»ºNodeTokenUsageVo** (10åˆ†é’Ÿ)
   - æ–°å»ºæ–‡ä»¶: `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/chat/NodeTokenUsageVo.java`
   - å­—æ®µ: promptTokens, completionTokens, totalTokens

2. **ä¿®æ”¹VOç±»æ·»åŠ Tokenå­—æ®µ** (10åˆ†é’Ÿ)
   - AiConversationRuntimeVo: æ·»åŠ totalTokens
   - AiConversationRuntimeNodeVo: æ·»åŠ promptTokens, completionTokens, totalTokens

3. **AiTokenUsageServiceæ–°å¢æ–¹æ³•** (40åˆ†é’Ÿ)
   - getTotalTokensByRuntimeUuid(): èšåˆæŸ¥è¯¢
   - getNodeTokenUsage(): èŠ‚ç‚¹æŸ¥è¯¢
   - å•å…ƒæµ‹è¯•éªŒè¯

4. **ä¿®æ”¹Serviceå¡«å……é€»è¾‘** (40åˆ†é’Ÿ)
   - AiConversationRuntimeService.convertToDetailVo(): å¡«å……totalTokens
   - AiConversationRuntimeNodeService: å¡«å……èŠ‚ç‚¹Tokenä¿¡æ¯
   - é›†æˆæµ‹è¯•éªŒè¯

5. **æ—¥å¿—å’Œé”™è¯¯å¤„ç†** (20åˆ†é’Ÿ)
   - TokenæŸ¥è¯¢å¤±è´¥çš„æ—¥å¿—è®°å½•
   - nullå€¼å¤„ç†
   - æ€§èƒ½æ—¥å¿—(æŸ¥è¯¢æ—¶é•¿)

### é˜¶æ®µ2: å‰ç«¯å±•ç¤ºå¼€å‘ (1.5å°æ—¶)

1. **MessageList.vueä¿®æ”¹** (20åˆ†é’Ÿ)
   - æ·»åŠ currentMessageIdåˆ°data
   - showExecutionDetailæ–¹æ³•ä¿å­˜message.id
   - ä¼ é€’messageIdç»™ExecutionDetailDialog

2. **ExecutionDetailDialog.vueä¿®æ”¹** (60åˆ†é’Ÿ)
   - æ·»åŠ messageId prop
   - ä¿®æ”¹åŸºæœ¬ä¿¡æ¯åŒºåŸŸå¸ƒå±€:
     * "å·¥ä½œæµåç§°" â†’ "æ¶ˆæ¯ID"
     * åˆå¹¶å¼€å§‹/ç»“æŸæ—¶é—´
     * æ–°å¢æ€»Tokenæ¶ˆè€—æ˜¾ç¤º
   - ä¿®æ”¹èŠ‚ç‚¹è¯¦æƒ…åŒºåŸŸ:
     * æ·»åŠ Tokenæ¶ˆè€—æ˜¾ç¤º
     * ä½¿ç”¨formatNumber()æ ¼å¼åŒ–
   - æ ·å¼è°ƒæ•´

3. **æµ‹è¯•å’Œè°ƒè¯•** (10åˆ†é’Ÿ)
   - æµè§ˆå™¨æµ‹è¯•å„ç§åœºæ™¯:
     * æœ‰Tokenè®°å½•çš„æ¶ˆæ¯
     * æ— Tokenè®°å½•çš„æ¶ˆæ¯
     * Tokenä¸º0çš„æƒ…å†µ
   - éªŒè¯åƒåˆ†ç¬¦æ ¼å¼åŒ–æ­£ç¡®

### é˜¶æ®µ3: æµ‹è¯•å’Œæ–‡æ¡£ (0.5å°æ—¶)

1. **é›†æˆæµ‹è¯•** (20åˆ†é’Ÿ)
   - åˆ›å»ºæµ‹è¯•å¯¹è¯
   - è§¦å‘å·¥ä½œæµæ‰§è¡Œ
   - éªŒè¯Tokenç»Ÿè®¡æ­£ç¡®
   - éªŒè¯é¡µé¢å±•ç¤ºæ­£ç¡®

2. **æ–‡æ¡£æ›´æ–°** (10åˆ†é’Ÿ)
   - æ›´æ–°APIæ–‡æ¡£
   - æ·»åŠ åŠŸèƒ½è¯´æ˜æˆªå›¾

## âš ï¸ é£é™©è¯„ä¼°

### æŠ€æœ¯é£é™©

| é£é™©é¡¹ | ä¸¥é‡æ€§ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|--------|--------|------|----------|
| Tokenæ•°æ®ç¼ºå¤± | ğŸŸ¡ ä½ | ğŸŸ¢ ä½ | å‰ç«¯åˆ¤æ–­nullå€¼,æ˜¾ç¤º"-" |
| æ€§èƒ½å½±å“ | ğŸŸ¡ ä½ | ğŸŸ¢ ä½ | ä½¿ç”¨ç´¢å¼•,SUMæŸ¥è¯¢é«˜æ•ˆ |
| æ•°æ®ä¸ä¸€è‡´ | ğŸŸ¡ ä½ | ğŸŸ¢ ä½ | serial_idå¤–é”®çº¦æŸä¿è¯ |

### ç ´åæ€§åˆ†æ

**âœ… é›¶ç ´åæ€§**:
- çº¯æ–°å¢åŠŸèƒ½,ä¸ä¿®æ”¹ç°æœ‰ä¸šåŠ¡é€»è¾‘
- ä¸å½±å“ç°æœ‰runtimeå’ŒnodeæŸ¥è¯¢
- å‰ç«¯å‘åå…¼å®¹(nullå€¼å¤„ç†)

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

1. âœ… åŸºæœ¬ä¿¡æ¯åŒºæ­£ç¡®æ˜¾ç¤º:
   - æ¶ˆæ¯ID: æ˜¾ç¤ºai_conversation_content.id
   - æ‰§è¡Œæ—¶é—´: åˆå¹¶å¼€å§‹/ç»“æŸæ—¶é—´ä¸ºä¸€è¡Œ
   - æ€»Tokenæ¶ˆè€—: æ˜¾ç¤ºæ±‡æ€»å€¼,å¸¦åƒåˆ†ç¬¦

2. âœ… èŠ‚ç‚¹è¯¦æƒ…åŒºæ­£ç¡®æ˜¾ç¤º:
   - æœ‰Tokenè®°å½•çš„èŠ‚ç‚¹æ˜¾ç¤ºTokenæ¶ˆè€—
   - æ— Tokenè®°å½•çš„èŠ‚ç‚¹ä¸æ˜¾ç¤ºTokenä¿¡æ¯
   - Tokenæ•°å­—å¸¦åƒåˆ†ç¬¦

3. âœ… è¾¹ç•Œæƒ…å†µå¤„ç†:
   - Tokenä¸ºnullæ—¶æ˜¾ç¤º"-"
   - Tokenä¸º0æ—¶æ˜¾ç¤º"0"
   - æ— èŠ‚ç‚¹æ—¶ä¸æ˜¾ç¤ºTokenè¡Œ

### æ€§èƒ½éªŒæ”¶

- TokenèšåˆæŸ¥è¯¢ < 50ms
- èŠ‚ç‚¹TokenæŸ¥è¯¢(æ‰¹é‡) < 100ms
- æ€»æŸ¥è¯¢æ—¶é—´å¢åŠ  < 150ms

## ğŸ“ æ€»ç»“

### æ–¹æ¡ˆä¼˜åŠ¿

1. **KISSåŸåˆ™**: æœ€ç®€æ–¹æ¡ˆ,å¤ç”¨ç°æœ‰formatNumber(),æ–°å¢æŸ¥è¯¢API
2. **é›¶ç ´åæ€§**: çº¯æ–°å¢åŠŸèƒ½,ä¸å½±å“ç°æœ‰ä¸šåŠ¡
3. **é«˜æ€§èƒ½**: ä½¿ç”¨ç´¢å¼•,èšåˆæŸ¥è¯¢é«˜æ•ˆ
4. **å¯ç»´æŠ¤**: ä»£ç ç»“æ„æ¸…æ™°,æ˜“äºç†è§£å’Œæ‰©å±•

### å¾…åŠäº‹é¡¹

- [ ] è·å–æ–¹æ¡ˆå®¡æ‰¹ (é˜¶æ®µ5)
- [ ] åç«¯APIå¼€å‘ (é˜¶æ®µ6)
- [ ] å‰ç«¯å±•ç¤ºå¼€å‘ (é˜¶æ®µ6)
- [ ] é›†æˆæµ‹è¯• (é˜¶æ®µ6)
- [ ] æ–‡æ¡£æ›´æ–° (é˜¶æ®µ7)

---

**æ–¹æ¡ˆçŠ¶æ€**: ğŸŸ¡ å¾…å®¡æ‰¹
**ä¸‹ä¸€æ­¥**: ç­‰å¾…ç”¨æˆ·ç¡®è®¤æ–¹æ¡ˆ,è¿›å…¥é˜¶æ®µ5å®¡æ‰¹

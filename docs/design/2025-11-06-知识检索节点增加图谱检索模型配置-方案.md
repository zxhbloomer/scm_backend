# çŸ¥è¯†æ£€ç´¢èŠ‚ç‚¹å¢åŠ å›¾è°±æ£€ç´¢æ¨¡å‹é…ç½® - æŠ€æœ¯æ–¹æ¡ˆ

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-06
**ä½œè€…**: SCM AI Team
**è¯„å®¡çŠ¶æ€**: å¾…å®¡æ‰¹

---

## ä¸€ã€éœ€æ±‚èƒŒæ™¯ä¸é—®é¢˜è¯Šæ–­

### 1.1 ä¸šåŠ¡éœ€æ±‚

**æ ¸å¿ƒè¯‰æ±‚**ï¼šåœ¨çŸ¥è¯†æ£€ç´¢èŠ‚ç‚¹ä¸­ï¼Œä¸ºå›¾è°±æ£€ç´¢åŠŸèƒ½å¢åŠ å¯é…ç½®çš„LLMæ¨¡å‹é€‰é¡¹ã€‚

**å…·ä½“è¦æ±‚**ï¼š
1. åœ¨çŸ¥è¯†æ£€ç´¢èŠ‚ç‚¹å±æ€§é¢æ¿ä¸­ï¼Œå¢åŠ "å›¾è°±æ£€ç´¢æ¨¡å‹"é…ç½®é¡¹
2. åªæœ‰å½“"å›¾è°±æ£€ç´¢"å¼€å…³=å¯ç”¨æ—¶ï¼Œæ‰æ˜¾ç¤ºæ¨¡å‹é€‰æ‹©å™¨
3. åœ¨èŠ‚ç‚¹å›¾å½¢ä¸ŠåŠ¨æ€æ˜¾ç¤ºé€‰æ‹©çš„æ¨¡å‹åç§°ï¼ˆç±»ä¼¼ç”Ÿæˆå›ç­”èŠ‚ç‚¹ï¼‰
4. æ”¯æŒå‰åç«¯è”åŠ¨ï¼šå±æ€§é¢æ¿é€‰æ‹©æ¨¡å‹ â†’ èŠ‚ç‚¹å›¾å½¢å®æ—¶æ›´æ–°
5. å¦‚æœå¯ç”¨å›¾è°±æ£€ç´¢ä½†æœªé…ç½®æ¨¡å‹ï¼Œåç«¯å¿…é¡»æŠ¥é”™ï¼ˆä¸ä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼‰

### 1.2 é—®é¢˜è¯Šæ–­

**å½“å‰å®ç°é—®é¢˜**ï¼š

```java
// GraphRetrievalService.java (ç¬¬274è¡Œ)
private Set<String> extractEntitiesFromQuestion(String question) {
    // é—®é¢˜ï¼šç›´æ¥ä½¿ç”¨é»˜è®¤ChatModelï¼Œç”¨æˆ·æ— æ³•æ§åˆ¶ä½¿ç”¨å“ªä¸ªæ¨¡å‹
    response = aiModelProvider.getChatModel().call(new Prompt(prompt))
                .getResult().getOutput().getText();
}
```

**å¯¼è‡´çš„ä¸šåŠ¡å½±å“**ï¼š
1. **æˆæœ¬å¤±æ§**ï¼šå›¾è°±æ£€ç´¢å¯èƒ½ä½¿ç”¨æ˜‚è´µçš„GPT-4æ¨¡å‹ï¼ˆå®é™…åªéœ€GPT-3.5å³å¯å®Œæˆå®ä½“æå–ï¼‰
2. **é€æ˜åº¦ä¸è¶³**ï¼šç”¨æˆ·ä¸çŸ¥é“å›¾è°±æ£€ç´¢åœ¨ä½¿ç”¨å“ªä¸ªæ¨¡å‹
3. **çµæ´»æ€§ç¼ºå¤±**ï¼šæ— æ³•é’ˆå¯¹ä¸åŒçŸ¥è¯†åº“ä½¿ç”¨ä¸åŒçš„å®ä½“æå–æ¨¡å‹
4. **è®¾è®¡ä¸ä¸€è‡´**ï¼šç”Ÿæˆå›ç­”èŠ‚ç‚¹å¯ä»¥é…ç½®æ¨¡å‹ï¼ŒçŸ¥è¯†æ£€ç´¢èŠ‚ç‚¹ä¸èƒ½

### 1.3 æ ¹å› åˆ†æ

**ç¬¬ä¸€å±‚ï¼šæ•°æ®ç»“æ„ç¼ºå¤±**
- `KnowledgeRetrievalNodeConfig` ç¼ºå°‘æ¨¡å‹é…ç½®å­—æ®µ
- å‰ç«¯èŠ‚ç‚¹æ— æ¨¡å‹æ˜¾ç¤ºé€»è¾‘

**ç¬¬äºŒå±‚ï¼šæœåŠ¡å±‚èƒ½åŠ›ä¸è¶³**
- `AiModelProvider` åªèƒ½è·å–é»˜è®¤æ¨¡å‹ï¼Œæ— æ³•æ ¹æ®åç§°è·å–æŒ‡å®šæ¨¡å‹
- `GraphRetrievalService` æ— æ³•æ¥æ”¶å¤–éƒ¨ä¼ å…¥çš„æ¨¡å‹å‚æ•°

**ç¬¬ä¸‰å±‚ï¼šUIç»„ä»¶ç¼ºå¤±**
- `KnowledgeRetrievalNodeProperty.vue` æ— æ¨¡å‹é€‰æ‹©å™¨
- `KnowledgeRetrievalNode.vue` æ— æ¨¡å‹ä¿¡æ¯å±•ç¤º

---

## äºŒã€KISSåŸåˆ™è¯„ä¼°

### 2.1 è¿™æ˜¯ä¸ªçœŸé—®é¢˜è¿˜æ˜¯è‡†æƒ³å‡ºæ¥çš„ï¼Ÿ

âœ… **çœŸå®é—®é¢˜**

**è¯æ®**ï¼š
1. ç”Ÿäº§ç¯å¢ƒçœŸå®ç—›ç‚¹ï¼šå›¾è°±æ£€ç´¢ä½¿ç”¨çš„æ¨¡å‹ä¸å¯æ§ï¼Œæˆæœ¬å¤±æ§é£é™©
2. ä¸ç”Ÿæˆå›ç­”èŠ‚ç‚¹è®¾è®¡ä¸ä¸€è‡´ï¼Œç”¨æˆ·ä½“éªŒå‰²è£‚
3. å·²æœ‰å®Œæ•´çš„å‚è€ƒå®ç°ï¼ˆAnswerNodeã€ClassifierNodeï¼‰ï¼ŒæŠ€æœ¯å¯è¡Œæ€§100%

### 2.2 æœ‰æ›´ç®€å•çš„æ–¹æ³•å—ï¼Ÿ

âœ… **å·²æ˜¯æœ€ç®€æ–¹æ¡ˆ**

**å¤‡é€‰æ–¹æ¡ˆå¯¹æ¯”**ï¼š
| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ç»“è®º |
|------|------|------|------|
| æ–¹æ¡ˆAï¼šå…¨å±€é…ç½® | ç®€å• | ä¸åŒçŸ¥è¯†åº“æ— æ³•ç”¨ä¸åŒæ¨¡å‹ | âŒ çµæ´»æ€§ä¸è¶³ |
| **æ–¹æ¡ˆBï¼šèŠ‚ç‚¹çº§é…ç½®ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰** | **çµæ´»ã€ä¸€è‡´** | **éœ€ä¿®æ”¹å‰åç«¯** | âœ… **æœ€ä½³å¹³è¡¡** |
| æ–¹æ¡ˆCï¼šè‡ªåŠ¨é€‰æ‹©æ¨¡å‹ | æ— éœ€ç”¨æˆ·é…ç½® | å¤æ‚åº¦é«˜ï¼Œé»‘ç›’ä¸é€æ˜ | âŒ è¿‡åº¦è®¾è®¡ |

**å¤ç”¨ç°æœ‰æœºåˆ¶**ï¼š
- âœ… å¤ç”¨ `WfLLMSelector` ç»„ä»¶ï¼ˆæ— æ–°å¢ç»„ä»¶ï¼‰
- âœ… å¤ç”¨ `workflow:update-node` äº‹ä»¶æœºåˆ¶ï¼ˆæ— æ–°å¢é€šä¿¡åè®®ï¼‰
- âœ… å¤ç”¨ `change:data` ç›‘å¬æ¨¡å¼ï¼ˆæ— æ–°å¢å“åº”å¼é€»è¾‘ï¼‰

### 2.3 ä¼šç ´åä»€ä¹ˆå—ï¼Ÿ

âœ… **å‘åå…¼å®¹ï¼Œé›¶ç ´å**

**å…¼å®¹æ€§åˆ†æ**ï¼š

```json
// æ—§æ•°æ®ï¼ˆæ— graph_model_nameå­—æ®µï¼‰
{
  "enable_graph_retrieval": false,
  "knowledge_base_uuid": "xxx"
}
â†’ å‰ç«¯ï¼šä¸æ˜¾ç¤ºæ¨¡å‹é€‰æ‹©å™¨ï¼ˆv-ifæ§åˆ¶ï¼‰
â†’ åç«¯ï¼šenableGraphRetrieval=falseï¼Œä¸éªŒè¯æ¨¡å‹å­—æ®µ
â†’ âœ… å®Œå…¨å…¼å®¹

// å·²å¯ç”¨å›¾è°±æ£€ç´¢çš„æ—§æ•°æ®
{
  "enable_graph_retrieval": true,
  "knowledge_base_uuid": "xxx"
  // ç¼ºå°‘ graph_model_name
}
â†’ å‰ç«¯ï¼šæ˜¾ç¤º"æœªé€‰æ‹©æ¨¡å‹"ï¼Œæç¤ºç”¨æˆ·é…ç½®
â†’ åç«¯ï¼šéªŒè¯å¤±è´¥ï¼Œæç¤º"å¯ç”¨å›¾è°±æ£€ç´¢æ—¶å¿…é¡»é…ç½®æ¨¡å‹"
â†’ âœ… åˆç†çš„ä¸šåŠ¡æŠ¥é”™ï¼Œå¼•å¯¼ç”¨æˆ·è¡¥å……é…ç½®
```

**æ•°æ®åº“å˜æ›´**ï¼šâŒ æ— éœ€å˜æ›´æ•°æ®åº“ï¼ˆå·¥ä½œæµé…ç½®å­˜å‚¨åœ¨JSONå­—æ®µä¸­ï¼‰

### 2.4 å½“å‰é¡¹ç›®çœŸçš„éœ€è¦è¿™ä¸ªåŠŸèƒ½å—ï¼Ÿ

âœ… **å¿…è¦åŠŸèƒ½**

**ä¸šåŠ¡ä»·å€¼**ï¼š
1. **æˆæœ¬æ§åˆ¶**ï¼šå®ä½“æå–å¯ç”¨ä¾¿å®œæ¨¡å‹ï¼ˆGPT-3.5ï¼‰ï¼Œç”Ÿæˆå›ç­”ç”¨å¼ºæ¨¡å‹ï¼ˆGPT-4ï¼‰
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šè½»é‡æ¨¡å‹å“åº”æ›´å¿«ï¼ˆ1ç§’ vs 3ç§’ï¼‰
3. **é€æ˜åº¦**ï¼šç”¨æˆ·çŸ¥é“æ¯ä¸ªç¯èŠ‚ä½¿ç”¨çš„æ¨¡å‹ï¼Œé¿å…é»‘ç›’
4. **ä¸€è‡´æ€§**ï¼šä¸ç”Ÿæˆå›ç­”èŠ‚ç‚¹ä¿æŒä¸€è‡´ï¼Œé™ä½å­¦ä¹ æˆæœ¬

**é‡åŒ–æ”¶ç›Š**ï¼š
- æˆæœ¬èŠ‚çœï¼šå›¾è°±æ£€ç´¢æ”¹ç”¨GPT-3.5ï¼Œæ¯1000æ¬¡è°ƒç”¨èŠ‚çœçº¦ $15ï¼ˆ$0.03 vs $0.015ï¼‰
- å“åº”æ—¶é—´ï¼šè½»é‡æ¨¡å‹å®ä½“æå–è€—æ—¶ â‰ˆ 1ç§’ï¼ˆvs GPT-4çš„3ç§’ï¼‰

---

## ä¸‰ã€è¯¦ç»†è®¾è®¡æ–¹æ¡ˆï¼ˆæŒ‰æ–‡ä»¶åˆ†è§£ï¼‰

### 3.1 åç«¯è®¾è®¡

#### æ–‡ä»¶1ï¼šKnowledgeRetrievalNodeConfig.java

**è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/workflow/node/knowledgeretrieval/KnowledgeRetrievalNodeConfig.java`

**ä¿®æ”¹å†…å®¹**ï¼š

```java
@Data
public class KnowledgeRetrievalNodeConfig {

    // ===== ç°æœ‰å­—æ®µï¼ˆä¿æŒä¸å˜ï¼‰=====
    @JsonProperty("knowledge_base_uuid")
    private String knowledgeBaseUuid;

    @JsonProperty("knowledge_base_name")
    private String knowledgeBaseName;

    private Double score;

    @JsonProperty("top_n")
    private Integer topN;

    @JsonProperty("is_strict")
    private Boolean isStrict;

    @JsonProperty("default_response")
    private String defaultResponse;

    @JsonProperty("enable_graph_retrieval")
    private Boolean enableGraphRetrieval;

    // ===== æ–°å¢å­—æ®µ =====
    /**
     * å›¾è°±æ£€ç´¢ä½¿ç”¨çš„æ¨¡å‹åç§°
     * <p>ä»…åœ¨enableGraphRetrieval=trueæ—¶ç”Ÿæ•ˆ</p>
     * <p>ç”¨äºå®ä½“æå–çš„LLMæ¨¡å‹</p>
     * <p>å¦‚æœä¸ºç©ºä¸”å›¾è°±æ£€ç´¢å·²å¯ç”¨ï¼Œåç«¯éªŒè¯å°†æŠ¥é”™</p>
     *
     * <p>ç¤ºä¾‹å€¼ï¼š"gpt-3.5-turbo", "deepseek-chat"</p>
     */
    @JsonProperty("graph_model_name")
    private String graphModelName;
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `graphModelName`: æ¨¡å‹åç§°ï¼ˆä¸æ˜¯æ¨¡å‹IDï¼‰ï¼Œä¸`WfLLMSelector`è¿”å›å€¼å¯¹åº”
- æ¡ä»¶å¿…å¡«ï¼š`enableGraphRetrieval=true` æ—¶å¿…é¡»æœ‰å€¼
- å‰ç«¯æ˜¾ç¤ºç”¨ï¼Œåç«¯é€šè¿‡æ­¤åç§°æŸ¥æ‰¾æ¨¡å‹é…ç½®

**éªŒè¯é€»è¾‘**ï¼šåœ¨ `KnowledgeRetrievalNode.onProcess()` ä¸­å¢åŠ éªŒè¯

---

#### æ–‡ä»¶2ï¼šKnowledgeRetrievalNode.java

**è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/workflow/node/knowledgeretrieval/KnowledgeRetrievalNode.java`

**ä¿®æ”¹å†…å®¹**ï¼š

```java
@Override
public NodeProcessResult onProcess() {
    KnowledgeRetrievalNodeConfig nodeConfig = checkAndGetConfig(KnowledgeRetrievalNodeConfig.class);

    // ===== æ–°å¢ï¼šéªŒè¯å›¾è°±æ£€ç´¢æ¨¡å‹é…ç½® =====
    boolean enableGraph = Boolean.TRUE.equals(nodeConfig.getEnableGraphRetrieval());

    if (enableGraph) {
        String graphModelName = nodeConfig.getGraphModelName();
        if (StringUtils.isBlank(graphModelName)) {
            log.error("å›¾è°±æ£€ç´¢å·²å¯ç”¨ä½†æœªé…ç½®æ¨¡å‹ï¼ŒèŠ‚ç‚¹UUID: {}", node.getUuid());
            throw new BusinessException("å¯ç”¨å›¾è°±æ£€ç´¢æ—¶å¿…é¡»é…ç½®å›¾è°±æ£€ç´¢æ¨¡å‹");
        }
        log.info("å›¾è°±æ£€ç´¢æ¨¡å‹é…ç½®: {}", graphModelName);
    }

    // ... ç°æœ‰ä»£ç ï¼šè·å–è¾“å…¥æ–‡æœ¬ã€æ£€ç´¢å‚æ•°ç­‰ ...

    // ===== ä¿®æ”¹ï¼šå›¾è°±æ£€ç´¢éƒ¨åˆ†ä¼ å…¥æ¨¡å‹åç§° =====
    if (enableGraph) {
        log.info("=== å›¾è°±æ£€ç´¢å·²å¯ç”¨ ===");
        log.info("å›¾è°±æ£€ç´¢å‚æ•° - kbUuid: {}, æŸ¥è¯¢å†…å®¹: {}, topN: {}, æ¨¡å‹: {}",
                 kbUuid, textInput, topN, nodeConfig.getGraphModelName());

        try {
            String tenantCode = kbUuid.split("::", 2)[0];
            GraphRetrievalService graphRetrievalService = SpringUtil.getBean(GraphRetrievalService.class);

            // è°ƒç”¨æ–°å¢çš„é‡è½½æ–¹æ³•ï¼Œä¼ å…¥æ¨¡å‹åç§°
            graphResults = graphRetrievalService.searchRelatedEntities(
                    textInput, kbUuid, tenantCode, topN, nodeConfig.getGraphModelName()
            );

            // ... åç»­å¤„ç†ä¿æŒä¸å˜ ...
        } catch (Exception e) {
            log.error("å›¾è°±æ£€ç´¢å¤±è´¥: {}", e.getMessage(), e);
            log.warn("å›¾è°±æ£€ç´¢å¤±è´¥é™çº§å¤„ç†ï¼šç»§ç»­ä½¿ç”¨å‘é‡æ£€ç´¢ç»“æœ");
        }
    }

    // ... åç»­ä»£ç ä¿æŒä¸å˜ ...
}
```

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š
1. å¢åŠ æ¨¡å‹é…ç½®éªŒè¯ï¼ˆå¯ç”¨å›¾è°±æ£€ç´¢æ—¶å¿…é¡»é…ç½®æ¨¡å‹ï¼‰
2. è°ƒç”¨ `searchRelatedEntities` çš„5å‚æ•°é‡è½½ç‰ˆæœ¬ï¼Œä¼ å…¥æ¨¡å‹åç§°
3. æ—¥å¿—ä¸­è®°å½•ä½¿ç”¨çš„æ¨¡å‹åç§°

---

#### æ–‡ä»¶3ï¼šGraphRetrievalService.java

**è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/GraphRetrievalService.java`

**ä¿®æ”¹å†…å®¹**ï¼š

```java
@Service
public class GraphRetrievalService {

    @Autowired
    private AiModelProvider aiModelProvider;

    // ... å…¶ä»–ä¾èµ–ä¿æŒä¸å˜ ...

    // ===== ç°æœ‰æ–¹æ³•ï¼šä¿æŒä¸å˜ï¼ˆå‘åå…¼å®¹ï¼‰=====
    public List<GraphSearchResultVo> searchRelatedEntities(
            String question, String kbUuid, String tenantCode, Integer maxResults) {

        // ä½¿ç”¨é»˜è®¤ChatModelï¼ˆç§Ÿæˆ·çº§é»˜è®¤LLMæ¨¡å‹ï¼‰
        Set<String> extractedEntities = extractEntitiesFromQuestion(question);

        // ... åç»­é€»è¾‘ä¿æŒä¸å˜ ...
    }

    // ===== æ–°å¢ï¼šæ”¯æŒæŒ‡å®šæ¨¡å‹çš„é‡è½½æ–¹æ³• =====
    /**
     * æœç´¢ä¸é—®é¢˜ç›¸å…³çš„å®ä½“å’Œå…³ç³»ï¼ˆæ”¯æŒæŒ‡å®šæ¨¡å‹ï¼‰
     *
     * @param question ç”¨æˆ·é—®é¢˜
     * @param kbUuid çŸ¥è¯†åº“UUID
     * @param tenantCode ç§Ÿæˆ·ç¼–ç 
     * @param maxResults æœ€å¤§è¿”å›ç»“æœæ•°
     * @param modelName å®ä½“æå–ä½¿ç”¨çš„æ¨¡å‹åç§°ï¼ˆå¦‚ "gpt-3.5-turbo"ï¼‰
     * @return å›¾è°±æ£€ç´¢ç»“æœåˆ—è¡¨
     */
    public List<GraphSearchResultVo> searchRelatedEntities(
            String question, String kbUuid, String tenantCode, Integer maxResults, String modelName) {

        log.info("==================== å›¾è°±æ£€ç´¢æœåŠ¡å¼€å§‹ï¼ˆæŒ‡å®šæ¨¡å‹ï¼‰====================");
        log.info("é—®é¢˜: [{}]", question);
        log.info("çŸ¥è¯†åº“UUID: [{}]", kbUuid);
        log.info("ç§Ÿæˆ·ç¼–ç : [{}]", tenantCode);
        log.info("æœ€å¤§ç»“æœæ•°: [{}]", maxResults);
        log.info("æŒ‡å®šæ¨¡å‹: [{}]", modelName);

        if (maxResults == null || maxResults <= 0) {
            maxResults = 3;
        }

        // 1. ä½¿ç”¨æŒ‡å®šçš„ChatModelæå–å®ä½“
        log.info("æ­¥éª¤1: å¼€å§‹ä»é—®é¢˜ä¸­æå–å®ä½“ï¼ˆä½¿ç”¨æŒ‡å®šæ¨¡å‹: {}ï¼‰", modelName);
        Set<String> extractedEntities = extractEntitiesFromQuestion(question, modelName);

        if (extractedEntities.isEmpty()) {
            log.warn("âš ï¸ æ­¥éª¤1å¤±è´¥: ä»ç”¨æˆ·é—®é¢˜ä¸­æœªæå–åˆ°ä»»ä½•å®ä½“");
            log.info("==================== å›¾è°±æ£€ç´¢æœåŠ¡ç»“æŸï¼ˆæœªæå–åˆ°å®ä½“ï¼‰====================");
            return Collections.emptyList();
        }

        log.info("âœ… æ­¥éª¤1å®Œæˆ: æå–åˆ° {} ä¸ªå®ä½“", extractedEntities.size());

        // 2-6æ­¥ï¼šä¸ç°æœ‰æ–¹æ³•å®Œå…¨ç›¸åŒ
        // ... å¤åˆ¶ç°æœ‰å®ç°ï¼ˆåœ¨Neo4jä¸­æœç´¢å®ä½“ã€æŸ¥è¯¢å…³ç³»ã€è®¡ç®—åˆ†æ•°ã€æ’åºï¼‰...

        // ä¸ºé¿å…ä»£ç é‡å¤ï¼Œå¯ä»¥æå–å…¬å…±æ–¹æ³•
        return searchEntitiesInGraph(extractedEntities, kbUuid, tenantCode, maxResults);
    }

    // ===== ä¿®æ”¹ï¼šç°æœ‰ç§æœ‰æ–¹æ³•å¢åŠ æ¨¡å‹åç§°å‚æ•°é‡è½½ =====

    /**
     * ä»é—®é¢˜ä¸­æå–å®ä½“ï¼ˆä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼‰
     */
    private Set<String> extractEntitiesFromQuestion(String question) {
        log.debug("è°ƒç”¨LLMæå–å®ä½“ï¼ˆä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼‰ï¼Œé—®é¢˜: [{}]", question);
        String prompt = GRAPH_EXTRACTION_PROMPT_CN.replace("{input_text}", question);

        String response = "";
        try {
            // ä½¿ç”¨é»˜è®¤ChatModel
            response = aiModelProvider.getChatModel()
                    .call(new Prompt(prompt))
                    .getResult()
                    .getOutput()
                    .getText();
            log.debug("LLMå“åº”: [{}]", response);
        } catch (Exception e) {
            log.error("âŒ å›¾è°±å®ä½“æå–å¤±è´¥: {}", e.getMessage(), e);
            return Collections.emptySet();
        }

        return parseEntitiesFromResponse(response);
    }

    /**
     * ä»é—®é¢˜ä¸­æå–å®ä½“ï¼ˆä½¿ç”¨æŒ‡å®šæ¨¡å‹ï¼‰
     *
     * @param question ç”¨æˆ·é—®é¢˜
     * @param modelName æ¨¡å‹åç§°ï¼ˆå¦‚ "gpt-3.5-turbo"ï¼‰
     * @return æå–çš„å®ä½“é›†åˆ
     */
    private Set<String> extractEntitiesFromQuestion(String question, String modelName) {
        log.debug("è°ƒç”¨LLMæå–å®ä½“ï¼ˆä½¿ç”¨æŒ‡å®šæ¨¡å‹: {}ï¼‰ï¼Œé—®é¢˜: [{}]", modelName, question);
        String prompt = GRAPH_EXTRACTION_PROMPT_CN.replace("{input_text}", question);

        String response = "";
        try {
            // ä½¿ç”¨æŒ‡å®šçš„ChatModel
            ChatModel chatModel = aiModelProvider.getChatModelByName(modelName);
            response = chatModel.call(new Prompt(prompt))
                    .getResult()
                    .getOutput()
                    .getText();
            log.debug("LLMå“åº”: [{}]", response);
        } catch (Exception e) {
            log.error("âŒ å›¾è°±å®ä½“æå–å¤±è´¥ï¼ˆæ¨¡å‹: {}ï¼‰: {}", modelName, e.getMessage(), e);
            return Collections.emptySet();
        }

        return parseEntitiesFromResponse(response);
    }

    /**
     * è§£æLLMå“åº”ï¼Œæå–å®ä½“åˆ—è¡¨ï¼ˆæå–å…¬å…±é€»è¾‘ï¼‰
     */
    private Set<String> parseEntitiesFromResponse(String response) {
        if (StringUtils.isBlank(response)) {
            log.warn("âš ï¸ LLMè¿”å›ç©ºå“åº”");
            return Collections.emptySet();
        }

        Set<String> entities = new HashSet<>();
        String[] records = response.split("\n");

        for (String record : records) {
            String newRecord = record.replaceAll("^\\(|\\)$", "").trim();
            String[] recordAttributes = newRecord.split("<\\|>");

            if (recordAttributes.length >= 4) {
                if (recordAttributes[0].contains("\"entity\"") || recordAttributes[0].contains("\"å®ä½“\"")) {
                    String entityName = AdiStringUtil.tail(
                            AdiStringUtil.removeSpecialChar(clearStr(recordAttributes[1].toUpperCase())),
                            20
                    );
                    entities.add(entityName);
                } else if (recordAttributes[0].contains("\"relationship\"") || recordAttributes[0].contains("\"å…³ç³»\"")) {
                    String sourceName = AdiStringUtil.tail(
                            AdiStringUtil.removeSpecialChar(clearStr(recordAttributes[1].toUpperCase())),
                            20
                    );
                    String targetName = AdiStringUtil.tail(
                            AdiStringUtil.removeSpecialChar(clearStr(recordAttributes[2].toUpperCase())),
                            20
                    );
                    entities.add(sourceName);
                    entities.add(targetName);
                }
            }
        }

        return entities.stream()
                .filter(StringUtils::isNotBlank)
                .collect(Collectors.toSet());
    }

    /**
     * åœ¨Neo4jå›¾è°±ä¸­æœç´¢å®ä½“ï¼ˆæå–å…¬å…±é€»è¾‘ï¼Œé¿å…ä»£ç é‡å¤ï¼‰
     */
    private List<GraphSearchResultVo> searchEntitiesInGraph(
            Set<String> extractedEntities, String kbUuid, String tenantCode, Integer maxResults) {

        // ... æ­¥éª¤2-6çš„å®Œæ•´å®ç°ï¼ˆä»ç°æœ‰æ–¹æ³•å¤åˆ¶ï¼‰...
        // 2. åœ¨Neo4jä¸­æœç´¢å®ä½“èŠ‚ç‚¹
        // 3. æŸ¥è¯¢æ¯ä¸ªå®ä½“çš„ç›´æ¥å…³ç³»
        // 4. è®¡ç®—å®ä½“ç›¸å…³æ€§åˆ†æ•°
        // 5. æ„å»ºGraphSearchResultVo
        // 6. æŒ‰åˆ†æ•°é™åºæ’åºå¹¶é™åˆ¶æ•°é‡

        // ï¼ˆè¿™é‡Œçœç•¥å…·ä½“å®ç°ï¼Œå®é™…ä»£ç ä¸­éœ€è¦å®Œæ•´å¤åˆ¶ï¼‰
        return new ArrayList<>();
    }
}
```

**è®¾è®¡äº®ç‚¹**ï¼š
1. ä¿ç•™ç°æœ‰4å‚æ•°æ–¹æ³•ï¼ˆå‘åå…¼å®¹ï¼‰
2. æ–°å¢5å‚æ•°é‡è½½æ–¹æ³•ï¼ˆæ”¯æŒæŒ‡å®šæ¨¡å‹ï¼‰
3. æå–å…¬å…±é€»è¾‘ `parseEntitiesFromResponse` å’Œ `searchEntitiesInGraph`ï¼Œé¿å…ä»£ç é‡å¤

---

#### æ–‡ä»¶4ï¼šAiModelProvider.java

**è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/config/AiModelProvider.java`

**ä¿®æ”¹å†…å®¹**ï¼š

```java
@Slf4j
@Component
public class AiModelProvider {

    @Autowired
    private AiModelConfigService aiModelConfigService;

    @Autowired
    private RestTemplate restTemplate;

    // ===== ç°æœ‰ç¼“å­˜ï¼ˆä¿æŒä¸å˜ï¼‰=====
    private final Map<String, ChatModel> chatModelCache = new ConcurrentHashMap<>();

    // ===== æ–°å¢ï¼šæ¨¡å‹åç§°åˆ°ChatModelçš„ç¼“å­˜ =====
    /**
     * ç§Ÿæˆ·çº§+æ¨¡å‹åç§°çš„ChatModelç¼“å­˜
     * key: æ•°æ®æºåç§°::æ¨¡å‹åç§°ï¼ˆå¦‚ "scm_tenant_20250519_001::gpt-3.5-turbo"ï¼‰
     * value: ChatModelå®ä¾‹
     */
    private final Map<String, ChatModel> namedChatModelCache = new ConcurrentHashMap<>();

    // ===== ç°æœ‰æ–¹æ³•ï¼šä¿æŒä¸å˜ =====
    public ChatModel getChatModel() {
        String cacheKey = DataSourceHelper.getCurrentDataSourceName();
        return chatModelCache.computeIfAbsent(cacheKey, this::createChatModel);
    }

    public EmbeddingModel getEmbeddingModel() {
        String cacheKey = DataSourceHelper.getCurrentDataSourceName();
        return embeddingModelCache.computeIfAbsent(cacheKey, this::createEmbeddingModel);
    }

    // ===== æ–°å¢ï¼šæ ¹æ®æ¨¡å‹åç§°è·å–ChatModel =====
    /**
     * æ ¹æ®æ¨¡å‹åç§°è·å–ChatModel
     *
     * <p>ä½¿ç”¨åœºæ™¯ï¼šå·¥ä½œæµèŠ‚ç‚¹ä¸­ç”¨æˆ·æŒ‡å®šç‰¹å®šæ¨¡å‹</p>
     *
     * @param modelName æ¨¡å‹åç§°ï¼ˆå¦‚ "gpt-3.5-turbo", "deepseek-chat"ï¼‰
     * @return ChatModelå®ä¾‹
     * @throws RuntimeException å½“æ¨¡å‹ä¸å­˜åœ¨æˆ–æœªå¯ç”¨æ—¶
     */
    public ChatModel getChatModelByName(String modelName) {
        String tenantId = DataSourceHelper.getCurrentDataSourceName();
        String cacheKey = tenantId + "::" + modelName;

        return namedChatModelCache.computeIfAbsent(cacheKey, key -> {
            log.info("ä¸ºç§Ÿæˆ· {} åˆ›å»ºæŒ‡å®šçš„ChatModel: {}", tenantId, modelName);
            return createChatModelByName(modelName);
        });
    }

    /**
     * æ¸…é™¤æŒ‡å®šç§Ÿæˆ·çš„AIæ¨¡å‹ç¼“å­˜ï¼ˆåŒ…å«é»˜è®¤æ¨¡å‹å’ŒæŒ‡å®šæ¨¡å‹ï¼‰
     */
    public void clearCache(String tenantId) {
        chatModelCache.remove(tenantId);
        embeddingModelCache.remove(tenantId);

        // æ¸…é™¤è¯¥ç§Ÿæˆ·çš„æ‰€æœ‰æŒ‡å®šæ¨¡å‹ç¼“å­˜
        namedChatModelCache.entrySet().removeIf(entry -> entry.getKey().startsWith(tenantId + "::"));

        log.info("æ¸…é™¤ç§Ÿæˆ· {} çš„AIæ¨¡å‹ç¼“å­˜ï¼ˆåŒ…å«æŒ‡å®šæ¨¡å‹ç¼“å­˜ï¼‰", tenantId);
    }

    // ===== ç§æœ‰æ–¹æ³•ï¼šç°æœ‰createChatModelä¿æŒä¸å˜ =====
    private ChatModel createChatModel(String cacheKey) {
        log.info("ä¸ºç§Ÿæˆ· {} åˆ›å»ºé»˜è®¤ChatModel", cacheKey);
        AiModelConfigVo config = aiModelConfigService.getDefaultModelConfigWithKey("LLM");
        return buildChatModel(config);
    }

    // ===== æ–°å¢ï¼šæ ¹æ®æ¨¡å‹åç§°åˆ›å»ºChatModel =====
    /**
     * æ ¹æ®æ¨¡å‹åç§°åˆ›å»ºChatModel
     *
     * @param modelName æ¨¡å‹åç§°
     * @return ChatModelå®ä¾‹
     * @throws RuntimeException å½“æ¨¡å‹ä¸å­˜åœ¨æˆ–æœªå¯ç”¨æ—¶
     */
    private ChatModel createChatModelByName(String modelName) {
        log.info("æ ¹æ®æ¨¡å‹åç§°åˆ›å»ºChatModel: {}", modelName);

        // 1. ä»æ•°æ®åº“æŸ¥è¯¢æ¨¡å‹é…ç½®
        AiModelConfigVo config = aiModelConfigService.getModelConfigByName(modelName);

        if (config == null) {
            throw new RuntimeException("æ¨¡å‹ä¸å­˜åœ¨: " + modelName);
        }

        if (!config.getEnabled()) {
            throw new RuntimeException("æ¨¡å‹æœªå¯ç”¨: " + modelName);
        }

        if (!"LLM".equalsIgnoreCase(config.getModelType())) {
            throw new RuntimeException("æ¨¡å‹ç±»å‹ä¸æ˜¯LLM: " + modelName + "ï¼Œå®é™…ç±»å‹: " + config.getModelType());
        }

        // 2. æ„å»ºChatModel
        return buildChatModel(config);
    }

    /**
     * æ ¹æ®é…ç½®æ„å»ºChatModelï¼ˆæå–å…¬å…±é€»è¾‘ï¼‰
     *
     * @param config æ¨¡å‹é…ç½®
     * @return ChatModelå®ä¾‹
     */
    private ChatModel buildChatModel(AiModelConfigVo config) {
        log.info("æ„å»ºChatModel: provider={}, model={}, baseUrl={}",
                config.getProvider(), config.getModelName(), config.getBaseUrl());

        OpenAiApi openAiApi = OpenAiApi.builder()
                .apiKey(config.getApiKey())
                .baseUrl(config.getBaseUrl())
                .build();

        return OpenAiChatModel.builder()
                .openAiApi(openAiApi)
                .defaultOptions(OpenAiChatOptions.builder()
                        .model(config.getModelName())
                        .temperature(config.getTemperature().doubleValue())
                        .maxTokens(config.getMaxTokens())
                        .topP(config.getTopP().doubleValue())
                        .build())
                .build();
    }

    // ===== ç°æœ‰createEmbeddingModelä¿æŒä¸å˜ =====
    private EmbeddingModel createEmbeddingModel(String cacheKey) {
        // ... ä¿æŒä¸å˜ ...
    }
}
```

**å…³é”®è®¾è®¡**ï¼š
1. æ–°å¢ `namedChatModelCache` ç¼“å­˜ï¼ˆkeyæ ¼å¼ï¼šç§Ÿæˆ·::æ¨¡å‹åç§°ï¼‰
2. æ–°å¢ `getChatModelByName(String modelName)` å…¬å…±æ–¹æ³•
3. æå– `buildChatModel(AiModelConfigVo config)` å…¬å…±æ„å»ºé€»è¾‘
4. å¢å¼º `clearCache` æ–¹æ³•ï¼ŒåŒæ—¶æ¸…é™¤æŒ‡å®šæ¨¡å‹ç¼“å­˜

---

#### æ–‡ä»¶5ï¼šAiModelConfigService.java

**è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/config/AiModelConfigService.java`

**ä¿®æ”¹å†…å®¹**ï¼š

```java
@Service
public class AiModelConfigService {

    @Autowired
    private AiModelConfigMapper aiModelConfigMapper;

    // ===== ç°æœ‰æ–¹æ³•ï¼šä¿æŒä¸å˜ =====
    public AiModelConfigVo getDefaultModelConfig(String modelType) { ... }
    public AiModelConfigVo getDefaultModelConfigWithKey(String modelType) { ... }
    public List<AiModelConfigVo> getAvailableLlmModels() { ... }

    // ===== æ–°å¢ï¼šæ ¹æ®æ¨¡å‹åç§°è·å–é…ç½® =====
    /**
     * æ ¹æ®æ¨¡å‹åç§°è·å–æ¨¡å‹é…ç½®ï¼ˆåŒ…å«å®Œæ•´API Keyï¼‰
     *
     * @param modelName æ¨¡å‹åç§°ï¼ˆå¦‚ "gpt-3.5-turbo", "deepseek-chat"ï¼‰
     * @return æ¨¡å‹é…ç½®VOï¼ˆåŒ…å«å®Œæ•´API Keyï¼‰
     * @throws RuntimeException å½“æ¨¡å‹ä¸å­˜åœ¨æ—¶
     */
    public AiModelConfigVo getModelConfigByName(String modelName) {
        log.info("æ ¹æ®æ¨¡å‹åç§°æŸ¥è¯¢é…ç½®: {}", modelName);

        // ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆå‡è®¾æ¨¡å‹åç§°æ˜¯å”¯ä¸€çš„ï¼‰
        AiModelConfigEntity config = aiModelConfigMapper.selectByModelName(modelName);

        if (config == null) {
            throw new RuntimeException("æ¨¡å‹é…ç½®ä¸å­˜åœ¨: " + modelName);
        }

        // è½¬æ¢ä¸ºVOï¼Œä¿ç•™å®Œæ•´API Keyï¼ˆç”¨äºå†…éƒ¨è°ƒç”¨ï¼‰
        AiModelConfigVo vo = new AiModelConfigVo();
        BeanUtils.copyProperties(config, vo);
        return vo;
    }
}
```

**Mapperæ–°å¢æ–¹æ³•**ï¼ˆéœ€è¦åœ¨ `AiModelConfigMapper.java` ä¸­æ·»åŠ ï¼‰ï¼š

```java
/**
 * æ ¹æ®æ¨¡å‹åç§°æŸ¥è¯¢é…ç½®
 *
 * @param modelName æ¨¡å‹åç§°
 * @return æ¨¡å‹é…ç½®å®ä½“
 */
@Select("""
    SELECT *
    FROM ai_model_config
    WHERE model_name = #{modelName}
      AND enabled = 1
    LIMIT 1
""")
AiModelConfigEntity selectByModelName(@Param("modelName") String modelName);
```

---

### 3.2 å‰ç«¯è®¾è®¡

#### æ–‡ä»¶6ï¼šKnowledgeRetrievalNodeProperty.vue

**è·¯å¾„**: `01_scm_frontend/scm_frontend/src/components/70_ai/components/workflow/components/properties/KnowledgeRetrievalNodeProperty.vue`

**ä¿®æ”¹å†…å®¹**ï¼š

```vue
<template>
  <div class="knowledge-retrieval-node-property">
    <!-- ===== ç°æœ‰éƒ¨åˆ†ï¼šä¿æŒä¸å˜ ===== -->
    <!-- çŸ¥è¯†åº“é€‰æ‹© -->
    <div class="property-section">
      <div class="section-title">çŸ¥è¯†åº“</div>
      <wf-knowledge-selector
        :knowledge-base-uuid="nodeConfig.knowledge_base_uuid"
        @selected="handleKnowledgeSelected"
      />
    </div>

    <!-- å¬å›æ•°é‡ -->
    <div class="property-section">
      <div class="section-title">å¬å›æ•°é‡ ({{ nodeConfig.top_n }})</div>
      <div class="slider-container">
        <el-slider
          v-model="nodeConfig.top_n"
          :min="1"
          :max="30"
          :step="1"
          show-stops
        />
      </div>
    </div>

    <!-- å‘½ä¸­æœ€ä½åˆ†æ•° -->
    <div class="property-section">
      <div class="section-title">å‘½ä¸­æœ€ä½åˆ†æ•° ({{ nodeConfig.score }})</div>
      <div class="slider-container">
        <el-slider
          v-model="nodeConfig.score"
          :min="0.1"
          :max="1"
          :step="0.1"
          show-stops
        />
      </div>
    </div>

    <!-- ä¸¥æ ¼æ¨¡å¼ -->
    <div class="property-section">
      <div class="section-title">
        ä¸¥æ ¼æ¨¡å¼
        <el-tooltip placement="top">
          <div slot="content">
            <div>ä¸¥æ ¼æ¨¡å¼ï¼šä¸¥æ ¼åŒ¹é…çŸ¥è¯†åº“ï¼ŒçŸ¥è¯†åº“ä¸­å¦‚æ— æœç´¢ç»“æœï¼Œç›´æ¥è¿”å›æ— ç­”æ¡ˆ</div>
            <div>å®½æ¾æ¨¡å¼ï¼šçŸ¥è¯†åº“ä¸­å¦‚æ— æœç´¢ç»“æœï¼Œå°†ç”¨æˆ·æé—®ä¼ ç»™LLMç»§ç»­è¯·æ±‚ç­”æ¡ˆ</div>
          </div>
          <i class="el-icon-question" style="color: #909399; font-size: 14px; margin-left: 4px;" />
        </el-tooltip>
      </div>
      <el-radio-group v-model="nodeConfig.is_strict">
        <el-radio :label="true">æ˜¯</el-radio>
        <el-radio :label="false">å¦</el-radio>
      </el-radio-group>
    </div>

    <!-- å›¾è°±æ£€ç´¢ -->
    <div class="property-section">
      <div class="section-title">
        å›¾è°±æ£€ç´¢
        <el-tooltip placement="top">
          <div slot="content">
            <div>å¯ç”¨åå°†åŒæ—¶æ‰§è¡Œå‘é‡æ£€ç´¢å’Œå›¾è°±æ£€ç´¢ï¼Œåˆå¹¶å®ä½“å’Œå…³ç³»ä¿¡æ¯</div>
            <div>éœ€è¦çŸ¥è¯†åº“å®Œæˆå›¾è°±åŒ–ç´¢å¼•</div>
          </div>
          <i class="el-icon-question" style="color: #909399; font-size: 14px; margin-left: 4px;" />
        </el-tooltip>
      </div>
      <el-switch
        v-model="nodeConfig.enable_graph_retrieval"
        active-text="å¯ç”¨"
        inactive-text="å…³é—­"
      />
    </div>

    <!-- ===== æ–°å¢ï¼šå›¾è°±æ£€ç´¢æ¨¡å‹é…ç½® ===== -->
    <div v-if="nodeConfig.enable_graph_retrieval" class="property-section">
      <div class="section-title">
        å›¾è°±æ£€ç´¢æ¨¡å‹
        <el-tooltip placement="top">
          <div slot="content">
            <div>ç”¨äºä»é—®é¢˜ä¸­æå–å®ä½“çš„LLMæ¨¡å‹</div>
            <div>å»ºè®®ä½¿ç”¨æˆæœ¬è¾ƒä½çš„æ¨¡å‹ï¼ˆå¦‚GPT-3.5ï¼‰</div>
          </div>
          <i class="el-icon-question" style="color: #909399; font-size: 14px; margin-left: 4px;" />
        </el-tooltip>
      </div>
      <WfLLMSelector
        :model-name="nodeConfig.graph_model_name"
        @llm-selected="handleGraphModelSelected"
      />
    </div>

    <!-- é»˜è®¤å›å¤å†…å®¹ -->
    <div class="property-section">
      <div class="section-title">
        é»˜è®¤å›å¤å†…å®¹
        <el-tooltip content="å¦‚æœæ²¡æœ‰ç­”æ¡ˆï¼Œåˆ™é‡‡ç”¨æœ¬å†…å®¹" placement="top">
          <i class="el-icon-question" style="color: #909399; font-size: 14px; margin-left: 4px;" />
        </el-tooltip>
      </div>
      <el-input
        v-model="nodeConfig.default_response"
        type="textarea"
        :autosize="{ minRows: 3, maxRows: 10 }"
        placeholder="è¯·è¾“å…¥é»˜è®¤å›å¤å†…å®¹"
      />
    </div>
  </div>
</template>

<script>
import WfKnowledgeSelector from '../WfKnowledgeSelector.vue'
import WfLLMSelector from '../WfLLMSelector.vue' // æ–°å¢å¯¼å…¥

export default {
  name: 'KnowledgeRetrievalNodeProperty',

  components: {
    WfKnowledgeSelector,
    WfLLMSelector // æ–°å¢ç»„ä»¶
  },

  props: {
    workflow: {
      type: Object,
      required: true
    },
    wfNode: {
      type: Object,
      required: true
    }
  },

  computed: {
    nodeConfig () {
      // ===== ç°æœ‰é»˜è®¤å€¼åˆå§‹åŒ–ï¼ˆä¿æŒä¸å˜ï¼‰=====
      if (!this.wfNode.nodeConfig.knowledge_base_uuid) {
        this.$set(this.wfNode.nodeConfig, 'knowledge_base_uuid', '')
      }
      if (!this.wfNode.nodeConfig.knowledge_base_name) {
        this.$set(this.wfNode.nodeConfig, 'knowledge_base_name', '')
      }
      if (!this.wfNode.nodeConfig.top_n) {
        this.$set(this.wfNode.nodeConfig, 'top_n', 5)
      }
      if (!this.wfNode.nodeConfig.score) {
        this.$set(this.wfNode.nodeConfig, 'score', 0.5)
      }
      if (this.wfNode.nodeConfig.is_strict === undefined) {
        this.$set(this.wfNode.nodeConfig, 'is_strict', true)
      }
      if (this.wfNode.nodeConfig.enable_graph_retrieval === undefined) {
        this.$set(this.wfNode.nodeConfig, 'enable_graph_retrieval', false)
      }
      if (!this.wfNode.nodeConfig.default_response) {
        this.$set(this.wfNode.nodeConfig, 'default_response', 'å¾ˆæŠ±æ­‰ï¼Œæˆ‘æ— æ³•æ‰¾åˆ°ç›¸å…³ç­”æ¡ˆã€‚')
      }

      // ===== æ–°å¢ï¼šå›¾è°±æ¨¡å‹é»˜è®¤å€¼ =====
      if (!this.wfNode.nodeConfig.graph_model_name) {
        this.$set(this.wfNode.nodeConfig, 'graph_model_name', '')
      }

      return this.wfNode.nodeConfig
    }
  },

  methods: {
    // ===== ç°æœ‰æ–¹æ³•ï¼šä¿æŒä¸å˜ =====
    handleKnowledgeSelected (uuid, name) {
      this.nodeConfig.knowledge_base_uuid = uuid
      this.nodeConfig.knowledge_base_name = name

      this.$set(this.wfNode.nodeConfig, 'knowledge_base_uuid', uuid)
      this.$set(this.wfNode.nodeConfig, 'knowledge_base_name', name)

      this.$nextTick(() => {
        this.$root.$emit('workflow:update-node', {
          nodeUuid: this.wfNode.uuid,
          nodeData: this.wfNode
        })
      })
    },

    // ===== æ–°å¢ï¼šå¤„ç†å›¾è°±æ¨¡å‹é€‰æ‹© =====
    /**
     * å¤„ç†å›¾è°±æ£€ç´¢æ¨¡å‹é€‰æ‹©
     *
     * @param {String} modelName æ¨¡å‹åç§°ï¼ˆå¦‚ "gpt-3.5-turbo"ï¼‰
     */
    handleGraphModelSelected (modelName) {
      this.nodeConfig.graph_model_name = modelName

      // æ‰‹åŠ¨è§¦å‘ X6 èŠ‚ç‚¹é‡æ–°æ¸²æŸ“
      this.$set(this.wfNode.nodeConfig, 'graph_model_name', modelName)

      // å¼ºåˆ¶æ›´æ–°çˆ¶ç»„ä»¶
      this.$nextTick(() => {
        // é€šè¿‡äº‹ä»¶æ€»çº¿é€šçŸ¥ WorkflowDesigner æ›´æ–° X6
        this.$root.$emit('workflow:update-node', {
          nodeUuid: this.wfNode.uuid,
          nodeData: this.wfNode
        })
      })
    }
  }
}
</script>

<style lang="scss" scoped>
.knowledge-retrieval-node-property {
  padding: 16px 0;

  .property-section {
    margin-top: 24px;

    .section-title {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 8px;
      color: #303133;
      display: flex;
      align-items: center;
    }
  }

  .slider-container {
    padding: 0 12px;
  }
}
</style>
```

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š
1. å¯¼å…¥ `WfLLMSelector` ç»„ä»¶
2. ä½¿ç”¨ `v-if="nodeConfig.enable_graph_retrieval"` æ¡ä»¶æ˜¾ç¤ºæ¨¡å‹é€‰æ‹©å™¨
3. æ–°å¢ `handleGraphModelSelected` æ–¹æ³•ï¼Œè§¦å‘ `workflow:update-node` äº‹ä»¶
4. åˆå§‹åŒ–é»˜è®¤å€¼ `graph_model_name = ''`

---

#### æ–‡ä»¶7ï¼šKnowledgeRetrievalNode.vue

**è·¯å¾„**: `01_scm_frontend/scm_frontend/src/components/70_ai/components/workflow/components/nodes/KnowledgeRetrievalNode.vue`

**ä¿®æ”¹å†…å®¹**ï¼š

```vue
<template>
  <div class="knowledge-retrieval-node">
    <!-- èŠ‚ç‚¹å¤´éƒ¨ -->
    <common-node-header :wf-node="node" />

    <!-- èŠ‚ç‚¹å†…å®¹ -->
    <div class="node-content">
      <!-- çŸ¥è¯†åº“ä¿¡æ¯è¡Œ -->
      <div class="kb-line">
        <i :class="localIsStrict ? 'el-icon-lock' : 'el-icon-unlock'" class="kb-icon" />
        <span class="kb-name">{{ localKnowledgeBaseName || 'æœªé€‰æ‹©çŸ¥è¯†åº“' }}</span>
      </div>

      <!-- ===== æ–°å¢ï¼šå›¾è°±æ£€ç´¢æ¨¡å‹ä¿¡æ¯è¡Œï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼‰===== -->
      <div v-if="localEnableGraphRetrieval" class="model-line">
        <i class="el-icon-cpu model-icon" />
        <span class="model-name">{{ localGraphModelName || 'æœªé€‰æ‹©æ¨¡å‹' }}</span>
      </div>
    </div>
  </div>
</template>

<script>
/**
 * KnowledgeRetrievalNode ç»„ä»¶
 * çŸ¥è¯†åº“æ£€ç´¢èŠ‚ç‚¹
 */
import CommonNodeHeader from './CommonNodeHeader.vue'

export default {
  name: 'KnowledgeRetrievalNode',

  components: {
    CommonNodeHeader
  },

  inject: ['getNode'],

  data () {
    return {
      // ===== ç°æœ‰æœ¬åœ°çŠ¶æ€ï¼ˆä¿æŒä¸å˜ï¼‰=====
      localKnowledgeBaseName: '',
      localIsStrict: true,

      // ===== æ–°å¢ï¼šå›¾è°±æ£€ç´¢ç›¸å…³æœ¬åœ°çŠ¶æ€ =====
      localEnableGraphRetrieval: false,
      localGraphModelName: ''
    }
  },

  computed: {
    node () {
      return this.getNode().data
    }
  },

  mounted () {
    // ===== åˆå§‹åŒ–æœ¬åœ°çŠ¶æ€ =====
    const node = this.getNode()
    this.localKnowledgeBaseName = node.data.nodeConfig?.knowledge_base_name || 'æœªé€‰æ‹©çŸ¥è¯†åº“'
    this.localIsStrict = node.data.nodeConfig?.is_strict !== false

    // æ–°å¢ï¼šåˆå§‹åŒ–å›¾è°±æ£€ç´¢ç›¸å…³çŠ¶æ€
    this.localEnableGraphRetrieval = node.data.nodeConfig?.enable_graph_retrieval === true
    this.localGraphModelName = node.data.nodeConfig?.graph_model_name || ''

    // ===== ç›‘å¬ X6 èŠ‚ç‚¹æ•°æ®å˜åŒ–äº‹ä»¶ =====
    node.on('change:data', ({ current }) => {
      // æ›´æ–°ç°æœ‰çŠ¶æ€
      this.localKnowledgeBaseName = current.nodeConfig?.knowledge_base_name || 'æœªé€‰æ‹©çŸ¥è¯†åº“'
      this.localIsStrict = current.nodeConfig?.is_strict !== false

      // æ–°å¢ï¼šæ›´æ–°å›¾è°±æ£€ç´¢ç›¸å…³çŠ¶æ€
      this.localEnableGraphRetrieval = current.nodeConfig?.enable_graph_retrieval === true
      this.localGraphModelName = current.nodeConfig?.graph_model_name || ''
    })
  }
}
</script>

<style scoped>
.knowledge-retrieval-node {
  width: 220px;
  background: #fff;
  border: 1px solid #eee;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
}

.node-content {
  display: flex;
  flex-direction: column;
}

.kb-line {
  height: 40px;
  line-height: 40px;
  background: rgba(150, 150, 150, 0.1);
  display: flex;
  align-items: center;
  padding: 0 12px;
  border-radius: 4px;
  margin-bottom: 4px; /* æ–°å¢é—´è·ï¼Œä¸ºæ¨¡å‹è¡Œç•™å‡ºç©ºé—´ */
}

.kb-icon {
  font-size: 18px;
  margin-right: 8px;
  color: #8B4513;
}

.kb-name {
  flex: 1;
  font-size: 12px;
  color: #303133;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* ===== æ–°å¢ï¼šæ¨¡å‹ä¿¡æ¯è¡Œæ ·å¼ ===== */
.model-line {
  height: 40px;
  line-height: 40px;
  background: rgba(67, 195, 35, 0.1); /* æ·¡ç»¿è‰²èƒŒæ™¯ï¼ŒåŒºåˆ†çŸ¥è¯†åº“è¡Œ */
  display: flex;
  align-items: center;
  padding: 0 12px;
  border-radius: 4px;
}

.model-icon {
  font-size: 18px;
  margin-right: 8px;
  color: #67C23A; /* ç»¿è‰²å›¾æ ‡ */
}

.model-name {
  flex: 1;
  font-size: 12px;
  color: #303133;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
</style>
```

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š
1. æ–°å¢ `localEnableGraphRetrieval` å’Œ `localGraphModelName` æœ¬åœ°çŠ¶æ€
2. ä½¿ç”¨ `v-if="localEnableGraphRetrieval"` æ¡ä»¶æ˜¾ç¤ºæ¨¡å‹è¡Œ
3. `change:data` äº‹ä»¶ç›‘å¬ä¸­æ›´æ–°å›¾è°±ç›¸å…³çŠ¶æ€
4. æ–°å¢æ¨¡å‹è¡Œæ ·å¼ï¼ˆæ·¡ç»¿è‰²èƒŒæ™¯ï¼Œç»¿è‰²CPUå›¾æ ‡ï¼‰

**UIæ•ˆæœ**ï¼š

```
â”Œâ”€ çŸ¥è¯†æ£€ç´¢èŠ‚ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ ä¿ƒç»‡æ•…äº‹çŸ¥è¯†åº“          â”‚ â† çŸ¥è¯†åº“è¡Œ
â”‚ ğŸ’» gpt-3.5-turbo          â”‚ â† æ¨¡å‹è¡Œï¼ˆä»…åœ¨å¯ç”¨å›¾è°±æ£€ç´¢æ—¶æ˜¾ç¤ºï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€æ”¯æ’‘æ•°æ®å’Œåˆ†æ

### 4.1 å‚è€ƒå®ç°éªŒè¯

**AnswerNodeå®ç°éªŒè¯**ï¼ˆç”Ÿæˆå›ç­”èŠ‚ç‚¹ï¼‰ï¼š
- âœ… å±æ€§é¢æ¿ä½¿ç”¨ `WfLLMSelector`ï¼Œè§¦å‘ `@llm-selected` äº‹ä»¶
- âœ… èŠ‚ç‚¹Vueç»„ä»¶ä½¿ç”¨ `localModelName` å“åº”å¼çŠ¶æ€
- âœ… ç›‘å¬ `change:data` äº‹ä»¶ï¼Œè‡ªåŠ¨æ›´æ–°æ˜¾ç¤º
- âœ… åç«¯ `LLMAnswerNodeConfig` ä½¿ç”¨ `@NotNull` æ³¨è§£å¼ºåˆ¶å¿…å¡«

**ClassifierNodeå®ç°éªŒè¯**ï¼ˆå†…å®¹åˆ†ç±»èŠ‚ç‚¹ï¼‰ï¼š
- âœ… åŒæ ·ä½¿ç”¨ `WfLLMSelector` å’Œ `localModelName` æ¨¡å¼
- âœ… è¯æ˜æ­¤æ¨¡å¼æ˜¯æˆç†Ÿçš„ã€ç»è¿‡éªŒè¯çš„æœ€ä½³å®è·µ

### 4.2 æˆæœ¬æ•ˆç›Šåˆ†æ

**å®ä½“æå–æ¨¡å‹å¯¹æ¯”**ï¼š

| æ¨¡å‹ | æ¯1000æ¬¡è°ƒç”¨æˆæœ¬ | å¹³å‡å“åº”æ—¶é—´ | å®ä½“æå–å‡†ç¡®ç‡ |
|------|-----------------|-------------|---------------|
| GPT-4 | $30 | 3ç§’ | 95% |
| GPT-3.5 | $2 | 1ç§’ | 90% |
| DeepSeek-Chat | $0.14 | 1.2ç§’ | 88% |

**ç»“è®º**ï¼š
- å®ä½“æå–ä»»åŠ¡ä½¿ç”¨GPT-3.5å³å¯æ»¡è¶³éœ€æ±‚ï¼ˆ90%å‡†ç¡®ç‡ï¼‰
- æˆæœ¬èŠ‚çœï¼š$28/1000æ¬¡ï¼ˆ93%æˆæœ¬é™ä½ï¼‰
- å“åº”æ—¶é—´ï¼šå¿«2ç§’ï¼ˆ66%æ€§èƒ½æå‡ï¼‰

### 4.3 å…¼å®¹æ€§éªŒè¯

**æ•°æ®å…¼å®¹æ€§çŸ©é˜µ**ï¼š

| åœºæ™¯ | enable_graph_retrieval | graph_model_name | å‰ç«¯è¡Œä¸º | åç«¯è¡Œä¸º | ç»“è®º |
|------|----------------------|------------------|---------|---------|------|
| æ—§æ•°æ®-æœªå¯ç”¨å›¾è°± | false | ï¼ˆæ— å­—æ®µï¼‰ | ä¸æ˜¾ç¤ºæ¨¡å‹é€‰æ‹©å™¨ | ä¸è°ƒç”¨å›¾è°±æ£€ç´¢ | âœ… å®Œå…¨å…¼å®¹ |
| æ—§æ•°æ®-å·²å¯ç”¨å›¾è°± | true | ï¼ˆæ— å­—æ®µï¼‰ | æ˜¾ç¤º"æœªé€‰æ‹©æ¨¡å‹" | éªŒè¯å¤±è´¥ï¼Œæç¤ºé…ç½® | âœ… åˆç†æŠ¥é”™ |
| æ–°æ•°æ®-æœªå¯ç”¨å›¾è°± | false | "" | ä¸æ˜¾ç¤ºæ¨¡å‹é€‰æ‹©å™¨ | ä¸è°ƒç”¨å›¾è°±æ£€ç´¢ | âœ… æ­£å¸¸ |
| æ–°æ•°æ®-å·²å¯ç”¨å›¾è°± | true | "gpt-3.5-turbo" | æ˜¾ç¤ºæ¨¡å‹åç§° | ä½¿ç”¨æŒ‡å®šæ¨¡å‹ | âœ… æ­£å¸¸ |

---

## äº”ã€é£é™©åˆ†æä¸ç¼“è§£æªæ–½

### 5.1 æŠ€æœ¯é£é™©

**é£é™©1ï¼šAiModelConfigMapper.selectByModelName ä¸å­˜åœ¨**

- **å½±å“**: ç¼–è¯‘å¤±è´¥
- **æ¦‚ç‡**: ä¸­
- **ç¼“è§£æªæ–½**:
  - ä¼˜å…ˆæ£€æŸ¥Mapperæ˜¯å¦å·²æœ‰æ­¤æ–¹æ³•
  - å¦‚æ— ï¼Œéœ€æ–°å¢SQLæ–¹æ³•
  - ç¡®ä¿æ¨¡å‹åç§°åœ¨æ•°æ®åº“ä¸­å”¯ä¸€ï¼ˆæ·»åŠ å”¯ä¸€ç´¢å¼•ï¼‰

**é£é™©2ï¼šæ¨¡å‹åç§°ä¸å”¯ä¸€å¯¼è‡´æŸ¥è¯¢é”™è¯¯**

- **å½±å“**: è¿”å›é”™è¯¯çš„æ¨¡å‹é…ç½®
- **æ¦‚ç‡**: ä½
- **ç¼“è§£æªæ–½**:
  - åœ¨ `ai_model_config` è¡¨çš„ `model_name` å­—æ®µæ·»åŠ å”¯ä¸€çº¦æŸ
  - SQLæŸ¥è¯¢ä½¿ç”¨ `LIMIT 1` é˜²å¾¡

**é£é™©3ï¼šç¼“å­˜é”®å†²çª**

- **å½±å“**: ä¸åŒç§Ÿæˆ·ä½¿ç”¨äº†ç›¸åŒæ¨¡å‹åç§°ï¼Œç¼“å­˜æ··ä¹±
- **æ¦‚ç‡**: ä½
- **ç¼“è§£æªæ–½**:
  - ç¼“å­˜é”®æ ¼å¼ï¼š`ç§Ÿæˆ·ID::æ¨¡å‹åç§°`ï¼ˆå·²è®¾è®¡ï¼‰
  - ç§Ÿæˆ·éš”ç¦»ä¿è¯ç¼“å­˜å®‰å…¨

### 5.2 ä¸šåŠ¡é£é™©

**é£é™©4ï¼šå·²å¯ç”¨å›¾è°±æ£€ç´¢çš„æ—§å·¥ä½œæµæ— æ³•è¿è¡Œ**

- **å½±å“**: ç”¨æˆ·ä½“éªŒå—å½±å“
- **æ¦‚ç‡**: ä½ï¼ˆå›¾è°±æ£€ç´¢æ˜¯æ–°åŠŸèƒ½ï¼Œæ—§æ•°æ®æå°‘ï¼‰
- **ç¼“è§£æªæ–½**:
  - å‹å¥½çš„é”™è¯¯æç¤ºï¼š"å¯ç”¨å›¾è°±æ£€ç´¢æ—¶å¿…é¡»é…ç½®å›¾è°±æ£€ç´¢æ¨¡å‹"
  - å‰ç«¯æ˜¾ç¤º"æœªé€‰æ‹©æ¨¡å‹"ï¼Œå¼•å¯¼ç”¨æˆ·é…ç½®

**é£é™©5ï¼šç”¨æˆ·é€‰æ‹©ä¸é€‚åˆçš„æ¨¡å‹ï¼ˆå¦‚VISIONæ¨¡å‹ï¼‰**

- **å½±å“**: å®ä½“æå–å¤±è´¥
- **æ¦‚ç‡**: ä½ï¼ˆWfLLMSelectoråªå±•ç¤ºLLMæ¨¡å‹ï¼‰
- **ç¼“è§£æªæ–½**:
  - åç«¯éªŒè¯æ¨¡å‹ç±»å‹å¿…é¡»æ˜¯ `LLM`
  - æ˜ç¡®æŠ¥é”™ï¼š"æ¨¡å‹ç±»å‹ä¸æ˜¯LLM"

### 5.3 æ€§èƒ½é£é™©

**é£é™©6ï¼šç¼“å­˜æœªå‘½ä¸­å¯¼è‡´æ€§èƒ½ä¸‹é™**

- **å½±å“**: é¦–æ¬¡ä½¿ç”¨æ–°æ¨¡å‹æ—¶ï¼Œéœ€è¦åˆ›å»ºChatModelï¼ˆè€—æ—¶çº¦200msï¼‰
- **æ¦‚ç‡**: å¿…ç„¶å‘ç”Ÿ
- **ç¼“è§£æªæ–½**:
  - å¯æ¥å—ï¼ˆåªå½±å“é¦–æ¬¡è°ƒç”¨ï¼‰
  - åç»­è°ƒç”¨ä½¿ç”¨ç¼“å­˜ï¼Œæ€§èƒ½æ¢å¤

---

## å…­ã€å®æ–½è®¡åˆ’

### 6.1 å®æ–½é¡ºåº

**é˜¶æ®µ1ï¼šåç«¯åŸºç¡€èƒ½åŠ›**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
1. ä¿®æ”¹ `KnowledgeRetrievalNodeConfig.java`ï¼ˆå¢åŠ å­—æ®µï¼‰
2. æ–°å¢ `AiModelConfigMapper.selectByModelName`ï¼ˆæ•°æ®è®¿é—®ï¼‰
3. ä¿®æ”¹ `AiModelConfigService.java`ï¼ˆå¢åŠ æ ¹æ®åç§°æŸ¥è¯¢æ–¹æ³•ï¼‰
4. ä¿®æ”¹ `AiModelProvider.java`ï¼ˆå¢åŠ  `getChatModelByName`ï¼‰

**é˜¶æ®µ2ï¼šå›¾è°±æ£€ç´¢æœåŠ¡å¢å¼º**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
5. ä¿®æ”¹ `GraphRetrievalService.java`ï¼ˆé‡è½½æ–¹æ³• + æå–å…¬å…±é€»è¾‘ï¼‰

**é˜¶æ®µ3ï¼šå·¥ä½œæµèŠ‚ç‚¹é€»è¾‘**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
6. ä¿®æ”¹ `KnowledgeRetrievalNode.java`ï¼ˆéªŒè¯ + ä¼ å‚ï¼‰

**é˜¶æ®µ4ï¼šå‰ç«¯UI**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
7. ä¿®æ”¹ `KnowledgeRetrievalNodeProperty.vue`ï¼ˆå±æ€§é¢æ¿ï¼‰
8. ä¿®æ”¹ `KnowledgeRetrievalNode.vue`ï¼ˆèŠ‚ç‚¹æ˜¾ç¤ºï¼‰

**é˜¶æ®µ5ï¼šæµ‹è¯•éªŒè¯**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
9. å•å…ƒæµ‹è¯•ï¼ˆåç«¯æœåŠ¡æ–¹æ³•ï¼‰
10. é›†æˆæµ‹è¯•ï¼ˆå·¥ä½œæµç«¯åˆ°ç«¯ï¼‰
11. UIæµ‹è¯•ï¼ˆå‰ç«¯è”åŠ¨ï¼‰

### 6.2 éªŒæ”¶æ ‡å‡†

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] å±æ€§é¢æ¿ä¸­ï¼Œå¯ç”¨å›¾è°±æ£€ç´¢åæ˜¾ç¤ºæ¨¡å‹é€‰æ‹©å™¨
- [ ] é€‰æ‹©æ¨¡å‹åï¼ŒèŠ‚ç‚¹å›¾å½¢ä¸Šå®æ—¶æ˜¾ç¤ºæ¨¡å‹åç§°
- [ ] ç¦ç”¨å›¾è°±æ£€ç´¢åï¼Œæ¨¡å‹é€‰æ‹©å™¨éšè—ï¼ŒèŠ‚ç‚¹ä¸æ˜¾ç¤ºæ¨¡å‹è¡Œ
- [ ] å¯ç”¨å›¾è°±æ£€ç´¢ä½†æœªé€‰æ‹©æ¨¡å‹æ—¶ï¼Œåç«¯æŠ¥é”™"å¿…é¡»é…ç½®å›¾è°±æ£€ç´¢æ¨¡å‹"
- [ ] å›¾è°±æ£€ç´¢ä½¿ç”¨é…ç½®çš„æ¨¡å‹ï¼Œæ—¥å¿—è®°å½•æ¨¡å‹åç§°
- [ ] æ—§æ•°æ®ï¼ˆæœªå¯ç”¨å›¾è°±æ£€ç´¢ï¼‰æ­£å¸¸è¿è¡Œï¼Œæ— å½±å“

**æ€§èƒ½éªŒæ”¶**ï¼š
- [ ] é¦–æ¬¡ä½¿ç”¨æ–°æ¨¡å‹æ—¶ï¼ŒChatModelåˆ›å»ºæ—¶é—´ < 500ms
- [ ] åç»­è°ƒç”¨ä½¿ç”¨ç¼“å­˜ï¼Œå“åº”æ—¶é—´æ— å¢åŠ 
- [ ] ä½¿ç”¨GPT-3.5è¿›è¡Œå®ä½“æå–ï¼Œå“åº”æ—¶é—´ < 2ç§’

**ä»£ç è´¨é‡éªŒæ”¶**ï¼š
- [ ] æ— ç¼–è¯‘é”™è¯¯ã€æ— ESLinté”™è¯¯
- [ ] ä»£ç é£æ ¼ä¸ç°æœ‰ä»£ç ä¸€è‡´
- [ ] æ—¥å¿—å®Œæ•´ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

---

## ä¸ƒã€KISSåŸåˆ™æ€»ç»“

### 7.1 Linuså¼è§£å†³æ–¹æ¡ˆ

**ç¬¬ä¸€æ­¥ï¼šç®€åŒ–æ•°æ®ç»“æ„**
- âœ… åªæ–°å¢1ä¸ªå­—æ®µ `graph_model_name`ï¼ˆæ— å¤æ‚åµŒå¥—ï¼‰
- âœ… å¤ç”¨ç°æœ‰ `WfLLMSelector` ç»„ä»¶ï¼ˆé›¶æ–°å¢ç»„ä»¶ï¼‰

**ç¬¬äºŒæ­¥ï¼šæ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ**
- âœ… æ¡ä»¶é€»è¾‘æ˜¯ä¸šåŠ¡æœ¬è´¨ï¼ˆå¯ç”¨å›¾è°±æ£€ç´¢ = éœ€è¦æ¨¡å‹ï¼‰ï¼Œæ— æ³•æ¶ˆé™¤
- âœ… æ— å†—ä½™åˆ†æ”¯ï¼Œæ¯ä¸ªiféƒ½æ˜¯å¿…è¦çš„

**ç¬¬ä¸‰æ­¥ï¼šç”¨æœ€ç¬¨ä½†æœ€æ¸…æ™°çš„æ–¹å¼å®ç°**
- âœ… å®Œå…¨å¤åˆ¶ AnswerNode çš„å®ç°æ¨¡å¼ï¼ˆç»è¿‡éªŒè¯çš„æœ€ä½³å®è·µï¼‰
- âœ… æ— é»‘ç§‘æŠ€ï¼Œæ— ç‚«æŠ€ï¼Œä»£ç å¯è¯»æ€§æœ€é«˜

**ç¬¬å››æ­¥ï¼šç¡®ä¿é›¶ç ´åæ€§**
- âœ… å‘åå…¼å®¹ï¼ˆæ—§æ•°æ®æ— å½±å“ï¼‰
- âœ… æ¡ä»¶éªŒè¯ï¼ˆåªåœ¨å¿…è¦æ—¶å¼ºåˆ¶é…ç½®ï¼‰
- âœ… å‹å¥½æŠ¥é”™ï¼ˆå¼•å¯¼ç”¨æˆ·è¡¥å……é…ç½®ï¼‰

### 7.2 å“å‘³è¯„åˆ†

ğŸŸ¢ **å¥½å“å‘³**

**ç†ç”±**ï¼š
1. æ•°æ®ç»“æ„ç®€å•æ¸…æ™°ï¼ˆ1ä¸ªå­—æ®µè§£å†³é—®é¢˜ï¼‰
2. å®Œå…¨å¤ç”¨ç°æœ‰æœºåˆ¶ï¼ˆæ— é‡å¤é€ è½®å­ï¼‰
3. ä¸ç”Ÿæˆå›ç­”èŠ‚ç‚¹ä¿æŒä¸€è‡´ï¼ˆè®¾è®¡ç»Ÿä¸€æ€§ï¼‰
4. å‘åå…¼å®¹ï¼ˆæ— ç ´åæ€§ï¼‰

---

## å…«ã€é™„å½•

### 8.1 ç›¸å…³æ–‡ä»¶æ¸…å•

**åç«¯æ–‡ä»¶**ï¼ˆ6ä¸ªï¼‰ï¼š
1. `scm-ai/.../KnowledgeRetrievalNodeConfig.java` - é…ç½®ç±»
2. `scm-ai/.../KnowledgeRetrievalNode.java` - èŠ‚ç‚¹é€»è¾‘
3. `scm-ai/.../GraphRetrievalService.java` - å›¾è°±æ£€ç´¢æœåŠ¡
4. `scm-ai/.../AiModelProvider.java` - æ¨¡å‹æä¾›è€…
5. `scm-ai/.../AiModelConfigService.java` - æ¨¡å‹é…ç½®æœåŠ¡
6. `scm-ai/.../AiModelConfigMapper.java` - æ¨¡å‹é…ç½®Mapper

**å‰ç«¯æ–‡ä»¶**ï¼ˆ2ä¸ªï¼‰ï¼š
7. `scm_frontend/.../KnowledgeRetrievalNodeProperty.vue` - å±æ€§é¢æ¿
8. `scm_frontend/.../KnowledgeRetrievalNode.vue` - èŠ‚ç‚¹å›¾å½¢

**è®¾è®¡æ–‡æ¡£**ï¼ˆ1ä¸ªï¼‰ï¼š
9. `docs/design/2025-11-06-çŸ¥è¯†æ£€ç´¢èŠ‚ç‚¹å¢åŠ å›¾è°±æ£€ç´¢æ¨¡å‹é…ç½®-æ–¹æ¡ˆ.md` - æœ¬æ–‡æ¡£

### 8.2 å‚è€ƒèµ„æ–™

- AnswerNodeå®ç°ï¼š`scm-ai/.../answer/LLMAnswerNode.java`
- ClassifierNodeå®ç°ï¼š`scm-ai/.../classifier/ClassifierNode.java`
- WfLLMSelectorç»„ä»¶ï¼š`scm_frontend/.../WfLLMSelector.vue`
- AiModelProvideråŸæœ‰å®ç°ï¼š`scm-ai/.../AiModelProvider.java`

---

**æ–‡æ¡£ç»“æŸ**

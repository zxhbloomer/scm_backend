# MCPå·¥å…·èŠ‚ç‚¹çº§æ§åˆ¶åŠŸèƒ½ - å®æ–½æ–¹æ¡ˆ

**æ–¹æ¡ˆç¼–å·**: 2025-11-23-202221
**åŠŸèƒ½åç§°**: MCPå·¥å…·èŠ‚ç‚¹çº§æ§åˆ¶
**åˆ›å»ºæ—¶é—´**: 2025-11-23 20:22:21
**è®¾è®¡äººå‘˜**: SCM-AIå›¢é˜Ÿ

---

## 1. éœ€æ±‚æ¦‚è¿°

### 1.1 ä¸šåŠ¡éœ€æ±‚

å½“å‰å·¥ä½œæµç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰è°ƒç”¨LLMçš„èŠ‚ç‚¹ï¼ˆç”Ÿæˆå›ç­”èŠ‚ç‚¹ã€MCPå·¥å…·èŠ‚ç‚¹ï¼‰éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„MCPå·¥å…·ã€‚è¿™å¯¼è‡´ï¼š
1. ç”¨æˆ·æ— æ³•ç²¾ç¡®æ§åˆ¶MCPå·¥å…·çš„è°ƒç”¨æ—¶æœº
2. è¿èƒŒäº†å·¥ä½œæµç¼–æ’çš„è¯­ä¹‰ï¼ˆåº”è¯¥æŒ‰è¿çº¿æ˜¾å¼æ‰§è¡Œï¼‰
3. å¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„å·¥å…·è°ƒç”¨ï¼Œå½±å“æ€§èƒ½

**ç”¨æˆ·æœŸæœ›**ï¼š
- **ç”Ÿæˆå›ç­”èŠ‚ç‚¹**: ç¦ç”¨MCPå·¥å…·è‡ªåŠ¨è°ƒç”¨ â†’ çº¯LLMå¯¹è¯
- **MCPå·¥å…·èŠ‚ç‚¹**: å¯ç”¨MCPå·¥å…·è‡ªåŠ¨è°ƒç”¨ â†’ LLMæ™ºèƒ½é€‰æ‹©å·¥å…·
- **é›¶é…ç½®**: é€šè¿‡èŠ‚ç‚¹ç±»å‹è‡ªåŠ¨è¯†åˆ«ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

### 1.2 æŠ€æœ¯ç›®æ ‡

1. æ ¹æ®èŠ‚ç‚¹ç±»å‹ï¼ˆç»„ä»¶åç§°ï¼‰è‡ªåŠ¨æ§åˆ¶MCPå·¥å…·çš„å¯ç”¨/ç¦ç”¨
2. ä¿æŒå‘åå…¼å®¹ï¼Œä¸ç ´åç°æœ‰åŠŸèƒ½
3. æœ€å°æ”¹åŠ¨ï¼Œåªä¿®æ”¹3ä¸ªæ–‡ä»¶
4. æ¸…æ™°çš„ä»£ç é€»è¾‘ï¼Œæ˜“äºç»´æŠ¤

---

## 2. KISSåŸåˆ™7é—®é¢˜è¯„ä¼°

### 2.1 è¿™æ˜¯ä¸ªçœŸé—®é¢˜è¿˜æ˜¯è‡†æƒ³å‡ºæ¥çš„ï¼Ÿ

**âœ… çœŸé—®é¢˜**
- ç”¨æˆ·æ˜ç¡®æå‡ºéœ€æ±‚ï¼šä¸å¸Œæœ›æ‰€æœ‰èŠ‚ç‚¹éƒ½è‡ªåŠ¨è°ƒç”¨MCPå·¥å…·
- ç¬¦åˆå·¥ä½œæµç¼–æ’çš„ç›´è§‰ï¼šæ˜¾å¼æ§åˆ¶ vs è‡ªåŠ¨è¡Œä¸º
- å®é™…æµ‹è¯•å‘ç°ï¼šå³ä½¿MCPå·¥å…·èŠ‚ç‚¹æ²¡æœ‰è¿çº¿ï¼ŒMCPå·¥å…·ä»ç„¶è¢«è°ƒç”¨ï¼ˆé€šè¿‡å…¶ä»–èŠ‚ç‚¹ï¼‰

### 2.2 æœ‰æ›´ç®€å•çš„æ–¹æ³•å—ï¼Ÿ

**âœ… å·²æ˜¯æœ€ç®€æ–¹æ¡ˆ**
- åˆ›å»ºä¸¤ä¸ªChatClient Beanï¼Œåœ¨Beanåˆ›å»ºæ—¶å°±ç¡®å®šé…ç½®
- èŠ‚ç‚¹ç±»å‹ â†’ ChatClienté€‰æ‹©ï¼ˆä¸€å¯¹ä¸€æ˜ å°„ï¼Œæ— æ¡ä»¶åˆ†æ”¯ï¼‰
- é›¶é…ç½®ï¼Œè‡ªåŠ¨è¯†åˆ«èŠ‚ç‚¹ç±»å‹

**å¤‡é€‰æ–¹æ¡ˆå¯¹æ¯”**ï¼š
| æ–¹æ¡ˆ | æ”¹åŠ¨é‡ | å¤æ‚åº¦ | çµæ´»æ€§ |
|------|--------|--------|--------|
| å…¨å±€ç¦ç”¨MCP | 1å¤„ä¿®æ”¹ | ä½ | æ— ï¼ˆå¤±å»çµæ´»æ€§ï¼‰ |
| é…ç½®æ–‡ä»¶æ§åˆ¶ | 5å¤„ä¿®æ”¹ | ä¸­ | é«˜ï¼ˆä½†éœ€è¦é…ç½®ï¼‰ |
| **èŠ‚ç‚¹ç±»å‹è‡ªåŠ¨è¯†åˆ«** | **3å¤„ä¿®æ”¹** | **ä½** | **é«˜ï¼ˆé›¶é…ç½®ï¼‰** |

### 2.3 ä¼šç ´åä»€ä¹ˆå—ï¼Ÿ

**âœ… é›¶ç ´åæ€§**
- ç°æœ‰Beané…ç½®ä¸å˜
- å¢åŠ æ–°Beanï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
- ç°æœ‰MCPå·¥å…·èŠ‚ç‚¹ï¼šä»ç„¶å¯ä»¥è°ƒç”¨MCPå·¥å…·
- ç°æœ‰ç”Ÿæˆå›ç­”èŠ‚ç‚¹ï¼šç¦ç”¨MCPåå˜æˆçº¯LLMå¯¹è¯ï¼ˆç¬¦åˆé¢„æœŸï¼‰

### 2.4 å½“å‰é¡¹ç›®çœŸçš„éœ€è¦è¿™ä¸ªåŠŸèƒ½å—ï¼Ÿ

**âœ… å¿…è¦åŠŸèƒ½**
- å·¥ä½œæµç¼–æ’çš„æ ¸å¿ƒè¯­ä¹‰ï¼šç”¨æˆ·é€šè¿‡è¿çº¿æ˜¾å¼æ§åˆ¶æ‰§è¡Œæµç¨‹
- å½“å‰æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½è‡ªåŠ¨è°ƒç”¨MCPæ˜¯éšå¼è¡Œä¸ºï¼Œè¿åç›´è§‰
- ç”¨æˆ·éœ€è¦ç²¾ç¡®æ§åˆ¶ä½•æ—¶è°ƒç”¨å·¥å…·

### 2.5 æ˜¯å¦è¿‡åº¦è®¾è®¡ï¼Ÿæ˜¯å¦æœ‰è¶³å¤Ÿä¿¡æ¯è¯„ä¼°ï¼Ÿ

**âœ… ä¸è¿‡åº¦è®¾è®¡ï¼Œä¿¡æ¯å……åˆ†**
- æ–¹æ¡ˆç®€æ´ï¼šåªå¢åŠ 1ä¸ªBean + 1ä¸ªåˆ¤æ–­é€»è¾‘
- æ•°æ®å……è¶³ï¼šå·²æ”¶é›†åˆ°æ‰€æœ‰ç›¸å…³ä»£ç å’Œæ•°æ®åº“ä¿¡æ¯
- é€»è¾‘æ¸…æ™°ï¼šèŠ‚ç‚¹ç±»å‹å†³å®šChatClienté€‰æ‹©

### 2.6 è¯é¢˜æ˜¯å¦æ¨¡ç³Šï¼Œæ˜¯å¦ä¼šäº§ç”Ÿå¹»è§‰ï¼Ÿ

**âœ… éœ€æ±‚æ˜ç¡®ï¼Œä¸ä¼šäº§ç”Ÿå¹»è§‰**
- ç”¨æˆ·æ˜ç¡®æå‡ºï¼šåªæœ‰MCPå·¥å…·èŠ‚ç‚¹æ‰è°ƒç”¨MCPå·¥å…·
- æ•°æ®åº“ä¸­ç»„ä»¶åç§°æ¸…æ™°ï¼š`McpTool` vs `Answer`
- å®ç°é€»è¾‘æ¸…æ™°ï¼šé€šè¿‡ç»„ä»¶åç§°åˆ¤æ–­èŠ‚ç‚¹ç±»å‹

### 2.7 æ˜¯å¦å­¦ä¹ äº†ä»£ç å®æ–½çš„æ³¨æ„äº‹é¡¹ï¼Ÿ

**âœ… å·²å­¦ä¹ å¹¶åº”ç”¨**
- éµå¾ªç¬¬17æ¡ï¼šæ’å…¥/æ›´æ–°ä½¿ç”¨beanï¼ŒæŸ¥è¯¢ä½¿ç”¨sql
- éµå¾ªç¬¬2æ¡ï¼šä¸ç®€åŒ–ä»£ç ï¼Œè®¤çœŸå¯¹å¾…æ¯ä¸ªç»†èŠ‚
- éµå¾ªç¬¬22æ¡ï¼šä½¿ç”¨importï¼Œä¸å†™åŒ…å.ç±»å
- éµå¾ªç¬¬11æ¡ï¼šå‰åè¿è´¯ï¼Œé¿å…ç¼åˆæ€ª

---

## 3. è°ƒç”¨é“¾è·¯åˆ†æ

### 3.1 å½“å‰è°ƒç”¨é“¾è·¯

```
èŠ‚ç‚¹æ‰§è¡Œ
  â†’ WorkflowUtil.streamingInvokeLLM()
    â†’ AiChatBaseService.chatWithWorkflowMemoryStream()
      â†’ workflowDomainChatClient.prompt()...stream()
        â†’ LLMè°ƒç”¨ï¼ˆè‡ªåŠ¨æ³¨å†Œæ‰€æœ‰MCPå·¥å…·ï¼‰
          â†’ LLMæ ¹æ®è¯­ä¹‰è‡ªåŠ¨é€‰æ‹©å·¥å…·è°ƒç”¨
```

### 3.2 é—®é¢˜è¯Šæ–­

**æ ¸å¿ƒé—®é¢˜**ï¼š`workflowDomainChatClient` åœ¨åˆ›å»ºæ—¶å°±æ³¨å…¥äº† `ToolCallbackProvider`ï¼ˆæ‰€æœ‰MCPå·¥å…·ï¼‰

```java
// AiChatMemoryConfig.java:117-120
if (toolCallbackProvider != null) {
    builder.defaultToolCallbacks(toolCallbackProvider);  // â† æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½è°ƒç”¨MCPå·¥å…·
}
```

### 3.3 ä¼˜åŒ–åçš„è°ƒç”¨é“¾è·¯

```
èŠ‚ç‚¹æ‰§è¡Œ
  â†’ WorkflowUtil.streamingInvokeLLM()
    â†’ åˆ¤æ–­èŠ‚ç‚¹ç±»å‹ï¼ˆé€šè¿‡ç»„ä»¶åç§°ï¼‰
      â”œâ”€ èŠ‚ç‚¹ç±»å‹ = "McpTool"
      â”‚   â†’ AiChatBaseService.chatWithWorkflowMemoryStream(enableMcpTools=true)
      â”‚     â†’ workflowDomainChatClientï¼ˆå¸¦MCPå·¥å…·ï¼‰
      â”‚       â†’ LLMè°ƒç”¨ + MCPå·¥å…·
      â”‚
      â””â”€ èŠ‚ç‚¹ç±»å‹ â‰  "McpTool"
          â†’ AiChatBaseService.chatWithWorkflowMemoryStream(enableMcpTools=false)
            â†’ workflowDomainChatClientNoMcpï¼ˆä¸å¸¦MCPå·¥å…·ï¼‰
              â†’ LLMè°ƒç”¨ï¼ˆçº¯å¯¹è¯ï¼‰
```

---

## 4. æ•°æ®ç»“æ„è®¾è®¡

### 4.1 æ ¸å¿ƒæ•°æ®å…³ç³»

```
AiWorkflowComponentEntity (ai_workflow_componentè¡¨)
  â”œâ”€ name = "McpTool"  â†’ MCPå·¥å…·èŠ‚ç‚¹
  â”œâ”€ name = "Answer"   â†’ ç”Ÿæˆå›ç­”èŠ‚ç‚¹
  â””â”€ ...

AiWorkflowNodeVo
  â”œâ”€ workflowComponentId â†’ å…³è”ç»„ä»¶
  â””â”€ é€šè¿‡ workflowComponentId æŸ¥è¯¢ç»„ä»¶åç§°

èŠ‚ç‚¹æ‰§è¡Œæ—¶åˆ¤æ–­é€»è¾‘:
  ç»„ä»¶åç§° = "McpTool" â†’ enableMcpTools = true
  ç»„ä»¶åç§° â‰  "McpTool" â†’ enableMcpTools = false
```

### 4.2 æ–°å¢å­—æ®µ

**AIChatOptionVo.java** æ–°å¢å­—æ®µï¼š

```java
/**
 * æ˜¯å¦å¯ç”¨MCPå·¥å…·è‡ªåŠ¨è°ƒç”¨
 * true: å¯ç”¨ï¼ˆMCPå·¥å…·èŠ‚ç‚¹ï¼‰
 * false: ç¦ç”¨ï¼ˆç”Ÿæˆå›ç­”èŠ‚ç‚¹ç­‰ï¼‰
 * é»˜è®¤å€¼: falseï¼ˆå®‰å…¨é»˜è®¤å€¼ï¼‰
 */
private Boolean enableMcpTools = false;
```

---

## 5. æ–¹æ¡ˆè®¾è®¡

### 5.1 æ ¸å¿ƒè®¾è®¡æ€è·¯

**åŸåˆ™**: åœ¨Beanåˆ›å»ºæ—¶å°±ç¡®å®šé…ç½®ï¼Œé¿å…è¿è¡Œæ—¶åˆ¤æ–­

**ä¸¤ä¸ªChatClient Bean**:
1. `workflowDomainChatClient`: å¸¦MCPå·¥å…·ï¼ˆç°æœ‰Beanï¼Œä¿æŒä¸å˜ï¼‰
2. `workflowDomainChatClientNoMcp`: ä¸å¸¦MCPå·¥å…·ï¼ˆæ–°å¢Beanï¼‰

**èŠ‚ç‚¹ç±»å‹åˆ¤æ–­**:
- é€šè¿‡èŠ‚ç‚¹çš„ `workflowComponentId` æŸ¥è¯¢ç»„ä»¶çš„ `name` å­—æ®µ
- å¦‚æœ `name == "McpTool"` â†’ ä½¿ç”¨ `workflowDomainChatClient`
- å¦åˆ™ â†’ ä½¿ç”¨ `workflowDomainChatClientNoMcp`

### 5.2 æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ

**æ•°æ®ç»“æ„ä¼˜åŒ–**ï¼š
```
èŠ‚ç‚¹ç±»å‹ â†’ ChatClientï¼ˆä¸€å¯¹ä¸€æ˜ å°„ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹ç»„ä»¶åç§°    â”‚ ChatClient Bean               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ "McpTool"       â”‚ workflowDomainChatClient      â”‚
â”‚ "Answer"        â”‚ workflowDomainChatClientNoMcp â”‚
â”‚ "DocumentEx..." â”‚ workflowDomainChatClientNoMcp â”‚
â”‚ ...             â”‚ workflowDomainChatClientNoMcp â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ²¡æœ‰if/elseåˆ†æ”¯çš„ç‰¹æ®Šæƒ…å†µ**ï¼Œåªæœ‰æ¸…æ™°çš„æ˜ å°„å…³ç³»ã€‚

---

## 6. æ–‡ä»¶çº§åˆ«è®¾è®¡

### 6.1 åç«¯æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ | ä¿®æ”¹å†…å®¹ |
|----------|----------|----------|
| `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/request/AIChatOptionVo.java` | ä¿®æ”¹ | æ–°å¢å­—æ®µ `enableMcpTools` |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/workflow/WorkflowUtil.java` | ä¿®æ”¹ | å¢åŠ èŠ‚ç‚¹ç±»å‹åˆ¤æ–­é€»è¾‘ï¼Œè®¾ç½® `enableMcpTools` |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/config/memory/AiChatMemoryConfig.java` | ä¿®æ”¹ | æ–°å¢Bean `workflowDomainChatClientNoMcp` |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/chat/AiChatBaseService.java` | ä¿®æ”¹ | æ ¹æ® `enableMcpTools` é€‰æ‹©ä¸åŒChatClient |

### 6.2 ä¿®æ”¹1: AIChatOptionVo.java

**æ–‡ä»¶è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/request/AIChatOptionVo.java`

**ä¿®æ”¹å†…å®¹**:

```java
// æ–°å¢å­—æ®µï¼ˆåœ¨ç¬¬64è¡Œ toolContext å­—æ®µåé¢ï¼‰
/**
 * æ˜¯å¦å¯ç”¨MCPå·¥å…·è‡ªåŠ¨è°ƒç”¨
 * true: å¯ç”¨MCPå·¥å…·ï¼ˆé€‚ç”¨äºMCPå·¥å…·èŠ‚ç‚¹ï¼‰
 * false: ç¦ç”¨MCPå·¥å…·ï¼ˆé€‚ç”¨äºç”Ÿæˆå›ç­”èŠ‚ç‚¹ç­‰ï¼‰
 * é»˜è®¤å€¼: falseï¼ˆå®‰å…¨é»˜è®¤å€¼ï¼Œé¿å…ä¸å¿…è¦çš„å·¥å…·è°ƒç”¨ï¼‰
 */
@Schema(description = "æ˜¯å¦å¯ç”¨MCPå·¥å…·")
private Boolean enableMcpTools = false;
```

**è®¾è®¡è¯´æ˜**:
- é»˜è®¤å€¼ `false`: å®‰å…¨é»˜è®¤å€¼ï¼Œé¿å…ä¸å¿…è¦çš„MCPå·¥å…·è°ƒç”¨
- åªæœ‰æ˜ç¡®æŒ‡å®šä¸º `true` æ—¶æ‰å¯ç”¨MCPå·¥å…·

### 6.3 ä¿®æ”¹2: WorkflowUtil.java

**æ–‡ä»¶è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/workflow/WorkflowUtil.java`

**ä¿®æ”¹ä½ç½®**: `streamingInvokeLLM` æ–¹æ³•ï¼Œåœ¨ç¬¬143-145è¡Œï¼ˆè®¾ç½®chatOptionåï¼‰

**ä¿®æ”¹å†…å®¹**:

```java
// åŸæœ‰ä»£ç ï¼ˆç¬¬143-145è¡Œï¼‰
AIChatOptionVo chatOption = new AIChatOptionVo();
chatOption.setModule(modelConfig);
chatOption.setPrompt(prompt);

// æ–°å¢ä»£ç ï¼šåˆ¤æ–­èŠ‚ç‚¹ç±»å‹ï¼Œè®¾ç½®æ˜¯å¦å¯ç”¨MCPå·¥å…·
boolean isMcpToolNode = isM cpToolNode(node);
chatOption.setEnableMcpTools(isMcpToolNode);

log.info("èŠ‚ç‚¹ç±»å‹åˆ¤æ–­ - èŠ‚ç‚¹UUID: {}, æ ‡é¢˜: {}, æ˜¯å¦MCPå·¥å…·èŠ‚ç‚¹: {}",
        node.getUuid(), node.getTitle(), isMcpToolNode);
```

**æ–°å¢è¾…åŠ©æ–¹æ³•**ï¼ˆåœ¨ç±»çš„æœ€åï¼Œç¬¬250è¡Œåï¼‰:

```java
/**
 * åˆ¤æ–­æ˜¯å¦ä¸ºMCPå·¥å…·èŠ‚ç‚¹
 *
 * é€šè¿‡èŠ‚ç‚¹çš„ç»„ä»¶IDæŸ¥è¯¢ç»„ä»¶åç§°
 * å¦‚æœç»„ä»¶åç§°ä¸º "McpTool"ï¼Œåˆ™è®¤ä¸ºæ˜¯MCPå·¥å…·èŠ‚ç‚¹
 *
 * @param node å·¥ä½œæµèŠ‚ç‚¹
 * @return true: MCPå·¥å…·èŠ‚ç‚¹ï¼Œfalse: å…¶ä»–èŠ‚ç‚¹
 */
private static boolean isMcpToolNode(AiWorkflowNodeVo node) {
    if (node == null || node.getWorkflowComponentId() == null) {
        return false;
    }

    // æŸ¥è¯¢ç»„ä»¶ä¿¡æ¯
    AiWorkflowComponentService componentService = SpringUtil.getBean(AiWorkflowComponentService.class);
    if (componentService == null) {
        log.warn("AiWorkflowComponentService not found, default to non-MCP node");
        return false;
    }

    AiWorkflowComponentEntity component = componentService.getById(node.getWorkflowComponentId());
    if (component == null) {
        log.warn("Component not found for id: {}, default to non-MCP node", node.getWorkflowComponentId());
        return false;
    }

    // åˆ¤æ–­ç»„ä»¶åç§°æ˜¯å¦ä¸º "McpTool"
    return "McpTool".equals(component.getName());
}
```

**è®¾è®¡è¯´æ˜**:
- é€šè¿‡èŠ‚ç‚¹çš„ `workflowComponentId` æŸ¥è¯¢ç»„ä»¶
- åˆ¤æ–­ç»„ä»¶ `name` æ˜¯å¦ä¸º `"McpTool"`
- å®¹é”™å¤„ç†ï¼šå¦‚æœæŸ¥è¯¢å¤±è´¥ï¼Œé»˜è®¤è¿”å› `false`ï¼ˆç¦ç”¨MCPï¼‰

### 6.4 ä¿®æ”¹3: AiChatMemoryConfig.java

**æ–‡ä»¶è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/config/memory/AiChatMemoryConfig.java`

**ä¿®æ”¹å†…å®¹**: æ–°å¢Beanæ–¹æ³•ï¼ˆåœ¨ç¬¬155è¡Œåï¼Œç±»ç»“æŸå‰ï¼‰

```java
/**
 * Workflowé¢†åŸŸä¸“å±ChatClientï¼ˆä¸å¸¦MCPå·¥å…·ï¼‰
 *
 * ç”¨äºä¸éœ€è¦MCPå·¥å…·è°ƒç”¨çš„å·¥ä½œæµèŠ‚ç‚¹ï¼ˆå¦‚ç”Ÿæˆå›ç­”èŠ‚ç‚¹ï¼‰
 * é…ç½®ä¸workflowDomainChatClientç›¸åŒï¼Œä½†ä¸æ³¨å…¥ToolCallbackProvider
 *
 * @param aiModelProvider AIæ¨¡å‹æä¾›è€…
 * @param workflowMessageChatMemoryAdvisor Workflowå¯¹è¯å†å²è¯»å–Advisor
 * @param workflowConversationAdvisor Workflowå¯¹è¯ä¿å­˜Advisor
 * @return é…ç½®å¥½çš„ChatClientå®ä¾‹ï¼ˆä¸å¸¦MCPå·¥å…·ï¼‰
 */
@Lazy
@Bean("workflowDomainChatClientNoMcp")
public ChatClient workflowDomainChatClientNoMcp(
        AiModelProvider aiModelProvider,
        MessageChatMemoryAdvisor workflowMessageChatMemoryAdvisor,
        WorkflowConversationAdvisor workflowConversationAdvisor) {
    ChatModel chatModel = aiModelProvider.getChatModel();

    // ä¸workflowDomainChatClientç›¸åŒçš„Advisoré…ç½®
    // ä½†ä¸æ³¨å…¥toolCallbackProvider
    return ChatClient.builder(chatModel)
            .defaultAdvisors(
                workflowMessageChatMemoryAdvisor,  // è¯»å–å†å²å¯¹è¯
                workflowConversationAdvisor        // ä¿å­˜æ–°å¯¹è¯
            )
            .build();
}
```

**è®¾è®¡è¯´æ˜**:
- Beanåç§°: `workflowDomainChatClientNoMcp`
- ä¸ `workflowDomainChatClient` å”¯ä¸€åŒºåˆ«ï¼šä¸æ³¨å…¥ `ToolCallbackProvider`
- ä¿æŒç›¸åŒçš„Memory Advisoré…ç½®ï¼Œç¡®ä¿å¯¹è¯è®°å¿†åŠŸèƒ½æ­£å¸¸

### 6.5 ä¿®æ”¹4: AiChatBaseService.java

**æ–‡ä»¶è·¯å¾„**: `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/chat/AiChatBaseService.java`

**ä¿®æ”¹ä½ç½®1**: æ³¨å…¥æ–°Beanï¼ˆåœ¨ç¬¬63è¡Œåï¼Œç°æœ‰ChatClientæ³¨å…¥åï¼‰

```java
@Lazy
@Resource
@Qualifier("workflowDomainChatClientNoMcp")
private ChatClient workflowDomainChatClientNoMcp;
```

**ä¿®æ”¹ä½ç½®2**: `chatWithWorkflowMemoryStream` æ–¹æ³•ï¼ˆåœ¨ç¬¬224è¡Œå¼€å§‹ï¼Œæ„å»ºrequestSpecä¹‹å‰ï¼‰

**ä¿®æ”¹å†…å®¹**:

```java
// åŸæœ‰ä»£ç ï¼ˆç¬¬205-221è¡Œï¼‰
log.info("ğŸš€ [Workflow Memory] è°ƒç”¨chatWithWorkflowMemoryStream...");
...

// æ ¹æ®callSourceåŠ¨æ€é€‰æ‹©Memory Advisor
MessageChatMemoryAdvisor selectedMemoryAdvisor;
if (com.xinyirun.scm.ai.common.constant.WorkflowCallSource.AI_CHAT.equals(callSource)) {
    selectedMemoryAdvisor = chatMessageChatMemoryAdvisor;
    log.info("âœ… [Dynamic Memory] AI_CHATè°ƒç”¨,ä½¿ç”¨chatMessageChatMemoryAdvisor...");
} else {
    selectedMemoryAdvisor = workflowMessageChatMemoryAdvisor;
    log.info("âœ… [Dynamic Memory] WORKFLOW_TESTè°ƒç”¨,ä½¿ç”¨workflowMessageChatMemoryAdvisor...");
}

// æ–°å¢ä»£ç ï¼šæ ¹æ®enableMcpToolsé€‰æ‹©ChatClient
ChatClient selectedClient;
if (Boolean.TRUE.equals(aiChatOption.getEnableMcpTools())) {
    selectedClient = workflowDomainChatClient;
    log.info("âœ… [MCP Control] å¯ç”¨MCPå·¥å…·ï¼Œä½¿ç”¨workflowDomainChatClient");
} else {
    selectedClient = workflowDomainChatClientNoMcp;
    log.info("âœ… [MCP Control] ç¦ç”¨MCPå·¥å…·ï¼Œä½¿ç”¨workflowDomainChatClientNoMcp");
}

// ä¿®æ”¹åçš„ä»£ç ï¼ˆä½¿ç”¨selectedClientæ›¿æ¢åŸæœ‰çš„workflowDomainChatClientï¼‰
if (StringUtils.isNotBlank(aiChatOption.getSystem())) {
    ChatClient.ChatClientRequestSpec requestSpec = selectedClient  // â† ä¿®æ”¹ç‚¹
            .prompt()
            .system(aiChatOption.getSystem())
            .user(aiChatOption.getPrompt());
    ...
}

ChatClient.ChatClientRequestSpec requestSpec = selectedClient  // â† ä¿®æ”¹ç‚¹
        .prompt()
        .user(aiChatOption.getPrompt());
...
```

**è®¾è®¡è¯´æ˜**:
- æ ¹æ® `enableMcpTools` å­—æ®µé€‰æ‹©ä¸åŒçš„ChatClient
- `true` â†’ `workflowDomainChatClient`ï¼ˆå¸¦MCPå·¥å…·ï¼‰
- `false` æˆ– `null` â†’ `workflowDomainChatClientNoMcp`ï¼ˆä¸å¸¦MCPå·¥å…·ï¼‰
- å¢åŠ æ—¥å¿—è®°å½•ï¼Œä¾¿äºè°ƒè¯•

---

## 7. æ•°æ®æ”¯æ’‘

### 7.1 æ•°æ®åº“æ•°æ®éªŒè¯

**æŸ¥è¯¢ç»„ä»¶æ•°æ®**:
```sql
SELECT id, name, title FROM ai_workflow_component WHERE is_enable = 1 ORDER BY display_order;
```

**ç»“æœ**:
- `name='McpTool'`, `title='MCPå·¥å…·'` â†’ MCPå·¥å…·èŠ‚ç‚¹
- `name='Answer'`, `title='ç”Ÿæˆå›ç­”'` â†’ ç”Ÿæˆå›ç­”èŠ‚ç‚¹
- å…¶ä»–ç»„ä»¶...

**åˆ¤æ–­é€»è¾‘æ­£ç¡®æ€§éªŒè¯**:
- âœ… ç»„ä»¶åç§°å”¯ä¸€ä¸”ç¨³å®š
- âœ… å¯ä»¥é€šè¿‡ `workflowComponentId` å…³è”æŸ¥è¯¢
- âœ… `name='McpTool'` æ˜¯æ˜ç¡®çš„æ ‡è¯†

### 7.2 ç°æœ‰ä»£ç åˆ†æ

**å·²ç¡®è®¤çš„è°ƒç”¨é“¾è·¯**:
1. `WorkflowUtil.streamingInvokeLLM()` â†’ å…¥å£æ–¹æ³•
2. `AiChatBaseService.chatWithWorkflowMemoryStream()` â†’ LLMè°ƒç”¨æœåŠ¡
3. `workflowDomainChatClient.prompt()...stream()` â†’ ChatClientè°ƒç”¨
4. `McpToolConfig.mcpToolCallbackProvider()` â†’ MCPå·¥å…·æ³¨å†Œ

**å·²ç¡®è®¤çš„Beané…ç½®**:
- `workflowDomainChatClient`: ç°æœ‰Beanï¼Œå¸¦MCPå·¥å…·
- éœ€è¦æ–°å¢: `workflowDomainChatClientNoMcp`

### 7.3 å…¼å®¹æ€§éªŒè¯

**ç°æœ‰èŠ‚ç‚¹ç±»å‹æµ‹è¯•**:
| èŠ‚ç‚¹ç±»å‹ | ç»„ä»¶åç§° | é¢„æœŸè¡Œä¸º | æ˜¯å¦å…¼å®¹ |
|----------|----------|----------|----------|
| MCPå·¥å…·èŠ‚ç‚¹ | `McpTool` | å¯ç”¨MCPå·¥å…· | âœ… å®Œå…¨å…¼å®¹ |
| ç”Ÿæˆå›ç­”èŠ‚ç‚¹ | `Answer` | ç¦ç”¨MCPå·¥å…· | âœ… è¡Œä¸ºæ”¹å˜ï¼ˆç¬¦åˆé¢„æœŸï¼‰ |
| æ–‡æ¡£æå–èŠ‚ç‚¹ | `DocumentExtractor` | ç¦ç”¨MCPå·¥å…· | âœ… å®Œå…¨å…¼å®¹ |
| å…¶ä»–èŠ‚ç‚¹ | ... | ç¦ç”¨MCPå·¥å…· | âœ… å®Œå…¨å…¼å®¹ |

---

## 8. é£é™©åˆ†æä¸ç¼“è§£æªæ–½

### 8.1 æŠ€æœ¯é£é™©

**é£é™©1**: èŠ‚ç‚¹ç»„ä»¶æŸ¥è¯¢å¤±è´¥

**å½±å“**: å¯èƒ½å¯¼è‡´MCPå·¥å…·æ— æ³•è°ƒç”¨

**ç¼“è§£æªæ–½**:
- å¢åŠ å®¹é”™å¤„ç†ï¼ŒæŸ¥è¯¢å¤±è´¥æ—¶é»˜è®¤è¿”å› `false`ï¼ˆç¦ç”¨MCPï¼‰
- å¢åŠ è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜è¿½è¸ª
- å•å…ƒæµ‹è¯•è¦†ç›–å¼‚å¸¸åœºæ™¯

**é£é™©2**: ChatClient Beanæ³¨å…¥å¤±è´¥

**å½±å“**: æœåŠ¡å¯åŠ¨å¤±è´¥

**ç¼“è§£æªæ–½**:
- ä½¿ç”¨ `@Lazy` å»¶è¿Ÿåˆå§‹åŒ–
- Beanåˆ›å»ºé€»è¾‘ç®€å•ï¼Œå¤±è´¥æ¦‚ç‡æä½
- å¯åŠ¨æ—¶ä¼šç«‹å³æš´éœ²é—®é¢˜ï¼Œæ˜“äºå‘ç°

### 8.2 ä¸šåŠ¡é£é™©

**é£é™©1**: ç”Ÿæˆå›ç­”èŠ‚ç‚¹ç¦ç”¨MCPå·¥å…·åï¼Œç”¨æˆ·æœŸæœ›è°ƒç”¨å·¥å…·ä½†æ— æ³•è°ƒç”¨

**å½±å“**: ç”¨æˆ·ä½“éªŒé—®é¢˜

**ç¼“è§£æªæ–½**:
- è¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼Œç¬¦åˆå·¥ä½œæµç¼–æ’è¯­ä¹‰
- ç”¨æˆ·å¯ä»¥ä½¿ç”¨MCPå·¥å…·èŠ‚ç‚¹æ˜¾å¼è°ƒç”¨å·¥å…·
- æ–‡æ¡£è¯´æ˜æ¸…æ™°

**é£é™©2**: ç°æœ‰å·¥ä½œæµå—å½±å“

**å½±å“**: å·²é…ç½®çš„å·¥ä½œæµè¡Œä¸ºæ”¹å˜

**ç¼“è§£æªæ–½**:
- å‘åå…¼å®¹ï¼šMCPå·¥å…·èŠ‚ç‚¹ä»ç„¶å¯ä»¥è°ƒç”¨å·¥å…·
- è¡Œä¸ºæ”¹å˜ç¬¦åˆé¢„æœŸï¼šç”Ÿæˆå›ç­”èŠ‚ç‚¹ä¸åº”è‡ªåŠ¨è°ƒç”¨MCPå·¥å…·
- å½±å“é¢å°ï¼šå¤§éƒ¨åˆ†å·¥ä½œæµä¸ä¾èµ–è‡ªåŠ¨MCPè°ƒç”¨

### 8.3 æ€§èƒ½é£é™©

**é£é™©**: æ–°å¢èŠ‚ç‚¹ç±»å‹æŸ¥è¯¢ï¼Œæ˜¯å¦å½±å“æ€§èƒ½

**åˆ†æ**:
- æŸ¥è¯¢ç»„ä»¶ä¿¡æ¯ï¼š1æ¬¡æ•°æ®åº“æŸ¥è¯¢ï¼ˆé€šè¿‡ä¸»é”®IDæŸ¥è¯¢ï¼Œé€Ÿåº¦æå¿«ï¼‰
- æŸ¥è¯¢é¢‘ç‡ï¼šæ¯æ¬¡èŠ‚ç‚¹æ‰§è¡Œæ—¶æŸ¥è¯¢1æ¬¡
- æ€§èƒ½å½±å“ï¼šå¯å¿½ç•¥ä¸è®¡ï¼ˆ<1msï¼‰

**ç¼“è§£æªæ–½**:
- ç»„ä»¶ä¿¡æ¯å¯ä»¥è€ƒè™‘ç¼“å­˜ï¼ˆåç»­ä¼˜åŒ–ï¼‰
- å½“å‰æ€§èƒ½å®Œå…¨å¯æ¥å—

---

## 9. æµ‹è¯•è®¡åˆ’

### 9.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹1**: `isMcpToolNode()` æ–¹æ³•æµ‹è¯•

```java
@Test
public void testIsMcpToolNode_McpTool() {
    // æ¨¡æ‹ŸMCPå·¥å…·èŠ‚ç‚¹
    AiWorkflowNodeVo node = new AiWorkflowNodeVo();
    node.setWorkflowComponentId(1L);

    // æ¨¡æ‹Ÿç»„ä»¶
    AiWorkflowComponentEntity component = new AiWorkflowComponentEntity();
    component.setName("McpTool");

    // é¢„æœŸè¿”å› true
    assertTrue(WorkflowUtil.isMcpToolNode(node));
}

@Test
public void testIsMcpToolNode_Answer() {
    // æ¨¡æ‹Ÿç”Ÿæˆå›ç­”èŠ‚ç‚¹
    AiWorkflowNodeVo node = new AiWorkflowNodeVo();
    node.setWorkflowComponentId(2L);

    // æ¨¡æ‹Ÿç»„ä»¶
    AiWorkflowComponentEntity component = new AiWorkflowComponentEntity();
    component.setName("Answer");

    // é¢„æœŸè¿”å› false
    assertFalse(WorkflowUtil.isMcpToolNode(node));
}

@Test
public void testIsMcpToolNode_Null() {
    // æµ‹è¯•nullåœºæ™¯
    assertFalse(WorkflowUtil.isMcpToolNode(null));

    AiWorkflowNodeVo node = new AiWorkflowNodeVo();
    node.setWorkflowComponentId(null);
    assertFalse(WorkflowUtil.isMcpToolNode(node));
}
```

### 9.2 é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯1**: MCPå·¥å…·èŠ‚ç‚¹æ‰§è¡Œ

```
æ“ä½œæ­¥éª¤:
1. åˆ›å»ºå·¥ä½œæµï¼ŒåŒ…å«MCPå·¥å…·èŠ‚ç‚¹
2. æ‰§è¡Œå·¥ä½œæµ
3. éªŒè¯MCPå·¥å…·æ˜¯å¦è¢«è°ƒç”¨

é¢„æœŸç»“æœ:
- âœ… MCPå·¥å…·è¢«æˆåŠŸè°ƒç”¨
- âœ… æ—¥å¿—æ˜¾ç¤ºï¼šå¯ç”¨MCPå·¥å…·ï¼Œä½¿ç”¨workflowDomainChatClient
```

**æµ‹è¯•åœºæ™¯2**: ç”Ÿæˆå›ç­”èŠ‚ç‚¹æ‰§è¡Œ

```
æ“ä½œæ­¥éª¤:
1. åˆ›å»ºå·¥ä½œæµï¼ŒåŒ…å«ç”Ÿæˆå›ç­”èŠ‚ç‚¹
2. æ‰§è¡Œå·¥ä½œæµ
3. éªŒè¯MCPå·¥å…·æ˜¯å¦è¢«è°ƒç”¨

é¢„æœŸç»“æœ:
- âœ… MCPå·¥å…·æœªè¢«è°ƒç”¨
- âœ… çº¯LLMå¯¹è¯ç”Ÿæˆå›ç­”
- âœ… æ—¥å¿—æ˜¾ç¤ºï¼šç¦ç”¨MCPå·¥å…·ï¼Œä½¿ç”¨workflowDomainChatClientNoMcp
```

**æµ‹è¯•åœºæ™¯3**: æ··åˆèŠ‚ç‚¹å·¥ä½œæµ

```
æ“ä½œæ­¥éª¤:
1. åˆ›å»ºå·¥ä½œæµï¼šå¼€å§‹ â†’ ç”Ÿæˆå›ç­”èŠ‚ç‚¹ â†’ MCPå·¥å…·èŠ‚ç‚¹ â†’ ç»“æŸ
2. æ‰§è¡Œå·¥ä½œæµ
3. éªŒè¯æ¯ä¸ªèŠ‚ç‚¹çš„è¡Œä¸º

é¢„æœŸç»“æœ:
- âœ… ç”Ÿæˆå›ç­”èŠ‚ç‚¹ï¼šç¦ç”¨MCPå·¥å…·
- âœ… MCPå·¥å…·èŠ‚ç‚¹ï¼šå¯ç”¨MCPå·¥å…·
- âœ… ä¸¤ä¸ªèŠ‚ç‚¹ç‹¬ç«‹å·¥ä½œï¼Œäº’ä¸å½±å“
```

### 9.3 æ€§èƒ½æµ‹è¯•

**æµ‹è¯•æŒ‡æ ‡**:
- èŠ‚ç‚¹æ‰§è¡Œæ—¶é—´ï¼ˆæ–°å¢ç»„ä»¶æŸ¥è¯¢çš„è€—æ—¶ï¼‰
- å¹¶å‘æ‰§è¡Œæµ‹è¯•ï¼ˆ100ä¸ªèŠ‚ç‚¹åŒæ—¶æ‰§è¡Œï¼‰

**æ€§èƒ½æ ‡å‡†**:
- ç»„ä»¶æŸ¥è¯¢è€—æ—¶ < 1ms
- èŠ‚ç‚¹æ‰§è¡Œæ€»è€—æ—¶å¢åŠ  < 5%

---

## 10. å®æ–½æ­¥éª¤

### 10.1 å¼€å‘é¡ºåº

1. **ä¿®æ”¹AIChatOptionVo.java**ï¼šæ–°å¢ `enableMcpTools` å­—æ®µ
2. **ä¿®æ”¹AiChatMemoryConfig.java**ï¼šæ–°å¢ `workflowDomainChatClientNoMcp` Bean
3. **ä¿®æ”¹WorkflowUtil.java**ï¼šæ–°å¢ `isMcpToolNode()` æ–¹æ³•å’Œè°ƒç”¨é€»è¾‘
4. **ä¿®æ”¹AiChatBaseService.java**ï¼šæ³¨å…¥æ–°Beanå¹¶æ ¹æ® `enableMcpTools` é€‰æ‹©ChatClient
5. **ç¼–å†™å•å…ƒæµ‹è¯•**ï¼šè¦†ç›–æ ¸å¿ƒé€»è¾‘
6. **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•å®é™…å·¥ä½œæµæ‰§è¡Œ

### 10.2 éªŒè¯æ¸…å•

- [ ] ä»£ç ç¼–è¯‘é€šè¿‡
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] MCPå·¥å…·èŠ‚ç‚¹ä»ç„¶å¯ä»¥è°ƒç”¨å·¥å…·
- [ ] ç”Ÿæˆå›ç­”èŠ‚ç‚¹ç¦ç”¨MCPå·¥å…·
- [ ] æ—¥å¿—è¾“å‡ºæ­£ç¡®
- [ ] æ— ç ´åç°æœ‰åŠŸèƒ½

---

## 11. æ–¹æ¡ˆä¼˜åŠ¿æ€»ç»“

### 11.1 æŠ€æœ¯ä¼˜åŠ¿

1. **æ•°æ®ç»“æ„ä¼˜åŒ–**ï¼šåœ¨Beanåˆ›å»ºæ—¶å°±ç¡®å®šé…ç½®ï¼Œé¿å…è¿è¡Œæ—¶åˆ¤æ–­
2. **æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ**ï¼šèŠ‚ç‚¹ç±»å‹ â†’ ChatClientï¼ˆä¸€å¯¹ä¸€æ˜ å°„ï¼‰
3. **æœ€å°æ”¹åŠ¨**ï¼šåªä¿®æ”¹3ä¸ªæ–‡ä»¶ï¼Œ4ä¸ªæ”¹åŠ¨ç‚¹
4. **é›¶ç ´åæ€§**ï¼šå®Œå…¨å‘åå…¼å®¹

### 11.2 ä¸šåŠ¡ä¼˜åŠ¿

1. **ç¬¦åˆç›´è§‰**ï¼šå·¥ä½œæµç¼–æ’åº”è¯¥æ˜¾å¼æ§åˆ¶æ‰§è¡Œ
2. **ç²¾ç¡®æ§åˆ¶**ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©ä½•æ—¶è°ƒç”¨MCPå·¥å…·
3. **é›¶é…ç½®**ï¼šè‡ªåŠ¨è¯†åˆ«èŠ‚ç‚¹ç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
4. **æ¸…æ™°æ—¥å¿—**ï¼šä¾¿äºè°ƒè¯•å’Œé—®é¢˜è¿½è¸ª

### 11.3 ç»´æŠ¤ä¼˜åŠ¿

1. **ä»£ç ç®€æ´**ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£
2. **å¯æ‰©å±•æ€§**ï¼šæœªæ¥å¯ä»¥è½»æ¾æ”¯æŒæ›´å¤šèŠ‚ç‚¹ç±»å‹
3. **å¯æµ‹è¯•æ€§**ï¼šå•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘
4. **æ–‡æ¡£å®Œå–„**ï¼šæ–¹æ¡ˆæ–‡æ¡£è¯¦ç»†ï¼Œæ˜“äºäº¤æ¥

---

## 12. é™„å½•

### 12.1 ç›¸å…³æ–‡ä»¶æ¸…å•

**åç«¯æ–‡ä»¶**:
- `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/request/AIChatOptionVo.java`
- `scm-ai/src/main/java/com/xinyirun/scm/ai/workflow/WorkflowUtil.java`
- `scm-ai/src/main/java/com/xinyirun/scm/ai/config/memory/AiChatMemoryConfig.java`
- `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/chat/AiChatBaseService.java`
- `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/entity/workflow/AiWorkflowComponentEntity.java` (åªè¯»)
- `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/workflow/AiWorkflowComponentService.java` (åªè¯»)

**æ•°æ®åº“è¡¨**:
- `ai_workflow_component` (åªè¯»)

### 12.2 å…³é”®å¸¸é‡

**ç»„ä»¶åç§°å¸¸é‡**:
- `"McpTool"`: MCPå·¥å…·èŠ‚ç‚¹
- `"Answer"`: ç”Ÿæˆå›ç­”èŠ‚ç‚¹

**Beanåç§°**:
- `"workflowDomainChatClient"`: å¸¦MCPå·¥å…·çš„ChatClient
- `"workflowDomainChatClientNoMcp"`: ä¸å¸¦MCPå·¥å…·çš„ChatClient

---

**æ–¹æ¡ˆç»“æŸ**

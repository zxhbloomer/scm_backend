# å­å·¥ä½œæµå‚æ•°è‡ªåŠ¨ä¼ é€’ä¼˜åŒ–æ–¹æ¡ˆ

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-09
**è´Ÿè´£äºº**: SCM-AIå¼€å‘å›¢é˜Ÿ

---

## ä¸€ã€é—®é¢˜æè¿°

### 1.1 ä¸šåŠ¡åœºæ™¯

å­å·¥ä½œæµèŠ‚ç‚¹ç”¨äºåœ¨çˆ¶å·¥ä½œæµä¸­è°ƒç”¨å…¶ä»–å·¥ä½œæµï¼Œå®ç°å·¥ä½œæµå¤ç”¨ã€‚å½“å‰å®ç°ä¾èµ–å‰ç«¯æ‰‹å·¥é…ç½®å‚æ•°æ˜ å°„ï¼ˆInputMappingï¼‰ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **ç”¨æˆ·ä½“éªŒå·®**ï¼šå‰ç«¯éœ€è¦æ‰‹å·¥ç»‘å®šå‚æ•°æ˜ å°„å…³ç³»
2. **å‚æ•°ä¸¢å¤±**ï¼šçˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹çš„å‚æ•°ï¼ˆå¦‚`var_user_input`ï¼‰æ— æ³•ä¼ é€’ç»™å­å·¥ä½œæµ
3. **å¤šè½®å¯¹è¯å¤±è´¥**ï¼šå­å·¥ä½œæµæ— æ³•æ­£ç¡®ä¿å­˜å¯¹è¯è®°å¿†

### 1.2 é—®é¢˜ç°è±¡

**æµ‹è¯•æ•°æ®**ï¼ˆæ¥è‡ªæ—¥å¿— D:\temp\20250813\æ–°å»º æ–‡æœ¬æ–‡æ¡£ (17).txtï¼‰ï¼š

ç¬¬ä¸€æ¬¡å¯¹è¯ï¼ˆ19:14:00ï¼‰- é€šè¿‡å­å·¥ä½œæµï¼š
```
çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹å‚æ•°: {var_user_input: "æˆ‘æ˜¯è°"}
åˆ†ç±»å™¨èŠ‚ç‚¹è¾“å‡º: {output: "å…³äºç³»ç»Ÿçš„æ•°æ®æŸ¥è¯¢è¯·æ±‚"}

å­å·¥ä½œæµèŠ‚ç‚¹æ˜ å°„æ—¥å¿—:
"å­å·¥ä½œæµè¾“å…¥å‚æ•°æ˜ å°„: parent={input=æˆ‘æ˜¯è°}, sub={}"
                                    â†‘              â†‘
                            å‚æ•°åé”™è¯¯(åº”è¯¥æ˜¯var_user_input)  æ˜ å°„å¤±è´¥(ç©º)

å­å·¥ä½œæµæ”¶åˆ°å‚æ•°: {}  (ç©º)
extractOriginalUserInput(): æœªæ‰¾åˆ°var_user_inputå‚æ•°
WorkflowConversationAdvisor: âš ï¸ ORIGINAL_USER_INPUTä¸ºç©ºï¼Œé™çº§ä½¿ç”¨å®Œæ•´prompt, é•¿åº¦: 274
```

ç¬¬äºŒæ¬¡å¯¹è¯ï¼ˆ19:18:52ï¼‰- ç›´æ¥LLMèŠ‚ç‚¹ï¼š
```
WorkflowConversationAdvisor: ğŸ‘¤ ä½¿ç”¨åŸå§‹ç”¨æˆ·è¾“å…¥, é•¿åº¦: 3
ä¿å­˜å†…å®¹: "æˆ‘æ˜¯è°" (9 bytes) âœ“
```

### 1.3 æ ¹æœ¬åŸå› 

**SubWorkflowNode.mapInputs() å½“å‰å®ç°é—®é¢˜**ï¼š

```java
// å½“å‰ä»£ç ï¼ˆç¬¬105-131è¡Œï¼‰
private Map<String, Object> mapInputs(SubWorkflowNodeConfig config) {
    List<NodeIOData> parentInputs = state.getInputs();  // âŒ åªè·å–å½“å‰èŠ‚ç‚¹çš„è¾“å…¥
    Map<String, Object> subInputs = new HashMap<>();

    // å°†List<NodeIOData>è½¬æ¢ä¸ºMap<String, Object>
    for (NodeIOData input : parentInputs) {
        subInputs.put(input.getName(), input.getContent().getValue());
    }
    // parentInputsåªåŒ…å«ä¸Šä¸€èŠ‚ç‚¹çš„è¾“å‡ºï¼š{input: "å…³äºç³»ç»ŸæŸ¥è¯¢"}
    // ç¼ºå¤±çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹å‚æ•°ï¼š{var_user_input: "æˆ‘æ˜¯è°"}

    // ...ä¾èµ–InputMappingé…ç½®è¿›è¡Œæ˜ å°„
}
```

**æ•°æ®æµåˆ†æ**ï¼š

```
çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹
â”œâ”€ wfState.getInput(): [{var_user_input: "æˆ‘æ˜¯è°"}]  â† åœ¨è¿™é‡Œï¼
â”œâ”€ è¾“å‡º: {output: "æˆ‘æ˜¯è°"}
â†“
åˆ†ç±»å™¨èŠ‚ç‚¹
â”œâ”€ state.getInputs(): [{input: "æˆ‘æ˜¯è°"}]  (AbstractWfNodeè‡ªåŠ¨è½¬æ¢outputâ†’input)
â”œâ”€ è¾“å‡º: {output: "å…³äºç³»ç»ŸæŸ¥è¯¢"}, {classification: "ç³»ç»ŸæŸ¥è¯¢"}
â†“
å­å·¥ä½œæµèŠ‚ç‚¹
â”œâ”€ state.getInputs(): [{input: "å…³äºç³»ç»ŸæŸ¥è¯¢"}]  â† mapInputs()åªèƒ½è®¿é—®è¿™é‡Œ
â”œâ”€ wfState.getInput(): [{var_user_input: "æˆ‘æ˜¯è°"}]  â† è®¿é—®ä¸åˆ°ï¼
â””â”€ æ˜ å°„å¤±è´¥: {} (ç©º)
```

---

## äºŒã€éœ€æ±‚åˆ†æ

### 2.1 æ ¸å¿ƒéœ€æ±‚

**è®¾è®¡ç†å¿µ**ï¼ˆç”¨æˆ·æ˜ç¡®è¦æ±‚ï¼‰ï¼š
1. çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹çš„**æ‰€æœ‰å‚æ•°**è‡ªåŠ¨ä¼ é€’ç»™å­å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹
2. ä¸Šä¸€èŠ‚ç‚¹çš„**é»˜è®¤è¾“å‡º**ä½œä¸ºé¢å¤–å‚æ•°`input`ä¼ é€’
3. å‰ç«¯**ä¸éœ€è¦**æ‰‹å·¥é…ç½®å‚æ•°æ˜ å°„
4. ç¡®ä¿å¤šè½®å¯¹è¯è®°å¿†åœ¨å­å·¥ä½œæµä¸­æ­£å¸¸å·¥ä½œ

### 2.2 æœŸæœ›æ•ˆæœ

**ä¿®å¤åçš„æ•°æ®æµ**ï¼š

```
çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹
â”œâ”€ wfState.getInput(): [{var_user_input: "æˆ‘æ˜¯è°"}]
â†“
åˆ†ç±»å™¨èŠ‚ç‚¹
â”œâ”€ è¾“å‡º: {output: "å…³äºç³»ç»ŸæŸ¥è¯¢"}
â†“
å­å·¥ä½œæµèŠ‚ç‚¹
â”œâ”€ è‡ªåŠ¨ä¼ é€’:
â”‚   â”œâ”€ çˆ¶å¼€å§‹èŠ‚ç‚¹å‚æ•°: {var_user_input: "æˆ‘æ˜¯è°"}  âœ“
â”‚   â””â”€ ä¸Šä¸€èŠ‚ç‚¹è¾“å‡º: {input: "å…³äºç³»ç»ŸæŸ¥è¯¢"}  âœ“
â”‚
â””â”€ å­å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹æ”¶åˆ°:
    â”œâ”€ var_user_input: "æˆ‘æ˜¯è°"
    â””â”€ input: "å…³äºç³»ç»ŸæŸ¥è¯¢"
```

**æœŸæœ›æ—¥å¿—**ï¼š
```
å­å·¥ä½œæµè¾“å…¥å‚æ•°: {var_user_input=æˆ‘æ˜¯è°, input=å…³äºç³»ç»ŸæŸ¥è¯¢}
extractOriginalUserInput(): æå–åŸå§‹ç”¨æˆ·è¾“å…¥: æˆ‘æ˜¯è°
WorkflowConversationAdvisor: ğŸ‘¤ ä½¿ç”¨åŸå§‹ç”¨æˆ·è¾“å…¥, é•¿åº¦: 3
ä¿å­˜å†…å®¹: "æˆ‘æ˜¯è°" (9 bytes) âœ“
```

---

## ä¸‰ã€æ–¹æ¡ˆè®¾è®¡

### 3.1 æŠ€æœ¯æ–¹æ¡ˆ

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `SubWorkflowNode.java` - ä¿®æ”¹mapInputs()æ–¹æ³•

**æ ¸å¿ƒé€»è¾‘**ï¼š

```java
/**
 * æ˜ å°„è¾“å…¥å‚æ•°ï¼ˆè‡ªåŠ¨ä¼ é€’æ¨¡å¼ï¼‰
 *
 * è®¾è®¡ç†å¿µï¼š
 * 1. çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹çš„æ‰€æœ‰å‚æ•°è‡ªåŠ¨ä¼ é€’ç»™å­å·¥ä½œæµ
 * 2. ä¸Šä¸€èŠ‚ç‚¹çš„é»˜è®¤è¾“å‡ºä½œä¸ºinputå‚æ•°ä¼ é€’
 * 3. ä¸ä¾èµ–æ‰‹å·¥é…ç½®çš„InputMapping
 */
private Map<String, Object> mapInputs(SubWorkflowNodeConfig config) {
    Map<String, Object> subInputs = new HashMap<>();

    // ç¬¬ä¸€æ­¥ï¼šä¼ é€’çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹çš„æ‰€æœ‰å‚æ•°
    if (wfState.getInput() != null && !wfState.getInput().isEmpty()) {
        for (NodeIOData parentStartInput : wfState.getInput()) {
            subInputs.put(parentStartInput.getName(), parentStartInput.getContent().getValue());
        }
        log.debug("ä¼ é€’çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹å‚æ•°: {}", subInputs);
    }

    // ç¬¬äºŒæ­¥ï¼šæ·»åŠ ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„é»˜è®¤è¾“å‡ºä½œä¸ºinputå‚æ•°
    List<NodeIOData> currentNodeInputs = state.getInputs();
    for (NodeIOData input : currentNodeInputs) {
        // æŸ¥æ‰¾é»˜è®¤è¾“å…¥å‚æ•°ï¼ˆåä¸º"input"çš„å‚æ•°ï¼‰
        if (DEFAULT_INPUT_PARAM_NAME.equals(input.getName())) {
            subInputs.put(DEFAULT_INPUT_PARAM_NAME, input.getContent().getValue());
            log.debug("æ·»åŠ ä¸Šä¸€èŠ‚ç‚¹é»˜è®¤è¾“å‡ºä½œä¸ºinputå‚æ•°: {}", input.getContent().getValue());
            break;
        }
    }

    log.info("å­å·¥ä½œæµæœ€ç»ˆè¾“å…¥å‚æ•°: {}", subInputs);
    return subInputs;
}
```

### 3.2 æ•°æ®ç»“æ„åˆ†æ

**å…³é”®å¸¸é‡**ï¼ˆWorkflowConstants.javaï¼‰ï¼š
```java
public static final String DEFAULT_INPUT_PARAM_NAME = "input";
public static final String DEFAULT_OUTPUT_PARAM_NAME = "output";
```

**å‚æ•°åè½¬æ¢è§„åˆ™**ï¼ˆAbstractWfNode.initInput() ç¬¬101-105è¡Œï¼‰ï¼š
```java
if (DEFAULT_OUTPUT_PARAM_NAME.equals(needInputName)) {  // "output"
    item.setName(DEFAULT_INPUT_PARAM_NAME);  // æ”¹ä¸º "input"
    return true;
}
```

**æ¨¡æ¿å¼•æ“æ”¯æŒ**ï¼ˆWorkflowUtil.renderTemplate() ç¬¬41-58è¡Œï¼‰ï¼š
```java
public static String renderTemplate(String template, List<NodeIOData> values) {
    String result = template;
    for (NodeIOData next : values) {
        String name = next.getName();
        // ${var_user_input} â†’ å®é™…å€¼
        // ${input} â†’ ä¸Šä¸€èŠ‚ç‚¹è¾“å‡ºå€¼
        result = result.replace("${" + name + "}", value.toString());
    }
    return result;
}
```

### 3.3 å¤šè½®å¯¹è¯è®°å¿†æœºåˆ¶

**å¯¹è¯å†å²æŸ¥è¯¢**ï¼ˆAiWorkflowConversationContentMapper ç¬¬70-72è¡Œï¼‰ï¼š
```sql
SELECT ...
FROM ai_workflow_conversation_content
WHERE conversation_id = #{conversationId}  -- ä¸è¿‡æ»¤runtime_uuid
ORDER BY c_time DESC
LIMIT 1, #{limit}
```

**å…³é”®ç‰¹æ€§**ï¼š
- å­å·¥ä½œæµ**ç»§æ‰¿**çˆ¶å·¥ä½œæµçš„`conversationId`
- æ‰€æœ‰ç›¸åŒ`conversationId`çš„å¯¹è¯å†å²éƒ½èƒ½è¢«è¯»å–
- åŒ…æ‹¬çˆ¶å·¥ä½œæµå’Œä¹‹å‰æ‰€æœ‰å­å·¥ä½œæµçš„å¯¹è¯

**å·¥ä½œæµç¨‹**ï¼š

```
ç¬¬ä¸€æ¬¡å¯¹è¯:
ç”¨æˆ·: "æˆ‘æ˜¯å°ç‹"
â”œâ”€ çˆ¶å·¥ä½œæµ (conversationId: "tenant::wf_uuid::user_id")
â”‚   â””â”€ å­å·¥ä½œæµ (ç»§æ‰¿ç›¸åŒconversationId)
â”‚       â””â”€ LLMèŠ‚ç‚¹:
â”‚           â”œâ”€ ä¿å­˜USER: "æˆ‘æ˜¯å°ç‹"
â”‚           â”œâ”€ æŸ¥è¯¢å†å²: []
â”‚           â””â”€ ä¿å­˜ASSISTANT: "ä½ å¥½ï¼Œå°ç‹"

ç¬¬äºŒæ¬¡å¯¹è¯:
ç”¨æˆ·: "æˆ‘æ˜¯è°"
â”œâ”€ çˆ¶å·¥ä½œæµ (ç›¸åŒconversationId)
â”‚   â””â”€ å­å·¥ä½œæµ (ç»§æ‰¿ç›¸åŒconversationId)
â”‚       â””â”€ LLMèŠ‚ç‚¹:
â”‚           â”œâ”€ ä¿å­˜USER: "æˆ‘æ˜¯è°"
â”‚           â”œâ”€ æŸ¥è¯¢å†å²: ["æˆ‘æ˜¯å°ç‹", "ä½ å¥½ï¼Œå°ç‹"] âœ“
â”‚           â””â”€ ä¿å­˜ASSISTANT: "ä½ æ˜¯å°ç‹" âœ“
```

---

## å››ã€KISSåŸåˆ™éªŒè¯

### 4.1 è¿™æ˜¯ä¸ªçœŸé—®é¢˜è¿˜æ˜¯è‡†æƒ³å‡ºæ¥çš„ï¼Ÿ

**âœ… çœŸé—®é¢˜**

**è¯æ®**ï¼š
1. æ•°æ®åº“è¯æ®ï¼šç¬¬ä¸€æ¬¡å¯¹è¯ä¿å­˜äº†274å­—ç¬¦çš„promptï¼Œè€Œä¸æ˜¯3å­—ç¬¦çš„åŸå§‹è¾“å…¥
2. æ—¥å¿—è¯æ®ï¼š`"å­å·¥ä½œæµè¾“å…¥å‚æ•°æ˜ å°„: parent={input=æˆ‘æ˜¯è°}, sub={}"`
3. ç”¨æˆ·æ˜ç¡®åé¦ˆï¼šå‰ç«¯éœ€è¦æ‰‹å·¥é…ç½®å‚æ•°æ˜ å°„å¾ˆéº»çƒ¦

### 4.2 æœ‰æ›´ç®€å•çš„æ–¹æ³•å—ï¼Ÿ

**âœ… å½“å‰æ–¹æ¡ˆå·²æ˜¯æœ€ç®€**

**å¤‡é€‰æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | å®ç°æ–¹å¼ | å¤æ‚åº¦ | ä¼˜ç¼ºç‚¹ |
|------|---------|--------|--------|
| æ–¹æ¡ˆ1ï¼ˆå½“å‰ï¼‰ | è‡ªåŠ¨ä¼ é€’çˆ¶å¼€å§‹èŠ‚ç‚¹å‚æ•° + ä¸Šä¸€èŠ‚ç‚¹è¾“å‡º | ä½ | âœ… ç®€å•ç›´æ¥<br>âœ… ä¸ä¾èµ–é…ç½®<br>âœ… å‰ç«¯é›¶æ”¹åŠ¨ |
| æ–¹æ¡ˆ2 | ä¿ç•™InputMappingï¼Œå¢åŠ è‡ªåŠ¨æ¨¡å¼ | ä¸­ | âŒ å¢åŠ å¤æ‚åº¦<br>âŒ éœ€è¦é…ç½®å¼€å…³ |
| æ–¹æ¡ˆ3 | ä¿®æ”¹AbstractWfNode.initInput() | é«˜ | âŒ å½±å“æ‰€æœ‰èŠ‚ç‚¹<br>âŒ é£é™©å¤§ |

### 4.3 ä¼šç ´åä»€ä¹ˆå—ï¼Ÿ

**âœ… å‘åå…¼å®¹**

**å…¼å®¹æ€§åˆ†æ**ï¼š

1. **ç°æœ‰å­å·¥ä½œæµèŠ‚ç‚¹**ï¼š
   - å¦‚æœå·²é…ç½®InputMappingï¼šæ˜ å°„é€»è¾‘è¢«ç§»é™¤ï¼Œæ”¹ç”¨è‡ªåŠ¨ä¼ é€’
   - å½±å“ï¼šéœ€è¦éªŒè¯ç°æœ‰å­å·¥ä½œæµæ˜¯å¦ä¾èµ–ç‰¹å®šæ˜ å°„è§„åˆ™
   - ç¼“è§£ï¼šç¬¬ä¸€ç‰ˆå¯ä¿ç•™InputMappingä½œä¸ºé™çº§æ–¹æ¡ˆ

2. **å…¶ä»–èŠ‚ç‚¹ç±»å‹**ï¼š
   - ä¸å½±å“ï¼šåªä¿®æ”¹SubWorkflowNode
   - LLMAnswerNodeã€KnowledgeRetrievalNodeç­‰ä¿æŒä¸å˜

3. **æ•°æ®åº“**ï¼š
   - ä¸éœ€è¦ä¿®æ”¹è¡¨ç»“æ„
   - ä¸éœ€è¦æ•°æ®è¿ç§»

### 4.4 å½“å‰é¡¹ç›®çœŸçš„éœ€è¦è¿™ä¸ªåŠŸèƒ½å—ï¼Ÿ

**âœ… å¿…è¦åŠŸèƒ½**

**éœ€æ±‚æ¥æº**ï¼š
1. ç”¨æˆ·æ˜ç¡®è¦æ±‚ï¼š"å‰ç«¯ä¸éœ€è¦æ‰‹å·¥ç»‘å®šå‚æ•°"
2. å¤šè½®å¯¹è¯è®°å¿†å¤±è´¥å½±å“æ ¸å¿ƒåŠŸèƒ½
3. ç¬¦åˆ"ç®€åŒ–ä½¿ç”¨ã€è‡ªåŠ¨åŒ–"çš„è®¾è®¡ç†å¿µ

---

## äº”ã€å®æ–½æ–¹æ¡ˆ

### 5.1 ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|---------|---------|------|
| SubWorkflowNode.java | ä¿®æ”¹mapInputs()æ–¹æ³• | ~30è¡Œ |

### 5.2 ä»£ç å®æ–½ç»†èŠ‚

**ä¿®æ”¹ä½ç½®**ï¼šSubWorkflowNode.java ç¬¬105-131è¡Œ

**ä¿®æ”¹å‰**ï¼š
```java
private Map<String, Object> mapInputs(SubWorkflowNodeConfig config) {
    List<NodeIOData> parentInputs = state.getInputs();
    Map<String, Object> subInputs = new HashMap<>();

    for (NodeIOData input : parentInputs) {
        subInputs.put(input.getName(), input.getContent().getValue());
    }

    List<SubWorkflowNodeConfig.InputMapping> mappings = config.getInputMapping();
    if (mappings != null && !mappings.isEmpty()) {
        // æ˜ å°„é€»è¾‘...
    }

    return subInputs;
}
```

**ä¿®æ”¹å**ï¼š
```java
private Map<String, Object> mapInputs(SubWorkflowNodeConfig config) {
    Map<String, Object> subInputs = new HashMap<>();

    // 1. ä¼ é€’çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹çš„æ‰€æœ‰å‚æ•°ï¼ˆå¦‚var_user_inputç­‰ï¼‰
    if (wfState.getInput() != null && !wfState.getInput().isEmpty()) {
        for (NodeIOData parentStartInput : wfState.getInput()) {
            subInputs.put(parentStartInput.getName(), parentStartInput.getContent().getValue());
        }
        log.debug("ä¼ é€’çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹å‚æ•°: {}", subInputs);
    }

    // 2. æ·»åŠ ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„é»˜è®¤è¾“å‡ºä½œä¸ºinputå‚æ•°
    List<NodeIOData> currentNodeInputs = state.getInputs();
    for (NodeIOData input : currentNodeInputs) {
        if (DEFAULT_INPUT_PARAM_NAME.equals(input.getName())) {
            subInputs.put(DEFAULT_INPUT_PARAM_NAME, input.getContent().getValue());
            log.debug("æ·»åŠ ä¸Šä¸€èŠ‚ç‚¹é»˜è®¤è¾“å‡ºä½œä¸ºinputå‚æ•°: {}", input.getContent().getValue());
            break;
        }
    }

    log.info("å­å·¥ä½œæµæœ€ç»ˆè¾“å…¥å‚æ•°: {}", subInputs);
    return subInputs;
}
```

### 5.3 æµ‹è¯•éªŒè¯

**æµ‹è¯•ç”¨ä¾‹1ï¼šåŸºæœ¬å‚æ•°ä¼ é€’**

```
è¾“å…¥:
- çˆ¶å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹: {var_user_input: "æˆ‘æ˜¯å°ç‹", var_session_id: "abc123"}
- ä¸Šä¸€èŠ‚ç‚¹è¾“å‡º: {input: "å…³äºç³»ç»ŸæŸ¥è¯¢"}

æœŸæœ›è¾“å‡º:
- å­å·¥ä½œæµè¾“å…¥: {var_user_input: "æˆ‘æ˜¯å°ç‹", var_session_id: "abc123", input: "å…³äºç³»ç»ŸæŸ¥è¯¢"}
```

**æµ‹è¯•ç”¨ä¾‹2ï¼šå¤šè½®å¯¹è¯è®°å¿†**

```
ç¬¬ä¸€æ¬¡å¯¹è¯:
- è¾“å…¥: "æˆ‘æ˜¯å°ç‹"
- éªŒè¯: ai_workflow_conversation_content.content = "æˆ‘æ˜¯å°ç‹" (9 bytes)

ç¬¬äºŒæ¬¡å¯¹è¯:
- è¾“å…¥: "æˆ‘æ˜¯è°"
- éªŒè¯: LLMèƒ½è¯»å–åˆ°ç¬¬ä¸€æ¬¡å¯¹è¯ï¼Œå›ç­”"ä½ æ˜¯å°ç‹"
```

**æµ‹è¯•ç”¨ä¾‹3ï¼šæ¨¡æ¿æ¸²æŸ“**

```
LLMèŠ‚ç‚¹é…ç½®:
- promptæ¨¡æ¿: "ç”¨æˆ·é—®é¢˜ï¼š${var_user_input}\nåˆ†ç±»ç»“æœï¼š${input}\nè¯·å›ç­”"

æœŸæœ›æ¸²æŸ“ç»“æœ:
"ç”¨æˆ·é—®é¢˜ï¼šæˆ‘æ˜¯å°ç‹
åˆ†ç±»ç»“æœï¼šå…³äºç³»ç»ŸæŸ¥è¯¢
è¯·å›ç­”"
```

### 5.4 å›æ»šæ–¹æ¡ˆ

**å¦‚æœå‡ºç°é—®é¢˜**ï¼š

1. **git revert** å›é€€ä»£ç 
2. **æ•°æ®åº“**ï¼šä¸éœ€è¦å›æ»šï¼ˆæ²¡æœ‰è¡¨ç»“æ„å˜æ›´ï¼‰
3. **å½±å“èŒƒå›´**ï¼šåªå½±å“SubWorkflowNodeï¼Œå…¶ä»–èŠ‚ç‚¹ä¸å—å½±å“

---

## å…­ã€é£é™©è¯„ä¼°

### 6.1 æŠ€æœ¯é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | å½±å“èŒƒå›´ | ç¼“è§£æªæ–½ |
|-------|---------|---------|---------|
| å‚æ•°åå†²çª | ä½ | çˆ¶å¼€å§‹èŠ‚ç‚¹å‚æ•°ä¸ä¸Šä¸€èŠ‚ç‚¹è¾“å‡ºåŒå | çˆ¶å‚æ•°ä¼˜å…ˆï¼Œä¸Šä¸€èŠ‚ç‚¹è¾“å‡ºè¦†ç›– |
| ç°æœ‰æ˜ å°„é…ç½®å¤±æ•ˆ | ä¸­ | å·²é…ç½®InputMappingçš„å­å·¥ä½œæµ | ç¬¬ä¸€ç‰ˆä¿ç•™å…¼å®¹é€»è¾‘ |
| æ€§èƒ½å½±å“ | ä½ | é¢å¤–çš„å‚æ•°å¤åˆ¶ | å‚æ•°æ•°é‡é€šå¸¸<10ä¸ªï¼Œæ€§èƒ½å½±å“å¯å¿½ç•¥ |

### 6.2 ä¸šåŠ¡é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | å½±å“èŒƒå›´ | ç¼“è§£æªæ–½ |
|-------|---------|---------|---------|
| å¯¹è¯è®°å¿†å¤±è´¥ | é«˜ | å¤šè½®å¯¹è¯åŠŸèƒ½å®Œå…¨å¤±æ•ˆ | å……åˆ†æµ‹è¯•ï¼ŒéªŒè¯extractOriginalUserInput()æ­£å¸¸å·¥ä½œ |
| å‚æ•°ç¼ºå¤± | ä¸­ | å­å·¥ä½œæµæ— æ³•è·å–å¿…è¦å‚æ•° | æ—¥å¿—å……åˆ†ï¼Œæ–¹ä¾¿æ’æŸ¥ |

---

## ä¸ƒã€æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | é¢„è®¡å·¥æ—¶ | å¤‡æ³¨ |
|------|---------|------|
| ä»£ç å®æ–½ | 0.5å°æ—¶ | ä¿®æ”¹SubWorkflowNode.mapInputs() |
| å•å…ƒæµ‹è¯• | 1å°æ—¶ | 3ä¸ªæµ‹è¯•ç”¨ä¾‹ |
| é›†æˆæµ‹è¯• | 1å°æ—¶ | å®Œæ•´å·¥ä½œæµæµ‹è¯• |
| æ–‡æ¡£æ›´æ–° | 0.5å°æ—¶ | æ›´æ–°APIæ–‡æ¡£ |
| **æ€»è®¡** | **3å°æ—¶** | |

---

## å…«ã€æ€»ç»“

### 8.1 æ ¸å¿ƒæ”¹è¿›

1. **ç®€åŒ–ä½¿ç”¨**ï¼šå‰ç«¯ä¸éœ€è¦æ‰‹å·¥é…ç½®å‚æ•°æ˜ å°„
2. **ä¿®å¤Bug**ï¼šå­å·¥ä½œæµèƒ½æ­£ç¡®ä¿å­˜å¤šè½®å¯¹è¯è®°å¿†
3. **è‡ªåŠ¨åŒ–**ï¼šå‚æ•°è‡ªåŠ¨ä¼ é€’ï¼Œç¬¦åˆ"ç®¡é“"è®¾è®¡ç†å¿µ

### 8.2 è®¾è®¡åŸåˆ™

éµå¾ªLinus Torvaldsçš„"å¥½å“å‘³"åŸåˆ™ï¼š
- **æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ**ï¼šä¸éœ€è¦åŒºåˆ†"æœ‰æ˜ å°„é…ç½®"å’Œ"æ— æ˜ å°„é…ç½®"
- **ç®€åŒ–é€»è¾‘**ï¼šè‡ªåŠ¨ä¼ é€’æ›¿ä»£æ‰‹å·¥é…ç½®
- **æ•°æ®ä¼˜å…ˆ**ï¼šæ­£ç¡®çš„æ•°æ®æµè®¾è®¡è®©ä»£ç è‡ªç„¶ç®€æ´

### 8.3 é¢„æœŸæ•ˆæœ

- âœ… å­å·¥ä½œæµå‚æ•°ä¼ é€’è‡ªåŠ¨åŒ–
- âœ… å¤šè½®å¯¹è¯è®°å¿†æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·ä½“éªŒæ”¹å–„ï¼ˆæ— éœ€æ‰‹å·¥é…ç½®ï¼‰
- âœ… ä»£ç æ›´ç®€æ´ï¼ˆç§»é™¤æ˜ å°„é€»è¾‘ï¼‰

---

**æ–‡æ¡£çŠ¶æ€**: å¾…å®¡æ‰¹
**ä¸‹ä¸€æ­¥**: ç­‰å¾…ç”¨æˆ·æ‰¹å‡†åè¿›å…¥ä»£ç å®æ–½é˜¶æ®µ

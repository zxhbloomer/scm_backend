# åˆ é™¤çŸ¥è¯†å›¾è°±åŠŸèƒ½ - æŠ€æœ¯æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–¹æ¡ˆåç§°** | åˆ é™¤SCM AIæ¨¡å—çŸ¥è¯†å›¾è°±åŠŸèƒ½ |
| **åˆ›å»ºæ—¶é—´** | 2025-12-01 16:18:26 |
| **æ–¹æ¡ˆç±»å‹** | åŠŸèƒ½åˆ é™¤ / ä»£ç æ¸…ç† |
| **å½±å“èŒƒå›´** | åç«¯ï¼ˆJavaï¼‰ã€å‰ç«¯ï¼ˆVue.jsï¼‰ã€æ•°æ®åº“ï¼ˆMySQLï¼‰|
| **é£é™©ç­‰çº§** | ğŸŸ¡ ä¸­ç­‰é£é™©ï¼ˆåˆ é™¤æ•´ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œéœ€è¦å……åˆ†æµ‹è¯•ï¼‰|
| **è¯„å®¡çŠ¶æ€** | â¸ï¸ å¾…å®¡æ‰¹ |

---

## ğŸ¯ æ–¹æ¡ˆç›®æ ‡

**æ ¸å¿ƒè¯‰æ±‚**ï¼šå®Œå…¨ç§»é™¤SCM AIæ¨¡å—ä¸­çš„çŸ¥è¯†å›¾è°±åŠŸèƒ½ï¼ŒåŒ…æ‹¬Neo4jå›¾æ•°æ®åº“ä¾èµ–ã€å›¾è°±ç´¢å¼•ã€å›¾è°±æ£€ç´¢ç­‰å…¨éƒ¨ç›¸å…³ä»£ç å’Œæ•°æ®ã€‚

**å…·ä½“ç›®æ ‡**ï¼š
1. âœ… åˆ é™¤åç«¯æ‰€æœ‰å›¾è°±ç›¸å…³æœåŠ¡ç±»ã€Controllerã€Repositoryã€é…ç½®ç±»
2. âœ… æ¸…ç†åç«¯ä¸šåŠ¡é€»è¾‘ä¸­çš„å›¾è°±ç´¢å¼•å’Œæ£€ç´¢ä»£ç å—
3. âœ… åˆ é™¤å‰ç«¯æ‰€æœ‰å›¾è°±ç›¸å…³å¯¹è¯æ¡†ã€ç»„ä»¶ã€å·¥å…·å‡½æ•°
4. âœ… æ¸…ç†å‰ç«¯ä¸šåŠ¡ç»„ä»¶ä¸­çš„å›¾è°±æŒ‰é’®ã€å¼€å…³ã€çŠ¶æ€æ˜¾ç¤º
5. âœ… åˆ é™¤MySQLä¸­å›¾è°±ç›¸å…³è¡¨å’Œå­—æ®µ
6. âœ… ç§»é™¤pom.xmlä¸­çš„Neo4jä¾èµ–

---

## ğŸ” KISS åŸåˆ™è¯„ä¼°

### 7ä¸ªå¼ºåˆ¶éªŒè¯é—®é¢˜

#### 1. "è¿™æ˜¯ä¸ªçœŸé—®é¢˜è¿˜æ˜¯è‡†æƒ³å‡ºæ¥çš„ï¼Ÿ"
**ç­”**ï¼šâœ… **çœŸé—®é¢˜**
- çŸ¥è¯†å›¾è°±åŠŸèƒ½å·²å®ç°ä½†æœªä½¿ç”¨ï¼ŒNeo4jæ•°æ®åº“è¿æ¥é…ç½®ç¼ºå¤±
- å›¾è°±ç´¢å¼•å’Œæ£€ç´¢ä»£ç å­˜åœ¨ä½†æ— æ³•æ­£å¸¸å·¥ä½œ
- ç»´æŠ¤æ— ç”¨ä»£ç å¢åŠ ç³»ç»Ÿå¤æ‚åº¦

#### 2. "æœ‰æ›´ç®€å•çš„æ–¹æ³•å—ï¼Ÿ"
**ç­”**ï¼šâœ… **ç›´æ¥åˆ é™¤æ˜¯æœ€ç®€å•æ–¹æ¡ˆ**
- ä¸éœ€è¦é‡æ„æˆ–ä¼˜åŒ–ï¼Œç›´æ¥ç‰©ç†åˆ é™¤å³å¯
- ä¸æ¶‰åŠåŠŸèƒ½æ›¿ä»£ï¼Œçº¯ç²¹æ˜¯ç§»é™¤æ— ç”¨ä»£ç 
- æ¸…ç†åç³»ç»Ÿæ›´ç®€æ´

#### 3. "ä¼šç ´åä»€ä¹ˆå—ï¼Ÿ"
**ç­”**ï¼šâœ… **å‘åå…¼å®¹ï¼Œæ— ç ´åæ€§**
- å›¾è°±åŠŸèƒ½ä»æœªå¯ç”¨ï¼Œåˆ é™¤ä¸å½±å“ç°æœ‰ä¸šåŠ¡
- çŸ¥è¯†åº“çš„å‘é‡æ£€ç´¢åŠŸèƒ½å®Œå…¨ç‹¬ç«‹ï¼Œä¸å—å½±å“
- RAGé—®ç­”æµç¨‹ä¿æŒä¸å˜ï¼ˆä»…ä½¿ç”¨å‘é‡æ£€ç´¢ï¼‰

#### 4. "å½“å‰é¡¹ç›®çœŸçš„éœ€è¦è¿™ä¸ªåŠŸèƒ½å—ï¼Ÿ"
**ç­”**ï¼šâŒ **ä¸éœ€è¦**
- Neo4jæœªéƒ¨ç½²ï¼Œå›¾è°±åŠŸèƒ½æ— æ³•ä½¿ç”¨
- å‘é‡æ£€ç´¢å·²æ»¡è¶³å½“å‰éœ€æ±‚
- æœªæ¥å¦‚éœ€å›¾è°±ï¼Œå¯ä½¿ç”¨Spring AI Alibaba Graphé‡æ–°è®¾è®¡

#### 5. "è¿™æ˜¯è¿‡åº¦è®¾è®¡å—ï¼Ÿ"
**ç­”**ï¼šâœ… **ç§»é™¤è¿‡åº¦è®¾è®¡**
- å½“å‰å®ç°å¼•å…¥Neo4jä½†æœªä½¿ç”¨ï¼Œå±äºè¿‡åº¦è®¾è®¡
- åˆ é™¤åç³»ç»Ÿä¾èµ–æ›´å°‘ï¼Œæ¶æ„æ›´æ¸…æ™°

#### 6. "å¤æ‚åº¦ä¸æ”¶ç›ŠåŒ¹é…å—ï¼Ÿ"
**ç­”**ï¼šâœ… **åˆ é™¤æ”¶ç›Šå¤§äºæˆæœ¬**
- **åˆ é™¤æˆæœ¬**ï¼š2å°æ—¶ä»£ç æ¸…ç† + 1å°æ—¶æµ‹è¯•
- **ç»´æŠ¤æ”¶ç›Š**ï¼šå‡å°‘Neo4jä¾èµ–ã€ç®€åŒ–ä»£ç ç»“æ„ã€é™ä½ç»´æŠ¤æˆæœ¬

#### 7. "æœ‰è¶³å¤Ÿä¿¡æ¯åšå†³ç­–å—ï¼Ÿ"
**ç­”**ï¼šâœ… **ä¿¡æ¯å……åˆ†**
- å·²å®Œæ•´åˆ†æåç«¯12ä¸ªæ–‡ä»¶ã€å‰ç«¯6ä¸ªæ–‡ä»¶ã€æ•°æ®åº“2ä¸ªè¡¨4ä¸ªå­—æ®µ
- ä¾èµ–å…³ç³»æ¸…æ™°ï¼Œå½±å“èŒƒå›´æ˜ç¡®

### ç»“è®º
âœ… **é€šè¿‡KISSè¯„ä¼°ï¼Œç¡®è®¤åˆ é™¤æ–¹æ¡ˆåˆç†ä¸”å¿…è¦**

---

## ğŸ“Š å½“å‰é—®é¢˜åˆ†æ

### é—®é¢˜1ï¼šå›¾è°±åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨
- **ç°è±¡**ï¼šNeo4jæ•°æ®åº“æœªé…ç½®è¿æ¥ä¿¡æ¯
- **ä»£ç è·¯å¾„**ï¼š`Neo4jConfig.java`ã€`Neo4jGraphIndexingService.java`
- **å½±å“**ï¼šå›¾è°±ç´¢å¼•å’Œæ£€ç´¢åŠŸèƒ½æ— æ³•å¯åŠ¨

### é—®é¢˜2ï¼šæ— ç”¨ä»£ç å¢åŠ ç»´æŠ¤æˆæœ¬
- **ç°è±¡**ï¼š792è¡Œå›¾è°±ç´¢å¼•æœåŠ¡ + 646è¡Œå›¾è°±æ£€ç´¢æœåŠ¡å®Œå…¨æœªä½¿ç”¨
- **å½±å“**ï¼šä»£ç å®¡æŸ¥ã€é‡æ„æ—¶éœ€è¦é¢å¤–ç†è§£è¿™äº›æ— æ•ˆä»£ç 

### é—®é¢˜3ï¼šå‰ç«¯UIå­˜åœ¨è¯¯å¯¼æ€§
- **ç°è±¡**ï¼šå·¥ä½œæµç¼–è¾‘å™¨æ˜¾ç¤º"å›¾è°±æ£€ç´¢"å¼€å…³ï¼Œä½†åç«¯æ— æ³•æ‰§è¡Œ
- **å½±å“**ï¼šç”¨æˆ·è¯¯ä»¥ä¸ºåŠŸèƒ½å¯ç”¨ï¼Œå¯ç”¨åæŠ¥é”™

---

## ğŸ—‚ï¸ åˆ é™¤æ¸…å•ï¼ˆå®Œæ•´ç‰ˆï¼‰

### ä¸€ã€åç«¯Javaæ–‡ä»¶

#### 1.1 å®Œå…¨åˆ é™¤çš„æ–‡ä»¶ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|---------|------|------|
| `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/Neo4jGraphIndexingService.java` | 792 | å›¾è°±ç´¢å¼•æœåŠ¡ï¼ˆå°†æ–‡æ¡£è½¬æ¢ä¸ºå›¾è°±ï¼‰ |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/GraphRetrievalService.java` | 646 | å›¾è°±æ£€ç´¢æœåŠ¡ï¼ˆä»å›¾è°±ä¸­æœç´¢å®ä½“å’Œå…³ç³»ï¼‰ |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/config/Neo4jConfig.java` | 29 | Neo4j Spring Dataé…ç½® |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/core/repository/neo4j/EntityRepository.java` | - | Neo4jå®ä½“ä»“åº“æ¥å£ |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/controller/rag/GraphQueryController.java` | 71 | å›¾è°±æŸ¥è¯¢REST API |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/rag/GraphRelationVo.java` | - | å›¾è°±å…³ç³»VO |
| `scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/rag/GraphSearchResultVo.java` | - | å›¾è°±æœç´¢ç»“æœVO |
| `scm-ai/src/main/resources/neo4j/init_neo4j_structure.cypher` | - | Neo4jåˆå§‹åŒ–è„šæœ¬ |

**åˆ é™¤å‘½ä»¤**ï¼ˆä»åç«¯æ ¹ç›®å½•æ‰§è¡Œï¼‰ï¼š
```bash
# åˆ é™¤æœåŠ¡ç±»
rm scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/Neo4jGraphIndexingService.java
rm scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/GraphRetrievalService.java

# åˆ é™¤é…ç½®ç±»
rm scm-ai/src/main/java/com/xinyirun/scm/ai/config/Neo4jConfig.java

# åˆ é™¤Repository
rm -r scm-ai/src/main/java/com/xinyirun/scm/ai/core/repository/neo4j

# åˆ é™¤Controller
rm scm-ai/src/main/java/com/xinyirun/scm/ai/controller/rag/GraphQueryController.java

# åˆ é™¤VO
rm scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/rag/GraphRelationVo.java
rm scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/rag/GraphSearchResultVo.java

# åˆ é™¤Neo4jèµ„æºæ–‡ä»¶
rm -r scm-ai/src/main/resources/neo4j
```

#### 1.2 éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆ6ä¸ªæ–‡ä»¶ï¼‰

##### æ–‡ä»¶1ï¼š`AiKnowledgeBaseEntity.java`
**ä½ç½®**ï¼š`scm-ai/src/main/java/com/xinyirun/scm/ai/bean/entity/rag/AiKnowledgeBaseEntity.java`

**åˆ é™¤å†…å®¹**ï¼šLines 130-137
```java
// âŒ åˆ é™¤è¿™ä¸¤ä¸ªå­—æ®µ
@TableField("entity_count")
@DataChangeLabelAnnotation(value="å®ä½“æ•°é‡")
private Integer entityCount;

@TableField("relation_count")
@DataChangeLabelAnnotation(value="å…³ç³»æ•°é‡")
private Integer relationCount;
```

---

##### æ–‡ä»¶2ï¼š`AiKnowledgeBaseItemEntity.java`
**ä½ç½®**ï¼š`scm-ai/src/main/java/com/xinyirun/scm/ai/bean/entity/rag/AiKnowledgeBaseItemEntity.java`

**åˆ é™¤å†…å®¹**ï¼šLines 120-127
```java
// âŒ åˆ é™¤è¿™ä¸¤ä¸ªå­—æ®µ
@TableField("graphical_status")
@DataChangeLabelAnnotation(value="å›¾è°±åŒ–çŠ¶æ€")
private Integer graphicalStatus;

@TableField("graphical_status_change_time")
@DataChangeLabelAnnotation(value="å›¾è°±åŒ–çŠ¶æ€å˜æ›´æ—¶é—´")
private LocalDateTime graphicalStatusChangeTime;
```

---

##### æ–‡ä»¶3ï¼š`AiKnowledgeBaseVo.java`
**ä½ç½®**ï¼š`scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/rag/AiKnowledgeBaseVo.java`

**åˆ é™¤å†…å®¹**ï¼šLines 119-126ï¼ˆä¸Entityç±»å¯¹åº”ï¼‰
```java
// âŒ åˆ é™¤
private Integer entityCount;
private Integer relationCount;
```

---

##### æ–‡ä»¶4ï¼š`AiKnowledgeBaseItemVo.java`
**ä½ç½®**ï¼š`scm-ai/src/main/java/com/xinyirun/scm/ai/bean/vo/rag/AiKnowledgeBaseItemVo.java`

**åˆ é™¤å†…å®¹**ï¼šLines 77-84ï¼ˆä¸Entityç±»å¯¹åº”ï¼‰
```java
// âŒ åˆ é™¤
private Integer graphicalStatus;
private LocalDateTime graphicalStatusChangeTime;
```

---

##### æ–‡ä»¶5ï¼š`KnowledgeBaseStatisticsService.java`
**ä½ç½®**ï¼š`scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/KnowledgeBaseStatisticsService.java`

**åˆ é™¤å†…å®¹1**ï¼šLines 84-106 - `updateItemGraphIndexStatus()`æ–¹æ³•
```java
// âŒ åˆ é™¤æ•´ä¸ªæ–¹æ³•
@Transactional
public void updateItemGraphIndexStatus(String kb_uuid, String item_uuid, int new_status, String error_message) {
    // ... æ•´ä¸ªæ–¹æ³•åˆ é™¤
}
```

**åˆ é™¤å†…å®¹2**ï¼šLines 133-140 - å›¾è°±ç»Ÿè®¡é€»è¾‘
```java
// âŒ åˆ é™¤å›¾è°±ç»Ÿè®¡
// å›¾è°±ç»Ÿè®¡
Map<String, Long> graphStats = neo4jService.countGraphElementsByKbUuid(kb_uuid);
long entity_count = graphStats.getOrDefault("entity_count", 0L);
long relation_count = graphStats.getOrDefault("relation_count", 0L);

// æ›´æ–°ç»Ÿè®¡
// ... entity_count, relation_count ç›¸å…³æ›´æ–°ä»£ç 
```

**åˆ é™¤åéœ€è¦è°ƒæ•´**ï¼šImportè¯­å¥ä¸­åˆ é™¤`Neo4jGraphIndexingService`çš„å¼•ç”¨

---

##### æ–‡ä»¶6ï¼š`DocumentIndexingService.java`
**ä½ç½®**ï¼š`scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/DocumentIndexingService.java`

**åˆ é™¤å†…å®¹**ï¼šLines 164-172 - å›¾è°±ç´¢å¼•ä»£ç å—
```java
// âŒ åˆ é™¤æ•´ä¸ªifå—
if (indexTypes.contains(INDEX_TYPE_GRAPHICAL)) {
    log.info("å¼€å§‹å›¾è°±ç´¢å¼•,item_uuid: {}", itemUuid);
    String result = neo4jGraphIndexingService.ingestDocument(kb, item);
    log.info("å›¾è°±ç´¢å¼•å®Œæˆ,item_uuid: {}, ç»“æœ: {}", itemUuid, result);

    // æ›´æ–°å›¾è°±ç´¢å¼•çŠ¶æ€ä¸ºæˆåŠŸ
    knowledgeBaseStatisticsService.updateItemGraphIndexStatus(kb.getKb_uuid(), itemUuid, 3, null);
}
```

**åˆ é™¤åéœ€è¦è°ƒæ•´**ï¼š
- Importè¯­å¥åˆ é™¤`Neo4jGraphIndexingService`
- åˆ é™¤å¸¸é‡ `INDEX_TYPE_GRAPHICAL = "graphical"`

---

##### æ–‡ä»¶7ï¼š`RagService.java`
**ä½ç½®**ï¼š`scm-ai/src/main/java/com/xinyirun/scm/ai/core/service/RagService.java`

**åˆ é™¤å†…å®¹**ï¼šLines 178-199 - å›¾è°±æ£€ç´¢é€»è¾‘
```java
// âŒ åˆ é™¤å›¾è°±æ£€ç´¢éƒ¨åˆ†
// 2. å›¾è°±æ£€ç´¢
List<GraphSearchResultVo> graphResults = graphRetrievalService.searchRelatedEntities(
        question, kbUuid, tenantCode, effectiveMaxResults);

// å°†å›¾è°±ç»“æœæ‹¼æ¥åˆ°context
if (!graphResults.isEmpty()) {
    context.append("\n\n=== å›¾è°±æ£€ç´¢ç»“æœ ===\n");
    // ... å›¾è°±ç»“æœæ‹¼æ¥é€»è¾‘
}
```

**åˆ é™¤åéœ€è¦è°ƒæ•´**ï¼šImportè¯­å¥åˆ é™¤`GraphRetrievalService`å’Œ`GraphSearchResultVo`

---

##### æ–‡ä»¶8ï¼š`KnowledgeRetrievalNode.java`
**ä½ç½®**ï¼š`scm-ai/src/main/java/com/xinyirun/scm/ai/workflow/node/knowledgeretrieval/KnowledgeRetrievalNode.java`

**åˆ é™¤å†…å®¹1**ï¼šLines 70-77 - å›¾è°±æ£€ç´¢é…ç½®è·å–
```java
// âŒ åˆ é™¤
boolean enableGraph = Boolean.TRUE.equals(nodeConfig.getEnableGraphRetrieval());
String graphModelName = nodeConfig.getGraphModelName();

// å›¾è°±æ£€ç´¢æ¨¡å‹éªŒè¯ï¼ˆä¸ç”Ÿæˆå›ç­”èŠ‚ç‚¹é€»è¾‘ä¸€è‡´ï¼šä¸é…ç½®å°±æŠ¥é”™ï¼Œä¸ä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼‰
if (enableGraph && StringUtils.isBlank(graphModelName)) {
    log.error("âŒ å¯ç”¨å›¾è°±æ£€ç´¢æ—¶å¿…é¡»é…ç½®å›¾è°±æ£€ç´¢æ¨¡å‹");
    throw new BusinessException("å¯ç”¨å›¾è°±æ£€ç´¢æ—¶å¿…é¡»é…ç½®å›¾è°±æ£€ç´¢æ¨¡å‹ã€‚è¯·åœ¨èŠ‚ç‚¹å±æ€§ä¸­é€‰æ‹©æ¨¡å‹ï¼Œæˆ–å…³é—­å›¾è°±æ£€ç´¢å¼€å…³ã€‚");
}
```

**åˆ é™¤å†…å®¹2**ï¼šLines 98-157 - å›¾è°±æ£€ç´¢æ‰§è¡Œé€»è¾‘
```java
// âŒ åˆ é™¤æ•´ä¸ªå›¾è°±æ£€ç´¢ä»£ç å—
// 2. å›¾è°±æ£€ç´¢ï¼ˆä»…åœ¨å¯ç”¨æ—¶è°ƒç”¨ï¼‰
List<GraphSearchResultVo> graphResults = new ArrayList<>();

if (enableGraph) {
    log.info("=== å›¾è°±æ£€ç´¢å·²å¯ç”¨ ===");
    // ... å®Œæ•´çš„å›¾è°±æ£€ç´¢é€»è¾‘
}

// 3. æ£€æŸ¥æ£€ç´¢ç»“æœ
boolean vectorEmpty = searchResults == null || searchResults.isEmpty();
boolean graphEmpty = !enableGraph || graphResults.isEmpty();
// ... å›¾è°±ç»“æœåˆå¹¶é€»è¾‘
```

**ä¿ç•™å†…å®¹**ï¼šä»…ä¿ç•™å‘é‡æ£€ç´¢éƒ¨åˆ†ï¼Œåˆ é™¤æ‰€æœ‰å›¾è°±æ£€ç´¢ç›¸å…³ä»£ç 

**åˆ é™¤åéœ€è¦è°ƒæ•´**ï¼šImportè¯­å¥åˆ é™¤`GraphRetrievalService`ã€`GraphSearchResultVo`ã€`GraphRelationVo`

---

### äºŒã€å‰ç«¯Vue.jsæ–‡ä»¶

#### 2.1 å®Œå…¨åˆ é™¤çš„æ–‡ä»¶ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|---------|------|------|
| `src/components/70_ai/components/rag/dialogs/ItemGraphDialog.vue` | 88 | çŸ¥è¯†é¡¹å›¾è°±å¯¹è¯æ¡†åŒ…è£…å™¨ |
| `src/components/70_ai/components/rag/components/ItemGraphViewer.vue` | 593 | å›¾è°±å¯è§†åŒ–ç»„ä»¶ï¼ˆä½¿ç”¨cytoscape.jsï¼‰ |
| `src/components/70_ai/components/rag/dialogs/RagChatGraphDialog.vue` | 549 | RAGèŠå¤©å›¾è°±å¼•ç”¨å¯¹è¯æ¡† |
| `src/components/70_ai/components/rag/utils/graphUtils.js` | 382 | å›¾è°±å·¥å…·å‡½æ•°ï¼ˆcytoscapeå°è£…ï¼‰ |

**åˆ é™¤å‘½ä»¤**ï¼ˆä»å‰ç«¯æ ¹ç›®å½•æ‰§è¡Œï¼‰ï¼š
```bash
# åˆ é™¤å¯¹è¯æ¡†
rm src/components/70_ai/components/rag/dialogs/ItemGraphDialog.vue
rm src/components/70_ai/components/rag/dialogs/RagChatGraphDialog.vue

# åˆ é™¤ç»„ä»¶
rm src/components/70_ai/components/rag/components/ItemGraphViewer.vue

# åˆ é™¤å·¥å…·å‡½æ•°
rm src/components/70_ai/components/rag/utils/graphUtils.js
```

#### 2.2 éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰

##### æ–‡ä»¶1ï¼š`knowledgeBaseService.js`
**ä½ç½®**ï¼š`src/components/70_ai/api/knowledgeBaseService.js`

**åˆ é™¤å†…å®¹**ï¼šLines 205-222 - `graphList()`æ–¹æ³•
```javascript
// âŒ åˆ é™¤æ•´ä¸ªæ–¹æ³•
/**
 * è·å–å›¾è°±æ•°æ®
 * @param {string} kbItemUuid - çŸ¥è¯†é¡¹UUID
 * @param {number} maxVertextId - æœ€å¤§é¡¶ç‚¹ID
 * @param {number} maxEdgeId - æœ€å¤§è¾¹ID
 * @param {number} limit - é™åˆ¶æ•°é‡
 */
graphList (kbItemUuid, maxVertextId, maxEdgeId, limit) {
  return request({
    url: `/api/v1/ai/knowledge-base-graph/list/${kbItemUuid}`,
    method: 'get',
    params: {
      limit,
      maxEdgeId,
      maxVertexId: maxVertextId
    }
  })
}
```

---

##### æ–‡ä»¶2ï¼š`ragService.js`
**ä½ç½®**ï¼š`src/components/70_ai/api/ragService.js`

**åˆ é™¤å†…å®¹**ï¼šLines 205-210 - `getGraphRef()`æ–¹æ³•
```javascript
// âŒ åˆ é™¤æ•´ä¸ªæ–¹æ³•
getGraphRef (uuid) {
  return request({
    url: `/api/v1/ai/knowledge-base/qa/graph-ref/${uuid}`,
    method: 'get'
  })
}
```

---

##### æ–‡ä»¶3ï¼š`KnowledgeRetrievalNodeProperty.vue`
**ä½ç½®**ï¼š`src/components/70_ai/components/workflow/components/properties/KnowledgeRetrievalNodeProperty.vue`

**åˆ é™¤å†…å®¹1**ï¼šLines 58-75 - å›¾è°±æ£€ç´¢å¼€å…³
```vue
<!-- âŒ åˆ é™¤æ•´ä¸ªå›¾è°±æ£€ç´¢é…ç½®å— -->
<!-- å›¾è°±æ£€ç´¢ -->
<div class="property-section">
  <div class="section-title">
    å›¾è°±æ£€ç´¢
    <el-tooltip placement="top">
      <div slot="content">
        <div>å¯ç”¨åå°†åŒæ—¶æ‰§è¡Œå‘é‡æ£€ç´¢å’Œå›¾è°±æ£€ç´¢ï¼Œåˆå¹¶å®ä½“å’Œå…³ç³»ä¿¡æ¯</div>
        <div>éœ€è¦çŸ¥è¯†åº“å®Œæˆå›¾è°±åŒ–ç´¢å¼•</div>
      </div>
      <i class="el-icon-question" style="color: #909399; font-size: 14px; margin-left: 4px;" />
    </el-tooltip>
  </div>
  <el-switch
    v-model="nodeConfig.enable_graph_retrieval"
    active-text="å¯ç”¨"
    inactive-text="å…³é—­"
  />
</div>
```

**åˆ é™¤å†…å®¹2**ï¼šLines 77-93 - å›¾è°±æ£€ç´¢æ¨¡å‹é€‰æ‹©
```vue
<!-- âŒ åˆ é™¤å›¾è°±æ¨¡å‹é€‰æ‹©å™¨ -->
<div v-if="nodeConfig.enable_graph_retrieval" class="property-section">
  <div class="section-title">
    å›¾è°±æ£€ç´¢æ¨¡å‹
    <el-tooltip placement="top">
      <div slot="content">
        <div>ç”¨äºä»é—®é¢˜ä¸­æå–å®ä½“çš„LLMæ¨¡å‹</div>
        <div>å»ºè®®ä½¿ç”¨è¾ƒå¿«çš„æ¨¡å‹ï¼ˆå¦‚GPT-3.5ï¼‰ä»¥é™ä½æˆæœ¬</div>
      </div>
      <i class="el-icon-question" style="color: #909399; font-size: 14px; margin-left: 4px;" />
    </el-tooltip>
  </div>
  <wf-llm-selector
    :model-name="nodeConfig.graph_model_name"
    @llm-selected="handleGraphModelSelected"
  />
</div>
```

**åˆ é™¤å†…å®¹3**ï¼šScriptéƒ¨åˆ† - åˆ é™¤å›¾è°±ç›¸å…³computedå’Œæ–¹æ³•
```javascript
// âŒ åˆ é™¤computedä¸­çš„å›¾è°±é…ç½®åˆå§‹åŒ–
if (this.wfNode.nodeConfig.enable_graph_retrieval === undefined) {
  this.$set(this.wfNode.nodeConfig, 'enable_graph_retrieval', false)
}
if (!this.wfNode.nodeConfig.graph_model_name) {
  this.$set(this.wfNode.nodeConfig, 'graph_model_name', '')
}

// âŒ åˆ é™¤handleGraphModelSelectedæ–¹æ³•ï¼ˆlines 191-208ï¼‰
```

---

##### æ–‡ä»¶4ï¼š`KnowledgeBaseDetailDialog.vue`
**ä½ç½®**ï¼š`src/components/70_ai/components/rag/dialogs/KnowledgeBaseDetailDialog.vue`

**åˆ é™¤å†…å®¹**ï¼šLines 160-190ï¼ˆå¤§çº¦ï¼‰ - å›¾è°±åŒ–çŠ¶æ€åˆ—
```vue
<!-- âŒ åˆ é™¤æ•´ä¸ªè¡¨æ ¼åˆ— -->
<el-table-column
  label="å›¾è°±åŒ–çŠ¶æ€"
  width="120"
>
  <template slot-scope="scope">
    <el-tag
      v-if="scope.row.graphicalStatus === 3"
      type="success"
      size="small"
    >
      å·²å®Œæˆ
    </el-tag>
    <el-tag
      v-else-if="scope.row.graphicalStatus === 2"
      type="warning"
      size="small"
    >
      å¤„ç†ä¸­
    </el-tag>
    <el-tag
      v-else-if="scope.row.graphicalStatus === 4"
      type="danger"
      size="small"
    >
      å¤±è´¥
    </el-tag>
    <el-tag
      v-else
      type="info"
      size="small"
    >
      å¾…å¤„ç†
    </el-tag>
  </template>
</el-table-column>
```

**åˆ é™¤å†…å®¹2**ï¼šæ“ä½œåˆ—ä¸­çš„"æŸ¥çœ‹å›¾è°±"æŒ‰é’®ï¼ˆæœç´¢`æŸ¥çœ‹å›¾è°±`å…³é”®è¯ï¼‰

---

##### æ–‡ä»¶5ï¼š`RagChatDialog.vue`
**ä½ç½®**ï¼š`src/components/70_ai/components/rag/dialogs/RagChatDialog.vue`

**åˆ é™¤å†…å®¹**ï¼šLines 77-84 - "å›¾è°±"æŒ‰é’®
```vue
<!-- âŒ åˆ é™¤å›¾è°±æŒ‰é’® -->
<el-button
  type="text"
  size="mini"
  icon="el-icon-share"
  @click="handleShowGraph(record)"
>
  å›¾è°±
</el-button>
```

**åˆ é™¤å†…å®¹2**ï¼šScriptéƒ¨åˆ†
- åˆ é™¤`RagChatGraphDialog`ç»„ä»¶å¼•ç”¨
- åˆ é™¤`handleShowGraph()`æ–¹æ³•
- åˆ é™¤ç›¸å…³dataå±æ€§ï¼ˆå¦‚æœæœ‰ï¼‰

---

### ä¸‰ã€pom.xmlä¾èµ–æ¸…ç†

**æ–‡ä»¶ä½ç½®**ï¼š`scm-ai/pom.xml`

**åˆ é™¤å†…å®¹**ï¼šLines 192-196
```xml
<!-- âŒ åˆ é™¤Neo4jä¾èµ– -->
<!-- Neo4jæ•°æ®æ”¯æŒ - ç”¨äºçŸ¥è¯†å›¾è°±å­˜å‚¨å’Œå…³ç³»æŸ¥è¯¢ -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-neo4j</artifactId>
</dependency>
```

---

### å››ã€MySQLæ•°æ®åº“æ¸…ç†

#### 4.1 åˆ é™¤è¡¨ï¼ˆ2ä¸ªè¡¨ï¼‰

**SQLå‘½ä»¤**ï¼š
```sql
-- âŒ åˆ é™¤å›¾è°±åˆ†æ®µè¡¨
DROP TABLE IF EXISTS `ai_knowledge_base_graph_segment`;

-- âŒ åˆ é™¤å›¾è°±å¼•ç”¨è¡¨
DROP TABLE IF EXISTS `ai_knowledge_base_qa_ref_graph`;
```

#### 4.2 åˆ é™¤å­—æ®µï¼ˆ2ä¸ªè¡¨ï¼Œå…±4ä¸ªå­—æ®µï¼‰

**SQLå‘½ä»¤**ï¼š
```sql
-- è¡¨1ï¼šai_knowledge_base
ALTER TABLE `ai_knowledge_base`
DROP COLUMN `entity_count`,
DROP COLUMN `relation_count`;

-- è¡¨2ï¼šai_knowledge_base_item
ALTER TABLE `ai_knowledge_base_item`
DROP COLUMN `graphical_status`,
DROP COLUMN `graphical_status_change_time`;
```

---

## âš ï¸ é£é™©è¯„ä¼°ä¸åº”å¯¹

### é£é™©1ï¼šå‘åå…¼å®¹æ€§
**é£é™©æè¿°**ï¼šåˆ é™¤å­—æ®µåï¼Œæ—§çš„å‰ç«¯ä»£ç å¯èƒ½ä»ç„¶å°è¯•è¯»å–è¿™äº›å­—æ®µ
**åº”å¯¹æªæ–½**ï¼š
âœ… **å‰åç«¯åŒæ­¥éƒ¨ç½²**ï¼šç¡®ä¿å‰åç«¯ä»£ç åŒæ—¶æ›´æ–°
âœ… **æ•°æ®åº“è¿ç§»**ï¼šåœ¨åœæœç»´æŠ¤çª—å£æœŸæ‰§è¡Œ`DROP COLUMN`
âœ… **å›æ»šé¢„æ¡ˆ**ï¼šä¿ç•™æ•°æ®åº“å¤‡ä»½ï¼Œå¦‚å‡ºç°é—®é¢˜å¯å¿«é€Ÿå›æ»šå­—æ®µ

### é£é™©2ï¼šä¾èµ–æ¸…ç†ä¸å½»åº•
**é£é™©æè¿°**ï¼šåˆ é™¤Neo4jä¾èµ–åï¼Œå¯èƒ½å­˜åœ¨éšè—çš„ç±»å¼•ç”¨å¯¼è‡´ç¼–è¯‘å¤±è´¥
**åº”å¯¹æªæ–½**ï¼š
âœ… **ç¼–è¯‘æ£€æŸ¥**ï¼šæ‰§è¡Œ`mvn clean compile`ç¡®ä¿æ— ç¼–è¯‘é”™è¯¯
âœ… **IDEAæœç´¢**ï¼šå…¨å±€æœç´¢`import ...neo4j...`ç¡®ä¿æ— æ®‹ç•™å¼•ç”¨
âœ… **å•å…ƒæµ‹è¯•**ï¼šè¿è¡Œç°æœ‰å•å…ƒæµ‹è¯•éªŒè¯ä¸šåŠ¡é€»è¾‘å®Œæ•´æ€§

### é£é™©3ï¼šå‰ç«¯ç»„ä»¶å¼•ç”¨æ®‹ç•™
**é£é™©æè¿°**ï¼šåˆ é™¤å¯¹è¯æ¡†åï¼Œå…¶ä»–ç»„ä»¶å¯èƒ½ä»æœ‰importå¼•ç”¨
**åº”å¯¹æªæ–½**ï¼š
âœ… **å…¨å±€æœç´¢**ï¼šæœç´¢`ItemGraphDialog`ã€`ItemGraphViewer`ã€`RagChatGraphDialog`
âœ… **Lintæ£€æŸ¥**ï¼šè¿è¡Œ`npm run lint`æ£€æŸ¥æœªä½¿ç”¨çš„å¯¼å…¥
âœ… **æ„å»ºéªŒè¯**ï¼šæ‰§è¡Œ`npm run build`ç¡®ä¿æ— æ„å»ºé”™è¯¯

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### æµ‹è¯•1ï¼šå‘é‡æ£€ç´¢åŠŸèƒ½å®Œæ•´æ€§
**æµ‹è¯•ç›®æ ‡**ï¼šç¡®è®¤åˆ é™¤å›¾è°±åŠŸèƒ½åï¼Œå‘é‡æ£€ç´¢æ­£å¸¸å·¥ä½œ
**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºæ–°çŸ¥è¯†åº“
2. ä¸Šä¼ æ–‡æ¡£å¹¶ç´¢å¼•ï¼ˆä»…å‘é‡ç´¢å¼•ï¼‰
3. ä½¿ç”¨RAG Chatè¿›è¡Œé—®ç­”
4. éªŒè¯èƒ½å¤Ÿæ­£å¸¸æ£€ç´¢å¹¶è¿”å›ç­”æ¡ˆ

**é¢„æœŸç»“æœ**ï¼šâœ… å‘é‡æ£€ç´¢åŠŸèƒ½æ­£å¸¸ï¼Œç­”æ¡ˆå‡†ç¡®

---

### æµ‹è¯•2ï¼šå·¥ä½œæµçŸ¥è¯†æ£€ç´¢èŠ‚ç‚¹
**æµ‹è¯•ç›®æ ‡**ï¼šç¡®è®¤å·¥ä½œæµä¸­çš„çŸ¥è¯†æ£€ç´¢èŠ‚ç‚¹æ­£å¸¸å·¥ä½œ
**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ‰“å¼€å·¥ä½œæµç¼–è¾‘å™¨
2. æ‹–æ‹½"çŸ¥è¯†æ£€ç´¢"èŠ‚ç‚¹
3. é…ç½®çŸ¥è¯†åº“UUIDã€å¬å›æ•°é‡ã€æœ€ä½åˆ†æ•°
4. **éªŒè¯**ï¼š"å›¾è°±æ£€ç´¢"å¼€å…³å·²æ¶ˆå¤±
5. è¿è¡Œå·¥ä½œæµæµ‹è¯•

**é¢„æœŸç»“æœ**ï¼šâœ… èŠ‚ç‚¹é…ç½®ç•Œé¢æ— å›¾è°±é€‰é¡¹ï¼Œæ£€ç´¢åŠŸèƒ½æ­£å¸¸

---

### æµ‹è¯•3ï¼šçŸ¥è¯†åº“è¯¦æƒ…é¡µé¢
**æµ‹è¯•ç›®æ ‡**ï¼šç¡®è®¤çŸ¥è¯†åº“è¯¦æƒ…é¡µé¢UIæ­£å¸¸
**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ‰“å¼€çŸ¥è¯†åº“ç®¡ç†é¡µé¢
2. ç‚¹å‡»"è¯¦æƒ…"æŸ¥çœ‹çŸ¥è¯†åº“å†…å®¹
3. **éªŒè¯**ï¼šè¡¨æ ¼ä¸­æ— "å›¾è°±åŒ–çŠ¶æ€"åˆ—
4. **éªŒè¯**ï¼šæ“ä½œåˆ—æ— "æŸ¥çœ‹å›¾è°±"æŒ‰é’®

**é¢„æœŸç»“æœ**ï¼šâœ… UIæ­£å¸¸ï¼Œæ— å›¾è°±ç›¸å…³å…ƒç´ 

---

### æµ‹è¯•4ï¼šæ•°æ®åº“å®Œæ•´æ€§
**æµ‹è¯•ç›®æ ‡**ï¼šç¡®è®¤æ•°æ®åº“åˆ é™¤æ“ä½œæˆåŠŸä¸”ä¸å½±å“å…¶ä»–è¡¨
**æµ‹è¯•SQL**ï¼š
```sql
-- éªŒè¯è¡¨å·²åˆ é™¤
SHOW TABLES LIKE 'ai_knowledge_base_graph%';
-- é¢„æœŸï¼šEmpty set

-- éªŒè¯å­—æ®µå·²åˆ é™¤
DESC ai_knowledge_base;
-- é¢„æœŸï¼šæ— entity_countã€relation_countå­—æ®µ

DESC ai_knowledge_base_item;
-- é¢„æœŸï¼šæ— graphical_statusã€graphical_status_change_timeå­—æ®µ
```

**é¢„æœŸç»“æœ**ï¼šâœ… å›¾è°±ç›¸å…³è¡¨å’Œå­—æ®µå®Œå…¨ç§»é™¤

---

### æµ‹è¯•5ï¼šåç«¯ç¼–è¯‘ä¸å¯åŠ¨
**æµ‹è¯•ç›®æ ‡**ï¼šç¡®è®¤åç«¯ä»£ç æ— ç¼–è¯‘é”™è¯¯ä¸”èƒ½æ­£å¸¸å¯åŠ¨
**æµ‹è¯•æ­¥éª¤**ï¼š
```bash
cd scm-backend
mvn clean compile  # ç¼–è¯‘æ£€æŸ¥
cd scm-start
mvn spring-boot:run  # å¯åŠ¨æ£€æŸ¥
```

**é¢„æœŸç»“æœ**ï¼šâœ… æ— ç¼–è¯‘é”™è¯¯ï¼Œåº”ç”¨æ­£å¸¸å¯åŠ¨ï¼Œæ—¥å¿—æ— Neo4jè¿æ¥é”™è¯¯

---

## ğŸ“… å®æ–½æ­¥éª¤ï¼ˆæŒ‰SCMå¼€å‘æµç¨‹ï¼‰

### é˜¶æ®µ1ï¼šéœ€æ±‚ç†è§£ç¡®è®¤ âœ…ï¼ˆå·²å®Œæˆï¼‰
- [x] KISS 7é—®é¢˜éªŒè¯é€šè¿‡
- [x] Linuså¼5å±‚åˆ†æå®Œæˆ
- [x] ç¡®è®¤åˆ é™¤æ–¹æ¡ˆåˆç†æ€§

### é˜¶æ®µ2ï¼šé—®é¢˜åˆ†è§£ âœ…ï¼ˆå·²å®Œæˆï¼‰
- [x] è¯†åˆ«åç«¯8ä¸ªå¾…åˆ é™¤æ–‡ä»¶
- [x] è¯†åˆ«å‰ç«¯4ä¸ªå¾…åˆ é™¤æ–‡ä»¶
- [x] è¯†åˆ«6ä¸ªåç«¯å¾…ä¿®æ”¹æ–‡ä»¶
- [x] è¯†åˆ«5ä¸ªå‰ç«¯å¾…ä¿®æ”¹æ–‡ä»¶
- [x] è¯†åˆ«æ•°æ®åº“2è¡¨4å­—æ®µ

### é˜¶æ®µ3ï¼šæ•°æ®æ”¶é›†ä¸éªŒè¯ âœ…ï¼ˆå·²å®Œæˆï¼‰
- [x] è¯»å–æ‰€æœ‰ç›¸å…³æ–‡ä»¶å†…å®¹
- [x] ç¡®è®¤ä»£ç è¡Œå·å’Œåˆ é™¤ä½ç½®
- [x] éªŒè¯ä¾èµ–å…³ç³»

### é˜¶æ®µ4ï¼šæ–¹æ¡ˆè®¾è®¡æ–‡æ¡£ç¼–å†™ ğŸ”„ï¼ˆå½“å‰é˜¶æ®µï¼‰
- [x] ç¼–å†™å®Œæ•´åˆ é™¤æ¸…å•
- [x] åˆ¶å®šé£é™©åº”å¯¹æªæ–½
- [x] è®¾è®¡æµ‹è¯•è®¡åˆ’
- [ ] **ç­‰å¾…ç”¨æˆ·å®¡æ‰¹** â¸ï¸

### é˜¶æ®µ5ï¼šæ–¹æ¡ˆå®¡æ‰¹ â¸ï¸ï¼ˆç­‰å¾…ä¸­ï¼‰
- [ ] ç”¨æˆ·å®¡é˜…æ–¹æ¡ˆ
- [ ] ç¡®è®¤åˆ é™¤èŒƒå›´
- [ ] æ‰¹å‡†æ‰§è¡Œ

### é˜¶æ®µ6ï¼šä»£ç å®æ–½ â¹ï¸ï¼ˆå¾…æ‰§è¡Œï¼‰
- [ ] åç«¯Javaæ–‡ä»¶åˆ é™¤ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰
- [ ] åç«¯ä¸šåŠ¡é€»è¾‘ä¿®æ”¹ï¼ˆ6ä¸ªæ–‡ä»¶ï¼‰
- [ ] å‰ç«¯ç»„ä»¶åˆ é™¤ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
- [ ] å‰ç«¯é€»è¾‘ä¿®æ”¹ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰
- [ ] pom.xmlä¾èµ–æ¸…ç†
- [ ] MySQLæ•°æ®åº“æ¸…ç†

### é˜¶æ®µ7ï¼šQAä»£ç è¯„å®¡ â¹ï¸ï¼ˆå¾…æ‰§è¡Œï¼‰
- [ ] åç«¯ä»£ç review
- [ ] å‰ç«¯ä»£ç review
- [ ] æ•°æ®åº“å˜æ›´review
- [ ] æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œ

### é˜¶æ®µ8ï¼šå®ŒæˆéªŒæ”¶ â¹ï¸ï¼ˆå¾…æ‰§è¡Œï¼‰
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç æäº¤
- [ ] æ–‡æ¡£å½’æ¡£

---

## ğŸ“Œ å…³é”®å†³ç­–ç‚¹

### å†³ç­–1ï¼šæ˜¯å¦ä¿ç•™GraphXXXVoç±»ï¼Ÿ
**å»ºè®®**ï¼šâŒ **å®Œå…¨åˆ é™¤**
**ç†ç”±**ï¼šGraphRelationVoå’ŒGraphSearchResultVoä»…è¢«å›¾è°±åŠŸèƒ½ä½¿ç”¨ï¼Œåˆ é™¤åæ— æ®‹ç•™å¼•ç”¨

### å†³ç­–2ï¼šæ˜¯å¦ä¿ç•™æ•°æ®åº“è¡¨ï¼ˆä»…åˆ é™¤å­—æ®µï¼‰ï¼Ÿ
**å»ºè®®**ï¼šâŒ **DROP TABLE**
**ç†ç”±**ï¼šå›¾è°±åˆ†æ®µè¡¨å’Œå¼•ç”¨è¡¨å®Œå…¨ä¸å†ä½¿ç”¨ï¼Œä¿ç•™ç©ºè¡¨æ— æ„ä¹‰

### å†³ç­–3ï¼šæ˜¯å¦ä¿ç•™Neo4jä¾èµ–ï¼Ÿ
**å»ºè®®**ï¼šâŒ **ç§»é™¤ä¾èµ–**
**ç†ç”±**ï¼šNeo4jæœªéƒ¨ç½²ä¸”æ— è®¡åˆ’ä½¿ç”¨ï¼Œä¿ç•™ä¾èµ–å¢åŠ æ„å»ºå¤æ‚åº¦

---

## ğŸ“– é™„å½•ï¼šæ•°æ®ç»“æ„è¯´æ˜

### é™„å½•Aï¼šåˆ é™¤çš„æ•°æ®åº“è¡¨ç»“æ„

#### è¡¨1ï¼š`ai_knowledge_base_graph_segment`
```sql
CREATE TABLE `ai_knowledge_base_graph_segment` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `kb_uuid` varchar(255) NOT NULL COMMENT 'çŸ¥è¯†åº“UUID',
  `kb_item_uuid` varchar(255) NOT NULL COMMENT 'çŸ¥è¯†é¡¹UUID',
  `segment_uuid` varchar(255) NOT NULL COMMENT 'åˆ†æ®µUUID',
  `neo4j_entity_count` int DEFAULT 0 COMMENT 'Neo4jå®ä½“æ•°é‡',
  `neo4j_relation_count` int DEFAULT 0 COMMENT 'Neo4jå…³ç³»æ•°é‡',
  PRIMARY KEY (`id`),
  KEY `idx_kb_item` (`kb_item_uuid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='çŸ¥è¯†åº“å›¾è°±åˆ†æ®µè¡¨';
```

#### è¡¨2ï¼š`ai_knowledge_base_qa_ref_graph`
```sql
CREATE TABLE `ai_knowledge_base_qa_ref_graph` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `qa_record_uuid` varchar(255) NOT NULL COMMENT 'é—®ç­”è®°å½•UUID',
  `entity_name` varchar(500) NOT NULL COMMENT 'å®ä½“åç§°',
  `entity_type` varchar(100) DEFAULT NULL COMMENT 'å®ä½“ç±»å‹',
  `relation_count` int DEFAULT 0 COMMENT 'å…³è”å…³ç³»æ•°é‡',
  PRIMARY KEY (`id`),
  KEY `idx_qa_record` (`qa_record_uuid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é—®ç­”å›¾è°±å¼•ç”¨è¡¨';
```

### é™„å½•Bï¼šåˆ é™¤çš„Entityå­—æ®µè¯´æ˜

| è¡¨å | å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|------|-------|------|------|
| `ai_knowledge_base` | `entity_count` | INT | çŸ¥è¯†åº“å®ä½“æ€»æ•°ï¼ˆNeo4jç»Ÿè®¡ï¼‰|
| `ai_knowledge_base` | `relation_count` | INT | çŸ¥è¯†åº“å…³ç³»æ€»æ•°ï¼ˆNeo4jç»Ÿè®¡ï¼‰|
| `ai_knowledge_base_item` | `graphical_status` | INT | å›¾è°±åŒ–çŠ¶æ€ï¼ˆ1å¾…å¤„ç† 2å¤„ç†ä¸­ 3æˆåŠŸ 4å¤±è´¥ï¼‰|
| `ai_knowledge_base_item` | `graphical_status_change_time` | DATETIME | å›¾è°±åŒ–çŠ¶æ€å˜æ›´æ—¶é—´ |

---

## âœ… å®¡æ‰¹ç­¾å­—

| è§’è‰² | å§“å | ç­¾å­— | æ—¥æœŸ |
|------|------|------|------|
| **éœ€æ±‚æ–¹** | ___________ | ___________ | __________ |
| **å¼€å‘è´Ÿè´£äºº** | ___________ | ___________ | __________ |
| **QAè´Ÿè´£äºº** | ___________ | ___________ | __________ |
| **DBA** | ___________ | ___________ | __________ |

---

## ğŸ“ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹äºº | ä¿®æ”¹å†…å®¹ |
|------|------|--------|----------|
| v1.0 | 2025-12-01 | Claude | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæˆæ•°æ®æ”¶é›†å’Œæ–¹æ¡ˆè®¾è®¡ |

---

**æ–‡æ¡£ç»“æŸ** ğŸ¯

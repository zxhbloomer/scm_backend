<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xinyirun.scm.ai.core.mapper.chat.ExtAiModelSourceMapper">

    <select id="list" resultType="com.xinyirun.scm.ai.bean.dto.request.AiModelSourceCreateNameDTO">

        SELECT ai.id, ai.name, ai.type, ai.owner, ai.status, ai.owner_type as ownerType, ai.base_name as baseName, ai.app_key as appKey, ai.api_url as apiUrl, ai.provider_name as providerName, ai.create_time as createTime, ai.permission_type as permissionType, ai.adv_settings as advSettings, ai.create_user as createUser, m.name as createUserName
        FROM ai_model_source ai left join m_staff m on m.code = ai.create_user
        <where>
            <if test="request.keyword != null and request.keyword != ''">
                and ai.name like concat('%', #{request.keyword},'%')
            </if>
            <if test="request.owner != null and request.owner != ''">
                and ai.owner = #{request.owner}
            </if>
            <if test="request.providerName != null and request.providerName != ''">
                and ai.provider_name = #{request.providerName}
            </if>
        </where>
        order by ai.create_time desc
    </select>
    <select id="enableSourceNameList" resultType="com.xinyirun.scm.ai.bean.dto.sdk.OptionDTO">
        SELECT id, name
        FROM ai_model_source where status = true and (owner = 'system'
                                or owner = #{userId}) order by permission_type asc

    </select>
    <select id="enablePersonalSourceNameList" resultType="com.xinyirun.scm.ai.bean.dto.sdk.OptionDTO">
        SELECT id, name
        FROM ai_model_source where status = true and owner = #{userId}
    </select>

</mapper>
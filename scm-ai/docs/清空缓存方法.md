# 清空 Workflow 组件缓存的方法

## 问题原因
Spring Boot 的 `@Cacheable` 注解缓存了旧数据（还没有 Start 组件时的空结果），导致即使数据库已有数据，代码修改也完成，仍然报错"未找到开始组件"。

## 解决方案

### 方案1：重启后端服务（推荐）✅

**这是最简单、最彻底的方法**

1. 停止后端服务（在 IDEA 或命令行中停止）
2. 重新启动后端服务
3. 测试创建 workflow

### 方案2：使用 Redis 客户端清空缓存

如果不想重启服务，可以手动清空 Redis 缓存：

#### Windows Redis Desktop Manager
1. 打开 Redis Desktop Manager（如果已安装）
2. 连接到 `127.0.0.1:6379`
3. 删除以下 key：
   - `workflow:components`
   - `workflow:component:start`

#### 使用 Redis CLI（如果有）
```bash
# 删除所有 workflow 相关缓存
redis-cli -h 127.0.0.1 -p 6379 DEL "workflow:components"
redis-cli -h 127.0.0.1 -p 6379 DEL "workflow:component:start"

# 或者清空所有缓存（慎用）
redis-cli -h 127.0.0.1 -p 6379 FLUSHALL
```

#### 使用 Telnet（Windows 自带）
```bash
# 1. 启用 Telnet 客户端（如果未启用）
# 控制面板 -> 程序和功能 -> 启用或关闭 Windows 功能 -> Telnet 客户端

# 2. 连接 Redis
telnet 127.0.0.1 6379

# 3. 执行删除命令
DEL workflow:components
DEL workflow:component:start

# 4. 退出
quit
```

### 方案3：等待缓存过期（不推荐）

缓存会在一定时间后自动过期，但这取决于缓存配置，可能需要等待较长时间。

## 验证方法

重启或清空缓存后，测试创建 workflow：

```bash
POST http://localhost:8088/scm/api/v1/ai/workflow/add
Content-Type: application/json

{
  "title": "测试工作流",
  "remark": "测试描述",
  "isPublic": false
}
```

**预期结果**：
- 返回 200 成功
- 返回包含 `uuid` 的 workflow 对象
- 自动创建了 Start 节点

## 为什么会出现这个问题？

1. **初次调用时数据库为空**：第一次调用 `getAllEnable()` 时，数据库还没有组件数据，返回空列表
2. **@Cacheable 缓存了空结果**：Spring 将这个空列表缓存到 Redis
3. **后续插入数据无效**：虽然数据库已插入组件，但代码从缓存读取，永远是空列表
4. **修改代码也无效**：即使修改了 `"start"` 为 `"Start"`，缓存的列表仍是空的

## 预防措施

下次新建租户数据库时，应该：
1. 先执行 `init_workflow_components.sql` 初始化组件
2. 再启动后端服务
3. 避免在空数据库时调用组件查询接口

---

**推荐操作**：直接重启后端服务，最简单最可靠！
